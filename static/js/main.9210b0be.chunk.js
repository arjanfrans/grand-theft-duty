(this["webpackJsonpgrand-theft-duty"]=this["webpackJsonpgrand-theft-duty"]||[]).push([[0],[,,,,,,,,function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"f",(function(){return s})),i.d(e,"e",(function(){return o})),i.d(e,"d",(function(){return r})),i.d(e,"c",(function(){return h})),i.d(e,"a",(function(){return l}));var n=i(11),a={BACKSPACE:8,CTRL:17,SPACE:32,ENTER:13,SHIFT:16,ESC:27,TAB:9,LEFT:37,UP:38,RIGHT:39,DOWN:40},s={":":186,"+":187,"<":188,_:189,">":190,"?":191,"~":192,"{":219,"|":220,"}":221,'"':222},o={";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},r={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57},h={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:86,V:86,W:87,X:88,Y:89,Z:90},l=Object(n.a)(Object(n.a)(Object(n.a)(Object(n.a)({},a),h),o),r)},,function(t,e,i){"use strict";var n=i(3),a=i(25),s=i.n(a),o=i(0),r={atlases:new Map,textures:new Map,maps:new Map,fonts:new Map,audio:new Map},h=function(t,e){return c(t+e+".json").then((function(i){i.src=i.urls;var a,o=[],h=Object(n.a)(i.src);try{for(h.s();!(a=h.n()).done;){var l=a.value;o.push(t+l)}}catch(u){h.e(u)}finally{h.f()}return i.src=o,function(t,e){return new Promise((function(i,n){e.onload=function(){return i()},e.onloaderror=function(t,e){return n(e)};var a=new s.a.Howl(e),o={mapping:e,sound:a};r.audio.set(t,o)}))}(e,i)}))},l=function(t,e){var i={mapping:null,pages:[],textures:[]};return c(t+e+".json").then((function(e){i.mapping=e;var n=e.pages.map((function(e){return i.pages.push(e),u(e,t+e)}));return Promise.all(n)})).then((function(){var t,a=Object(n.a)(i.pages);try{for(a.s();!(t=a.n()).done;){var s=t.value;i.textures.push(r.textures.get(s))}}catch(o){a.e(o)}finally{a.f()}r.fonts.set(e,i)}))},u=function(t,e){return new Promise((function(i,n){f.load(e,(function(e){return r.textures.set(t,e),i()}),(function(t){console.log(t.loaded/t.total*100+"% loaded")}),(function(t){return n(t)}))}))},c=function(t){return function(t){return new Promise((function(e,i){m.load(t,(function(t){return e(t)}),(function(t){console.log(t.loaded/t.total*100+"% loaded")}),(function(t){return i(t)}))}))}(t).then((function(t){try{return JSON.parse(t)}catch(e){throw e}}))},d=function(t,e){return c(t+e+".json").then((function(t){return t})).then((function(i){return r.atlases.set(e,i),u(e,t+i.meta.image)}))},p=function(t,e){return c(t+e+".json").then((function(t){r.maps.set(e,t)}))},f=null,m=null,v={init:function(t){f=new o.t,m=new o.f;var e,i=[],a=t.paths,s=Object(n.a)(t.textureAtlases);try{for(s.s();!(e=s.n()).done;){var r=e.value;i.push(d(a.atlases+"/",r))}}catch(O){s.e(O)}finally{s.f()}var u,c=Object(n.a)(t.maps);try{for(c.s();!(u=c.n()).done;){var v=u.value;i.push(p(a.maps+"/",v))}}catch(O){c.e(O)}finally{c.f()}var y,g=Object(n.a)(t.fonts);try{for(g.s();!(y=g.n()).done;){var w=y.value;i.push(l(a.fonts+"/",w))}}catch(O){g.e(O)}finally{g.f()}var b,k=Object(n.a)(t.audio);try{for(k.s();!(b=k.n()).done;){var x=b.value;i.push(h(a.audio+"/",x))}}catch(O){k.e(O)}finally{k.f()}return Promise.all(i)},getTexture:function(t){var e=r.textures.get(t);if(!e)throw new Error("Texture does not exist: "+t);return e},cloneTexture:function(t){var e=this.getTexture(t).clone();return e.needsUpdate=!0,e},getMap:function(t){var e=r.maps.get(t);if(!e)throw new Error("Map does not exist: "+t);return e},getAtlasMapping:function(t){var e=r.atlases.get(t);if(!e)throw new Error("Atlas mapping does not exist: "+t);return e},getFont:function(t){var e=r.fonts.get(t);if(!e)throw new Error("Font does not exist: "+t);return e},getAudioSprite:function(t){var e=r.audio.get(t);if(!e)throw new Error("Audio sprite does not exist: "+t);return e}};e.a=v},,function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return s}));var n=i(1),a=i(27),s=function e(){var i=this;Object(n.a)(this,e),this.keyboard=void 0,this.keyboard=new a.a,t.addEventListener("keyup",(function(t){i.keyboard.onKeyup(t)}),!1),t.addEventListener("keydown",(function(t){i.keyboard.onKeydown(t)}),!1)}}).call(this,i(17))},,function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(3),a=i(1),s=i(2),o=function(){function t(e,i){Object(a.a)(this,t),this.name=void 0,this.engine=void 0,this.audio=void 0,this.inputs=void 0,this.views=void 0,this._initialized=!1,this.name=e,this.engine=i,this.inputs=new Set,this.views=new Set,this.audio=void 0}return Object(s.a)(t,[{key:"addView",value:function(t){this.views.add(t)}},{key:"addInput",value:function(t){this.inputs.add(t)}},{key:"init",value:function(){if(!this._initialized){this.audio&&this.audio.init();var t,e=Object(n.a)(this.views.values());try{for(e.s();!(t=e.n()).done;){t.value.init()}}catch(i){e.e(i)}finally{e.f()}this._initialized=!0}}},{key:"updateInputs",value:function(t){var e,i=Object(n.a)(this.inputs.values());try{for(i.s();!(e=i.n()).done;){e.value.update(t)}}catch(a){i.e(a)}finally{i.f()}}},{key:"render",value:function(t){var e,i=Object(n.a)(this.views.values());try{for(i.s();!(e=i.n()).done;){e.value.update(t)}}catch(a){i.e(a)}finally{i.f()}}},{key:"updateAudio",value:function(t){this.audio&&this.audio.update(t)}}]),t}()},,,,,,,,function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return g}));var n=i(18),a=i.n(n),s=i(23),o=i(1),r=i(2),h=i(34),l=i(10),u=i(26),c=i.n(u),d=i(31),p=i(12),f=i(32),m=i(33),v=c.a.resolve(t,"../../assets/"),y={paths:{maps:v+"/maps",atlases:v+"/spritesheets",fonts:v+"/fonts",audio:v+"/audio/sprites"},textureAtlases:["soldier","tiles","world","ui"],maps:["level1","level2"],fonts:["keep_calm"],audio:["guns","background","menu_effects"]},g=function(){function t(){Object(o.a)(this,t)}return Object(r.a)(t,[{key:"start",value:function(){var t=Object(s.a)(a.a.mark((function t(){var e,i;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.a.init(y);case 2:e=new h.a({renderer:new m.a({div:"root",width:800,height:600}),input:{keyboard:new p.a,gamepad:new f.a}}),i=d.a.create(e),e.addState("menu",i),e.changeState("menu"),e.run();case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),t}()}).call(this,"/")},,,,,function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var n=i(3),a=i(9),s=i(1),o=i(2),r=i(11),h=i(8),l=Object(r.a)(Object(r.a)(Object(r.a)(Object(r.a)({},h.b),h.d),h.c),h.e),u=function(){function t(){Object(s.a)(this,t),this._previousKeyboardKeys={},this._pressed={},this.shiftDown=!1,this.lastPressed=void 0,this.charKeys=void 0,this.codes={},this.charCodes=[],this.codesShift={},this.charKeys=Object.keys(h.e).concat(Object.keys(h.d)).concat(Object.keys(h.c));for(var e=0,i=Object.entries(l);e<i.length;e++){var o=Object(a.a)(i[e],2),r=o[0],u=o[1];this.codes[u]=r}var c,d=Object(n.a)(this.charKeys);try{for(d.s();!(c=d.n()).done;){var p=c.value;this.charCodes.push(l[p])}}catch(g){d.e(g)}finally{d.f()}for(var f=0,m=Object.keys(h.f);f<m.length;f++){var v=m[f],y=h.f[v];this.codesShift[y]=v}}return Object(o.a)(t,[{key:"keyboardDownOnce",value:function(t){return!this._previousKeyboardKeys[t]&&this.isDown(t)?(this._previousKeyboardKeys[t]=!0,!0):(this._previousKeyboardKeys[t]&&!this.isDown(t)&&(this._previousKeyboardKeys[t]=!1),!1)}},{key:"lastPressedIsChar",value:function(){var t=this.lastPressed;return!(!t||-1===this.charCodes.indexOf(t))}},{key:"lastPressedChar",value:function(){var t=this.lastPressed;if(t){if(this.shiftDown){var e=this.codesShift[t];return e&&-1!==Object.keys(h.f).indexOf(e)?this.codesShift[t]:this.codes[t].toUpperCase()}return this.codes[t].toLowerCase()}}},{key:"isDown",value:function(t){return this._pressed[t]}},{key:"onKeydown",value:function(t){this.shiftDown=t.shiftKey,this.lastPressed=t.keyCode,this._pressed[t.keyCode]=!0}},{key:"onKeyup",value:function(t){this._pressed[t.keyCode]=!1}},{key:"keyByCode",value:function(t){return this.codes[t]}},{key:"pressedCodes",get:function(){return this._pressed}}]),t}()},,,function(t,e,i){"use strict";(function(t){e.a=function(){var e=t.performance&&t.performance.now?t.performance.now.bind(performance):Date.now,i=e(),n=i,a=0,s=[0],o=function(t,e,i){var n=document.createElement(t);return n.id=e,n.style.cssText=i,n},r=function(t,e,i){var n=o("div",t,"padding:0 0 3px 3px;text-align:left;background:"+i),a=o("div",t+"Text","font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px;color:"+e);a.innerHTML=t.toUpperCase(),n.appendChild(a);var s=o("div",t+"Graph","width:74px;height:30px;background:"+e);n.appendChild(s);for(var r=0;r<74;r++)s.appendChild(o("span","","width:1px;height:30px;float:left;opacity:0.9;background:"+i));return n},h=function(t){for(var e=u.children,i=0;i<e.length;i++)t.indexOf(i)<0?e[i].style.display="none":e[i].style.display="block";s=t},l=function(t,e){t.appendChild(t.firstChild).style.height=Math.min(30,30-30*e)+"px"},u=o("div","stats","width:80px;opacity:0.9;cursor:pointer"),c=0,d=Number.POSITIVE_INFINITY,p=0,f=r("fps","#0ff","#002"),m=f.children[0],v=f.children[1];u.appendChild(f);var y=0,g=Number.POSITIVE_INFINITY,w=0,b=r("ms","#0f0","#020"),k=b.children[0],x=b.children[1];u.appendChild(b);var O=0,j=Number.POSITIVE_INFINITY,_=0,S=r("mb","#f08","#201"),I=S.children[0],z=S.children[1];return t.performance&&t.performance.memory&&u.appendChild(S),h([s]),{REVISION:14,domElement:u,setMode:function(t){for(var e=u.children,i=0;i<e.length;i++)e[i].style.display=i===t?"block":"none";s=[t]},setModes:h,begin:function(){i=e()},end:function(){var t=e();if(y=t-i,g=Math.min(g,y),w=Math.max(w,y),k.textContent=(0|y)+" MS ("+(0|g)+"-"+(0|w)+")",l(x,y/200),a++,t>n+1e3&&(c=Math.round(1e3*a/(t-n)),d=Math.min(d,c),p=Math.max(p,c),m.textContent=c+" FPS ("+d+"-"+p+")",l(v,c/100),n=t,a=0,"undefined"!==typeof O&&performance&&performance.memory)){var s=performance.memory.usedJSHeapSize,o=performance.memory.jsHeapSizeLimit;O=Math.round(954e-9*s),j=Math.min(j,O),_=Math.max(_,O),I.textContent=O+" MB ("+j+"-"+_+")",l(z,s/o)}return t},update:function(){i=this.end()}}}}).call(this,i(17))},function(t,e,i){"use strict";var n=i(9),a=i(3),s=i(1),o=i(2),r=i(8),h=i(12),l=function(){function t(e,i){Object(s.a)(this,t),this.state=void 0,this.gamepad=void 0,this.keyboard=void 0,this.state=i;var n=e.get("keyboard"),a=e.get("gamepad");if(!(n instanceof h.a))throw new Error("No keyboard input");this.keyboard=n.keyboard,this.gamepad=null===a||void 0===a?void 0:a.gamepad}return Object(o.a)(t,[{key:"update",value:function(){var t,e,i,n=this.state,a=n.currentMenu.selectedItem;a.isEditing||(this.keyboard.keyboardDownOnce(r.b.UP)||(null===(e=this.gamepad)||void 0===e?void 0:e.isStickDown("left","up"))?n.currentMenu.moveUp():(this.keyboard.keyboardDownOnce(r.b.DOWN)||(null===(i=this.gamepad)||void 0===i?void 0:i.isStickDown("left","down")))&&n.currentMenu.moveDown());a.editable&&a.isEditing&&(this.keyboard.keyboardDownOnce(r.b.BACKSPACE)?a.value=a.value.slice(0,-1):this.keyboard.lastPressedIsChar()&&this.keyboard.keyboardDownOnce(r.a[this.keyboard.keyByCode(this.keyboard.lastPressed)])&&(a.value+=this.keyboard.lastPressedChar())),(this.keyboard.keyboardDownOnce(r.b.ENTER)||this.keyboard.keyboardDownOnce(r.b.SPACE)||(null===(t=this.gamepad)||void 0===t?void 0:t.gamepadButtonDownOnce("actionSouth")))&&n.currentMenu.selectCurrentItem()}}]),t}(),u=i(7),c=i(4),d=i(6),p=i(5),f=i(0),m=function(){function t(){Object(s.a)(this,t),this.width=void 0,this.height=void 0,this._initialized=void 0,this.clearColor=void 0,this.viewContainers=void 0,this.currentViewContainerName=void 0,this._currentViewContainer=void 0,this._scene=void 0,this.width=0,this.height=0,this._initialized=!1,this.clearColor=0,this.viewContainers=new Map,this.currentViewContainer=null}return Object(o.a)(t,[{key:"init",value:function(){this._scene=new f.q;var t,e=Object(a.a)(this.viewContainers.entries());try{for(e.s();!(t=e.n()).done;){var i=Object(n.a)(t.value,2),s=i[0],o=i[1];o.init(),o.width=this.width,o.height=this.height,this._scene.add(o.mesh),s===this.currentViewContainerName?(o.visible=!0,this._currentViewContainer=o):o.visible=!1}}catch(r){e.e(r)}finally{e.f()}}},{key:"scene",get:function(){var t=this._scene;if(!t)throw new Error("Scene is undefined");return t}},{key:"update",value:function(t){this._currentViewContainer?this._currentViewContainer.update(t):console.warn("no current ViewContainer")}},{key:"changeSize",value:function(t){this.width=t.width,this.height=t.height,this.init()}},{key:"currentViewContainer",get:function(){return this._currentViewContainer},set:function(t){var e=this.viewContainers.get(t);this._initialized&&(this._currentViewContainer&&(this._currentViewContainer.visible=!1),e.visible=!0),this.currentViewContainerName=t,this._currentViewContainer=e}},{key:"addViewContainer",value:function(t,e){this._initialized&&(e.init(),e.width=this.width,e.height=this.height,this.scene.add(e.mesh)),this.viewContainers.set(t,e)}}]),t}(),v=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).camera=void 0,n.state=void 0,n.menu=void 0,n.state=t,n.menu=t.menus,n}return Object(o.a)(i,[{key:"init",value:function(){Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this),this.camera=new f.m(0,this.width,this.height,0,0,1),this._initialized=!0}},{key:"changeSize",value:function(t){Object(u.a)(Object(c.a)(i.prototype),"changeSize",this).call(this,t),this.init()}},{key:"update",value:function(t){Object(u.a)(Object(c.a)(i.prototype),"update",this).call(this,t),this.currentViewContainerName!==this.state.currentMenuName&&(this.currentViewContainer=this.state.currentMenuName)}},{key:"getCamera",value:function(){return this.camera}}]),i}(m),y=i(10),g=function(){function t(e,i){Object(s.a)(this,t),this.effectsSpriteName=void 0,this.backgroundSpriteName=void 0,this.effects=void 0,this.backgrounds=void 0,this._initialized=void 0,this.effectsSpriteName=e,this.backgroundSpriteName=i,this.effects=null,this.backgrounds=null,this._initialized=!1}return Object(o.a)(t,[{key:"init",value:function(){this.effectsSpriteName&&(this.effects=y.a.getAudioSprite(this.effectsSpriteName).sound),this.backgroundSpriteName&&(this.backgrounds=y.a.getAudioSprite(this.backgroundSpriteName).sound),this._initialized=!0}},{key:"stopEffects",value:function(){this.effects&&this.effects.stop()}},{key:"stopBackground",value:function(){this.backgrounds&&this.backgrounds.stop()}}]),t}(),w=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t,n,a){var o;return Object(s.a)(this,i),(o=e.call(this,n,a)).selectedItem=void 0,o.state=void 0,o.state=t,o.selectedItem=t.currentMenu.selectedItem,o}return Object(o.a)(i,[{key:"update",value:function(t){this.selectedItem!==this.state.currentMenu.selectedItem&&(this.selectedItem=this.state.currentMenu.selectedItem,this.effects.play("select"))}}]),i}(g),b=function(){function t(){Object(s.a)(this,t),this.menuItems=new Map,this.menuItemKeys=[],this.selectedItemIndex=0,this.freeze=!1}return Object(o.a)(t,[{key:"addMenuItem",value:function(t){this.menuItemKeys.push(t.name),this.menuItems.set(t.name,t)}},{key:"selectedItem",get:function(){return this.menuItems.get(this.menuItemKeys[this.selectedItemIndex])}},{key:"moveUp",value:function(){this.freeze||(this.selectedItemIndex>0?this.selectedItemIndex-=1:this.selectedItemIndex=0)}},{key:"moveDown",value:function(){this.freeze||(this.selectedItemIndex<this.menuItemKeys.length-1?this.selectedItemIndex+=1:this.selectedItemIndex=this.menuItemKeys.length-1)}},{key:"selectCurrentItem",value:function(){this.selectedItem.action()}}]),t}(),k=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(s.a)(this,t),this.name=e,this.text=i,this.onAction=n,this.editable=!1}return Object(o.a)(t,[{key:"action",value:function(){this.onAction&&this.onAction(this)}}]),t}(),x=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t,n,a,o){var r;return Object(s.a)(this,i),(r=e.call(this,t,n+": "+a,o)).label=n,r.defaultValue=a,r.isEditing=!1,r._value=a,r.editable=!0,r}return Object(o.a)(i,[{key:"action",value:function(){this.isEditing=!this.isEditing,!this.isEditing&&this.onAction&&this.onAction(this._value)}},{key:"value",get:function(){return this._value},set:function(t){this._value=t,this.text=this.label+": "+t}}]),i}(k),O=function(){function t(e,i){if(Object(s.a)(this,t),this.mapping=y.a.getAtlasMapping(e),!this.mapping)throw new Error("TextureAtlas does not exists",e);this.texture=i?y.a.cloneTexture(e):y.a.getTexture(e),this.texture.wrapS=f.p,this.texture.wrapT=f.p,this.width=this.mapping.meta.size.w,this.height=this.mapping.meta.size.h,this.frames=new Map;var n,o=Object(a.a)(this.mapping.frames);try{for(o.s();!(n=o.n()).done;){var r=n.value,h=r.frame,l=[new f.u(h.x/this.width,(this.height-h.y)/this.height),new f.u(h.x/this.width,(this.height-(h.y+h.h))/this.height),new f.u((h.x+h.w)/this.width,(this.height-(h.y+h.h))/this.height),new f.u((h.x+h.w)/this.width,(this.height-h.y)/this.height)];this.frames.set(r.filename,{bounds:l,frame:r,framePosition:{x:h.x,y:h.y},frameSize:{width:h.w,height:h.h}})}}catch(u){o.e(u)}finally{o.f()}}return Object(o.a)(t,[{key:"getFrameOffset",value:function(t){var e=this.frames.get(t+".png").framePosition;return new f.u(e.x/this.width,(this.height-e.y)/this.height)}},{key:"getFrameSize",value:function(t){return this.frames.get(t+".png").frameSize}},{key:"getBounds",value:function(t){return this.frames.get(t+".png").bounds}}]),t}(),j=new Map,_=function(){function t(){Object(s.a)(this,t)}return Object(o.a)(t,null,[{key:"getAtlas",value:function(t,e){if(e)return new O(t,e);var i=j.get(t);return i||(i=new O(t),j.set(t,i)),i}}]),t}(),S=function(){function t(e,i,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Object(s.a)(this,t),this.textureAtlas=e,this.geometry=i,this.fixed=a,n&&(this.frame=n,a)){var o=this.textureAtlas.getFrameSize(n);this._changeSize(o.width,o.height)}}return Object(o.a)(t,[{key:"texture",get:function(){return this.textureAtlas.texture}},{key:"_changeSize",value:function(t,e){this.width=t,this.height=e;var i=this.textureAtlas.width,n=this.textureAtlas.height;if(this.geometry){for(var a=[new f.u(0,n/n),new f.u(0,(n-e)/n),new f.u(t/i,(n-e)/n),new f.u(t/i,n/n)],s=1;s<this.geometry.faceVertexUvs[0].length;s+=2)this.geometry.faceVertexUvs[0][s-1]=[a[0],a[1],a[3]],this.geometry.faceVertexUvs[0][s]=[a[1],a[2],a[3]];this.geometry.uvsNeedUpdate=!0}}},{key:"frame",set:function(t){var e=this.textureAtlas.getFrameOffset(t),i=this.textureAtlas.getFrameSize(t);this.fixed||i.width===this.width&&i.height===this.height||this._changeSize(i.width,i.height),this.texture.offset=e}}]),t}(),I=function(){function t(){Object(s.a)(this,t),this.mesh=null,this.initialPosition=null,this._initialized=!1}return Object(o.a)(t,[{key:"init",value:function(){if(this.initialPosition){if(!this.mesh)throw new Error("No mesh initialized!");this.mesh.position.x=this.initialPosition.x,this.mesh.position.y=this.initialPosition.y,this.mesh.position.z=this.initialPosition.z}this._initialized=!0}},{key:"position",get:function(){return this.mesh.position},set:function(t){var e=t.x,i=t.y,n=t.z;this.mesh&&this.initialized?(e&&(this.mesh.position.x=e),i&&(this.mesh.position.y=i),n&&(this.mesh.position.z=n)):this.initialPosition={x:e,y:i,z:n}}}]),t}(),z=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t,n){var a;return Object(s.a)(this,i),(a=e.call(this)).textureName=t,a.textureAtlasName=n,a._width=null,a._height=null,a._lightness=1,a}return Object(o.a)(i,[{key:"init",value:function(){var t=_.getAtlas(this.textureAtlasName,!0),e=t.getFrameSize(this.textureName);this._width=e.width,this._height=e.height,this.geometry=new f.o(e.width,e.height);var n=new S(t,this.geometry,this.textureName);this.material=new f.j({map:n.texture,transparent:!0});var a=this.material.color.getHSL();this.material.color.setHSL(a.h,a.s,this._lightness),this.mesh=new f.i(this.geometry,this.material),Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}},{key:"lightness",get:function(){return this._lightness},set:function(t){if(this._initalized){var e=this.material.color.getHSL();this.material.color.setHSL(e.h,e.s,t)}this._lightness=t}},{key:"width",set:function(t){var e=t/this._width;this.mesh.scale.x=e,this.mesh.position.x=t/2}},{key:"height",set:function(t){var e=t/this._height;this.mesh.scale.y=e,this.mesh.position.y=t/2}}]),i}(I),P=function(){function t(){Object(s.a)(this,t),this.staticViews=new Set,this.dynamicViews=new Set,this._backgroundView=null,this._width=800,this._height=600,this._initialized=!1}return Object(o.a)(t,[{key:"init",value:function(){this.mesh=new f.l,this._backgroundView&&(this._backgroundView.init(),this._backgroundView.width=this._width,this._backgroundView.height=this._height,this._backgroundView.mesh.renderOrder=-1,this.mesh.add(this._backgroundView.mesh));var t,e=Object(a.a)(this.staticViews);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.init(),this.mesh.add(i.mesh)}}catch(r){e.e(r)}finally{e.f()}var n,s=Object(a.a)(this.dynamicViews);try{for(s.s();!(n=s.n()).done;){var o=n.value;o.init(),this.mesh.add(o.mesh)}}catch(r){s.e(r)}finally{s.f()}this._initialized=!0}},{key:"backgroundView",set:function(t){t!==this._backgroundView?(this._initialized&&(this._backgroundView.init(),this._backgroundView.width=this._width,this._backgroundView.height=this._height,this._backgroundView.mesh.renderOrder=-1,this.mesh.remove(this._backgroundView)),this._backgroundView=t):console.warn("backgroundView is the same")}},{key:"update",value:function(t){if(!this._initialized)throw new Error("View not initialized.");var e,i=Object(a.a)(this.dynamicViews);try{for(i.s();!(e=i.n()).done;){e.value.update(t)}}catch(n){i.e(n)}finally{i.f()}}},{key:"addStaticView",value:function(t,e){this._initialized&&(t.init(),this.mesh.add(t.mesh)),e&&(t.position={x:e.x,y:e.y,z:e.z}),this.staticViews.add(t)}},{key:"addDynamicView",value:function(t,e){this._initialized&&(t.init(),this.mesh.add(t.mesh)),e&&(t.position={x:e.x,y:e.y,z:e.z}),this.dynamicViews.add(t)}},{key:"visible",get:function(){return this.mesh.visible},set:function(t){this.mesh.visible=t}},{key:"width",set:function(t){var e=t/this._width;this._width=t,this._backgroundView&&(this._backgroundView.width=this._width),this.mesh.scale.x=e,this.mesh.updateMatrix(),this.mesh.updateMatrixWorld(!0)}},{key:"height",set:function(t){var e=t/this._height;this._height=t,this._backgroundView&&(this._backgroundView.height=this._height),this.mesh.scale.y=e,this.mesh.updateMatrix(),this.mesh.updateMatrixWorld(!0)}}]),t}(),V=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t,n){var a;return Object(s.a)(this,i),(a=e.call(this)).textureName=t,a.textureAtlasName=n,a}return Object(o.a)(i,[{key:"init",value:function(){var t=_.getAtlas(this.textureAtlasName,!0),e=t.getFrameSize(this.textureName);this.geometry=new f.o(e.width,e.height);var n=new S(t,this.geometry,this.textureName),a=new f.j({map:n.texture,transparent:!0});this.mesh=new f.i(this.geometry,a),Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}}]),i}(I),M=i(28);var C={min:[0,0],max:[0,0]};function A(t){var e=t.length/2;C.min[0]=t[0],C.min[1]=t[1],C.max[0]=t[0],C.max[1]=t[1];for(var i=0;i<e;i++){var n=t[2*i],a=t[2*i+1];C.min[0]=Math.min(n,C.min[0]),C.min[1]=Math.min(a,C.min[1]),C.max[0]=Math.max(n,C.max[0]),C.max[1]=Math.max(a,C.max[1])}}var T=i(29),B=i(19),D=i(20),N=["x","e","a","o","n","s","r","c","u","m","v","w","z"],R=["m","w"],E=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],F="\t".charCodeAt(0),G=" ".charCodeAt(0);function W(t){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(t)}function L(t){return new Function(["return function "+t+"() {","  return this._"+t,"}"].join("\n"))()}function H(t,e){if(!t.chars||0===t.chars.length)return null;var i=K(t.chars,e);return i>=0?t.chars[i]:null}function U(t,e,i){if(!t.kernings||0===t.kernings.length)return 0;for(var n=t.kernings,a=0;a<n.length;a++){var s=n[a];if(s.first===e&&s.second===i)return s.amount}return 0}function K(t,e,i){for(var n=i=i||0;n<t.length;n++)if(t[n].id===e)return n;return-1}W.prototype.update=function(t){if(t=B({measure:this._measure},t),this._opt=t,this._opt.tabSize=D(this._opt.tabSize,4),!t.font)throw new Error("must provide a valid bitmap font");var e=this.glyphs,i=t.text||"",n=t.font;this._setupSpaceGlyphs(n);var a=T.lines(i,t),s=t.width||0;e.length=0;var o=a.reduce((function(t,e){return Math.max(t,e.width,s)}),0),r=0,h=0,l=D(t.lineHeight,n.common.lineHeight),u=n.common.base,c=l-u,d=t.letterSpacing||0,p=l*a.length-c,f=function(t){if("center"===t)return 1;if("right"===t)return 2;return 0}(this._opt.align);h-=p,this._width=o,this._height=p,this._descender=l-u,this._baseline=u,this._xHeight=function(t){for(var e=0;e<N.length;e++){var i=N[e].charCodeAt(0),n=K(t.chars,i);if(n>=0)return t.chars[n].height}return 0}(n),this._capHeight=function(t){for(var e=0;e<E.length;e++){var i=E[e].charCodeAt(0),n=K(t.chars,i);if(n>=0)return t.chars[n].height}return 0}(n),this._lineHeight=l,this._ascender=l-c-this._xHeight;var m=this;a.forEach((function(t,a){for(var s,u=t.start,c=t.end,p=t.width,v=u;v<c;v++){var y=i.charCodeAt(v),g=m.getGlyph(n,y);if(g){s&&(r+=U(n,s.id,g.id));var w=r;1===f?w+=(o-p)/2:2===f&&(w+=o-p),e.push({position:[w,h],data:g,index:v,line:a}),r+=g.xadvance+d,s=g}}h+=l,r=0})),this._linesTotal=a.length},W.prototype._setupSpaceGlyphs=function(t){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,t.chars&&0!==t.chars.length){var e=H(t,G)||function(t){for(var e=0;e<R.length;e++){var i=R[e].charCodeAt(0),n=K(t.chars,i);if(n>=0)return t.chars[n]}return 0}(t)||t.chars[0],i=this._opt.tabSize*e.xadvance;this._fallbackSpaceGlyph=e,this._fallbackTabGlyph=B(e,{x:0,y:0,xadvance:i,id:F,xoffset:0,yoffset:0,width:0,height:0})}},W.prototype.getGlyph=function(t,e){var i=H(t,e);return i||(e===F?this._fallbackTabGlyph:e===G?this._fallbackSpaceGlyph:null)},W.prototype.computeMetrics=function(t,e,i,n){var a,s=this._opt.letterSpacing||0,o=this._opt.font,r=0,h=0,l=0;if(!o.chars||0===o.chars.length)return{start:e,end:e,width:0};i=Math.min(t.length,i);for(var u=e;u<i;u++){var c,d=t.charCodeAt(u);if(c=this.getGlyph(o,d)){c.xoffset;var p=(r+=a?U(o,a.id,c.id):0)+c.xadvance+s,f=r+c.width;if(f>=n||p>=n)break;r=p,h=f,a=c}l++}return a&&(h+=a.xoffset),{start:e,end:e+l,width:h}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach((function(t){Object.defineProperty(W.prototype,t,{get:L(t),configurable:!0})}));var q=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t){var n;return Object(s.a)(this,i),"string"===typeof t&&(t={text:t}),(n=e.call(this))._opt=Object.assign({},t),t&&n.update(t),n}return Object(o.a)(i,[{key:"update",value:function(t){if("string"===typeof t&&(t={text:t}),!(t=Object.assign({},this._opt,t)).font)throw new TypeError("must specify a { font } in options");this.layout=function(t){return new W(t)}(t);var e=!1!==t.flipY,i=t.font,n=i.common.scaleW,a=i.common.scaleH,s=this.layout.glyphs.filter((function(t){var e=t.data;return e.width*e.height>0}));this.visibleGlyphs=s;var o=function(t){var e=new Float32Array(4*t.length*2),i=0;return t.forEach((function(t){var n=t.data,a=t.position[0]+n.xoffset,s=t.position[1]+n.yoffset,o=n.width,r=n.height;e[i++]=a,e[i++]=s,e[i++]=a,e[i++]=s+r,e[i++]=a+o,e[i++]=s+r,e[i++]=a+o,e[i++]=s})),e}(s),r=function(t,e,i,n){var a=new Float32Array(4*t.length*2),s=0;return t.forEach((function(t){var o=t.data,r=o.x+o.width,h=o.y+o.height,l=o.x/e,u=o.y/i,c=r/e,d=h/i;n&&(u=(i-o.y)/i,d=(i-h)/i),a[s++]=l,a[s++]=u,a[s++]=l,a[s++]=d,a[s++]=c,a[s++]=d,a[s++]=c,a[s++]=u})),a}(s,n,a,e),h=M([],{clockwise:!0,type:"uint16",count:s.length});if(this.setIndex(h),this.addAttribute("position",new f.c(o,2)),this.addAttribute("uv",new f.c(r,2)),!t.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(t.multipage){var l=function(t){var e=new Float32Array(4*t.length),i=0;return t.forEach((function(t){var n=t.data.page||0;e[i++]=n,e[i++]=n,e[i++]=n,e[i++]=n})),e}(s);this.addAttribute("page",new f.c(l,1))}}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new f.r);var t=this.attributes.position.array,e=this.attributes.position.itemSize;if(!t||!e||t.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);!function(t,e){A(t);var i=C.min[0],n=C.min[1],a=C.max[0]-i,s=C.max[1]-n,o=Math.sqrt(a*a+s*s);e.center.set(i+a/2,n+s/2,0),e.radius=o/2}(t,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new f.b);var t=this.boundingBox,e=this.attributes.position.array,i=this.attributes.position.itemSize;!e||!i||e.length<2?t.makeEmpty():function(t,e){A(t),e.min.set(C.min[0],C.min[1],0),e.max.set(C.max[0],C.max[1],0)}(e,t)}}]),i}(f.d),X=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,i),n=e.call(this);var o=a.font||"keep_calm";return n._text=t,n.font=y.a.getFont(o),n.width=a.width||100,n.align=a.aligh||"left",n._color=a.color||16711680,n}return Object(o.a)(i,[{key:"init",value:function(){this.geometry=new q({text:this._text,width:this.width,align:this.align,font:this.font.mapping,multipage:!0}),this.material=new f.j({map:this.font.textures[0],transparent:!0,color:this._color}),this.mesh=new f.i(this.geometry,this.material),this.mesh.rotation.y=Math.PI/180*180,this.mesh.rotation.z=Math.PI/180*180,Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}},{key:"color",get:function(){return this._color},set:function(t){this.material.color.setHex(t)}},{key:"text",get:function(){return this._text},set:function(t){(t=t.toString())!==this._text&&(this._text=t,this._updateGeometry())}},{key:"height",get:function(){return this.geometry.layout.height}},{key:"_updateGeometry",value:function(){this.geometry.update({text:this._text,width:this.width,align:this.align,font:this.font.mapping}),this.geometry.uvsNeedUpdate=!0}}]),i}(I),Y=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{selectedTextColor:65280,textColor:16768477};return Object(s.a)(this,i),(n=e.call(this)).menu=t,n.options=a,n.viewMenuItemPairs=new Map,n.selectedItem=null,n.selectedView=null,n.logoView=new V("logo","ui"),n}return Object(o.a)(i,[{key:"init",value:function(){this.mesh=new f.l;var t=0;this.selectedItem=this.menu.selectedItem;var e,n=Object(a.a)(this.menu.menuItems.values());try{for(n.s();!(e=n.n()).done;){var s=e.value,o=new X(s.text,{width:300});o.init(),o.mesh.position.y=200-100*t,o.mesh.position.x+=100,this.selectedItem===s?o.color=this.options.selectedTextColor:o.color=this.options.textColor,this.viewMenuItemPairs.set(s,o),this.mesh.add(o.mesh),t+=1}}catch(r){n.e(r)}finally{n.f()}Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}},{key:"update",value:function(){if(this.selectedItem!==this.menu.selectedItem){var t=this.selectedItem;this.selectedItem=this.menu.selectedItem;var e=this.viewMenuItemPairs.get(this.selectedItem),i=this.viewMenuItemPairs.get(t);e.text=this.selectedItem.text,i.color=this.options.textColor,e.color=this.options.selectedTextColor}this.menu.selectedItem.editable&&this.menu.selectedItem.isEditing?this.viewMenuItemPairs.get(this.selectedItem).text=this.selectedItem.text+"-":this.viewMenuItemPairs.get(this.selectedItem).text=this.selectedItem.text}}]),i}(I),Z={create:function(t){var e=new b,i=new P;e.addMenuItem(new x("name","Name","Unknown Soldier",(function(e){t.changeOption("name",e)}))),e.addMenuItem(new k("back","- back",(function(){t.currentMenu="main"}))),i.addDynamicView(new Y(e),{x:300,y:100,z:0});var n=new z("iwo_jima","ui");return n.lightness=.5,i.backgroundView=n,{viewContainer:i,menu:e}}},J={create:function(t){var e=new b,i=new P;e.addMenuItem(new k("back","- back",(function(){t.currentMenu="main"}))),i.addDynamicView(new Y(e),{x:300,y:100,z:0});var n=new z("iwo_jima","ui");return n.lightness=.5,i.backgroundView=n,{viewContainer:i,menu:e}}},Q=i(14),$=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t,n,a){var o;return Object(s.a)(this,i),(o=e.call(this,"play",t)).collisionSystem=void 0,o.bulletSystem=void 0,o.player=void 0,o.map=void 0,o.match=void 0,o.showScores=!1,o.paused=!1,o.onPause=void 0,o.map=a,o.match=n,o}return Object(o.a)(i,[{key:"init",value:function(){Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}},{key:"soldiers",get:function(){return this.match.soldiers}},{key:"pause",value:function(){this.onPause&&this.onPause(),this.paused=!0}},{key:"resume",value:function(){this.paused=!1}},{key:"update",value:function(t){if(Object(u.a)(Object(c.a)(i.prototype),"updateInputs",this).call(this,t),!this.paused){Object(u.a)(Object(c.a)(i.prototype),"updateAudio",this).call(this,t),this.bulletSystem&&this.bulletSystem.update(t);var e,n=Object(a.a)(this.soldiers);try{for(n.s();!(e=n.n()).done;){var s=e.value;if(s.update(t),s.dead){var o=this.map.randomRespawnPosition();s.respawn(o)}}}catch(r){n.e(r)}finally{n.f()}this.match.update(t),this.collisionSystem&&this.collisionSystem.update(t)}}}]),i}(Q.a),tt=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).camera=void 0,n.state=void 0,n.state=t,n}return Object(o.a)(i,[{key:"init",value:function(){Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this),this.camera=new f.m(0,this.width,this.height,0,0,1),this._initialized=!0}},{key:"update",value:function(t){Object(u.a)(Object(c.a)(i.prototype),"update",this).call(this,t)}},{key:"changeSize",value:function(t){Object(u.a)(Object(c.a)(i.prototype),"changeSize",this).call(this,t),this.init()}},{key:"getCamera",value:function(){return this.camera}}]),i}(m),et=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).player=t.player,n}return Object(o.a)(i,[{key:"init",value:function(){this.mesh=new f.l;var t=_.getAtlas("ui",!1),e=new f.j({map:t.texture,transparent:!0}),n=t.getFrameSize("ammo");this.geometry=new f.o(n.width,n.height),this.textureFrame=new S(t,this.geometry,"ammo");var a=new f.i(this.geometry,e);a.scale.set(.5,.5,1),this.magazineText=new X("0",{color:16777164}),this.magazineText.init(),this.magazineText.mesh.scale.set(2,2,1),this.magazineText.position={x:n.width+10,y:-this.magazineText.height},this.mesh.add(this.magazineText.mesh),this.ammoText=new X("0",{color:16777113}),this.ammoText.init(),this.ammoText.mesh.scale.set(1,1,1),this.ammoText.position={x:n.width+64,y:-this.ammoText.height},a.position.x=20,this.magazineText.position.x=40,this.ammoText.position.x=120,this.mesh.add(this.ammoText.mesh),this.mesh.add(a),Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}},{key:"ammo",set:function(t){null===t&&(this.ammoText.text="-"),this.ammoText.text=t}},{key:"magazine",set:function(t){null===t&&(this.magazineText.text="-"),this.magazineText.text=t}},{key:"update",value:function(t){if(this.player.currentWeapon){var e=this.player.currentWeapon;this.ammo=e.ammo,this.magazine=e.magazine}else this.ammo=null,this.magazine=null}}]),i}(I),it=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).player=t.player,n._healthScale=1,n}return Object(o.a)(i,[{key:"init",value:function(){var t=new f.j({color:13369344});this.geometry=new f.o(200,20),this.geometry.applyMatrix((new f.h).makeTranslation(100,0,0)),this.mesh=new f.i(this.geometry,t),Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}},{key:"healthScale",set:function(t){if(t!==this._healthScale)if(this._healthScale=t,t<=0)this.mesh.visible=!1;else{this.mesh.visible||(this.mesh.visible=!0);var e=this.mesh.position.x;this.mesh.scale.set(t,1,1),this.mesh.position.x=e}}},{key:"update",value:function(){this.healthScale=this.player.health/this.player.maxHealth}}]),i}(I),nt=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).player=t.player,n._weapon=null,n}return Object(o.a)(i,[{key:"init",value:function(){var t=_.getAtlas("ui",!0);this.geometry=new f.o(196,64),this.textureFrame=new S(t,this.geometry),this.material=new f.j({map:this.textureFrame.texture,transparent:!0}),this.mesh=new f.i(this.geometry,this.material),Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}},{key:"weapon",set:function(t){this._weapon!==t?(this.mesh.visible||(this.mesh.visible=!0),this._weapon=t,this.textureFrame.frame=t):null===t&&this.mesh.visible&&(this.mesh.visible=!1)}},{key:"update",value:function(t){if(this.player.currentWeapon){var e=this.player.currentWeapon;this.weapon=e.name}else this.weapon=null}}]),i}(I);var at=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).state=t,n.match=t.match,n}return Object(o.a)(i,[{key:"init",value:function(){this.mesh=new f.l;var t=new f.k({color:0,transparent:!0,opacity:.5}),e=new f.o(600,800);this.mesh.add(new f.i(e,t)),this.scoreTextView=new X(this._scoreText,{color:16711552,width:600,align:"left"}),this.scoreTextView.init(),this.mesh.visible=!1,this.mesh.add(this.scoreTextView.mesh),Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}},{key:"update",value:function(){this.state.showScores?(this.mesh.visible||(this.mesh.visible=!0),this.scoreTextView.text=function(t){var e,i="",s=Object(a.a)(t.entries());try{for(s.s();!(e=s.n()).done;){var o=Object(n.a)(e.value,2),r=o[0],h=o[1];i+="".concat(r," - k: ").concat(h.kills," - d: ").concat(h.deaths," \n");var l,u=[],c=Object(a.a)(h.soldiers);try{for(c.s();!(l=c.n()).done;){var d=l.value,p="".concat(d.name," - k: ").concat(d.totalKills," - d: ").concat(d.totalDeaths);u.push(p)}}catch(f){c.e(f)}finally{c.f()}i+=u.join("\n"),i+="\n----------------------\n"}}catch(f){s.e(f)}finally{s.f()}return i}(this.match.sortedScores())):this.mesh.visible&&(this.mesh.visible=!1)}}]),i}(I),st=function(){function t(e,i,n,a){Object(s.a)(this,t),this.factoryFunction=void 0,this.totalInstances=0,this.allocationLimit=void 0,this.allocationNumber=void 0,this.availableInstances=void 0,this.factoryFunction=e,this.allocationLimit=a,this.allocationNumber=n,this.availableInstances=[],this.allocate(i)}return Object(o.a)(t,[{key:"size",get:function(){return this.totalInstances}},{key:"allocate",value:function(t){if(!(this.totalInstances+t<this.allocationLimit))throw new Error("ObjectPool allocation limit reached");this.totalInstances+=t;for(var e=0;e<t;e++)this.availableInstances.push(this.factoryFunction());return this}},{key:"get",value:function(){return this.availableInstances.length<1&&this.allocate(this.allocationNumber),this.availableInstances.pop()}},{key:"free",value:function(t){return-1===this.availableInstances.indexOf(t)&&this.availableInstances.push(t),this}},{key:"clear",value:function(){for(;this.availableInstances.length;)this.availableInstances.pop();return this.totalInstances=0,this}}]),t}(),ot=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).bullet=t,n}return Object(o.a)(i,[{key:"init",value:function(){var t=this.bullet,e=_.getAtlas("world",!1);this.geometry=new f.o(2,8),this.textureFrame=new S(e,this.geometry,"bullet1"),this.material=new f.j({map:this.textureFrame.texture,transparent:!0}),this.mesh=new f.i(this.geometry,this.material),this.mesh.position.set(t.position.x,t.position.y,t.position.z),this.mesh.rotation.z=t.angle+Math.PI/180*90,Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}},{key:"update",value:function(t){var e=this.bullet.previousPosition,i=this.bullet.position;this.mesh.position.x=e.x+(i.x-e.x)*t,this.mesh.position.y=e.y+(i.y-e.y)*t,this.mesh.position.z=e.z+(i.z-e.z)*t,this.mesh.rotation.z=this.bullet.angle+Math.PI/180*90,this.bullet.dead?this.mesh.visible=!1:this.mesh.visible=!0}}]),i}(I),rt=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t,n){var a;return Object(s.a)(this,i),(a=e.call(this)).bulletSystem=void 0,a.bulletViewPool=void 0,a.bulletViewPairs=new WeakMap,a.bulletSystem=t,a.bulletViewPool=new st((function(){return new ot(null)}),a.bulletSystem.poolSize,10,n||200),a}return Object(o.a)(i,[{key:"init",value:function(){this.mesh=new f.l,Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}},{key:"update",value:function(t){this.bulletSystem.poolSize>this.bulletViewPool.size&&this.bulletViewPool.allocate(this.bulletSystem.poolSize-this.bulletViewPool.size);var e,i=Object(a.a)(this.bulletSystem.deadBullets);try{for(i.s();!(e=i.n()).done;){var n=e.value,s=this.bulletViewPairs.get(n);s&&s.update(t),this.bulletSystem.deadBullets.delete(n)}}catch(u){i.e(u)}finally{i.f()}var o,r=Object(a.a)(this.bulletSystem.activeBullets);try{for(r.s();!(o=r.n()).done;){var h=o.value,l=this.bulletViewPairs.get(h);l||((l=this.bulletViewPool.get()).bullet=h,l.init(),this.mesh.add(l.mesh),this.bulletViewPairs.set(h,l)),l.update(t)}}catch(u){r.e(u)}finally{r.f()}}}]),i}(I),ht=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",r=arguments.length>6&&void 0!==arguments[6]&&arguments[6];Object(s.a)(this,t),this.textureAtlas=e,this.geometry=i,this.textureFrame=new S(this.textureAtlas,i,o+a[0],r),this.interval=n,this.frames=a,this.framePrefix=o,this.currentFrameIndex=0,this.currentDisplayTime=0,this._updateTexture()}return Object(o.a)(t,[{key:"texture",get:function(){return this.textureAtlas.texture}},{key:"_updateTexture",value:function(){this.textureFrame.frame=this.framePrefix+this.frames[this.currentFrameIndex]}},{key:"reset",value:function(){this.currentFrameIndex=0,this.currentDisplayTime=0}},{key:"update",value:function(t){this.currentDisplayTime+=1,this.currentDisplayTime>this.interval&&(this.currentDisplayTime=0,this.currentFrameIndex++,this.currentFrameIndex>=this.frames.length&&(this.currentFrameIndex=0),this._updateTexture())}},{key:"currentFrame",get:function(){return this.frames[this.currentFrameIndex]}}]),t}(),lt=["animation_water_0001","animation_water_0002","animation_water_0003","animation_water_0004","animation_water_0005","animation_water_0006","animation_water_0007","animation_water_0008","animation_water_0009"];function ut(t,e){var i=[];if(t.walls.top){var n=e.getBounds(t.walls.top),a=new f.o(t.width,t.height);a.faceVertexUvs[0][0]=[n[0],n[1],n[3]],a.faceVertexUvs[0][1]=[n[1],n[2],n[3]],a.translate(0,0,t.height/2),i.push(a)}for(var s=new f.g,o=0,r=i;o<r.length;o++){var h=r[o];s.merge(h)}return s}var ct=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t,n){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:lt;return Object(s.a)(this,i),(a=e.call(this)).map=t,a._textureAtlasName=n,a._waterFrames=o,a.blocks=t.blocks(["water"]),a.blockWidth=t.blockWidth,a.blockHeight=t.blockHeight,a.blockDepth=t.blockDepth,a}return Object(o.a)(i,[{key:"init",value:function(){this.textureAtlas=_.getAtlas(this._textureAtlasName,!0),this.geometry=function(t,e){var i,n=new f.g,s=Object(a.a)(t);try{for(s.s();!(i=s.n()).done;){var o=i.value,r=ut(o,e);r.translate(o.position.x,o.position.y,o.position.z),n.merge(r)}}catch(h){s.e(h)}finally{s.f()}return n.mergeVertices(),n}(this.blocks,this.textureAtlas),this.animation=new ht(this.textureAtlas,this.geometry,9,!0,this._waterFrames,"",!0),this.animation.textureFrame.width=100,this.animation.textureFrame.height=100,this.material=new f.k({map:this.textureAtlas.texture,transparent:!1}),this.mesh=new f.i(this.geometry,this.material),this.mesh.applyMatrix((new f.h).makeTranslation(this.blockWidth/2,this.blockHeight/2,this.blockDepth/2)),Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}},{key:"update",value:function(){this.animation.update()}}]),i}(I);function dt(t,e){var i=[];if(t.walls.south){var n=e.getBounds(t.walls.south),a=new f.o(t.width,t.height);a.faceVertexUvs[0][0]=[n[0],n[1],n[3]],a.faceVertexUvs[0][1]=[n[1],n[2],n[3]],a.rotateY(Math.PI/2),a.translate(t.width/2,0,0),i.push(a)}if(t.walls.north){var s=e.getBounds(t.walls.north),o=new f.o(t.width,t.height);o.faceVertexUvs[0][0]=[s[0],s[1],s[3]],o.faceVertexUvs[0][1]=[s[1],s[2],s[3]],o.rotateY(-Math.PI/2),o.translate(-t.width/2,0,0),i.push(o)}if(t.walls.west){var r=e.getBounds(t.walls.west),h=new f.o(t.width,t.height);h.faceVertexUvs[0][0]=[r[0],r[1],r[3]],h.faceVertexUvs[0][1]=[r[1],r[2],r[3]],h.rotateX(Math.PI/2),h.translate(0,-t.height/2,0),i.push(h)}if(t.walls.east){var l=e.getBounds(t.walls.east),u=new f.o(t.width,t.height);u.faceVertexUvs[0][0]=[l[0],l[1],l[3]],u.faceVertexUvs[0][1]=[l[1],l[2],l[3]],u.rotateX(-Math.PI/2),u.rotateY(Math.PI/2),u.translate(0,t.height/2,0),i.push(u)}if(t.walls.top){var c=e.getBounds(t.walls.top),d=new f.o(t.width,t.height);d.faceVertexUvs[0][0]=[c[0],c[1],c[3]],d.faceVertexUvs[0][1]=[c[1],c[2],c[3]],d.translate(0,0,t.height/2),i.push(d)}for(var p=new f.g,m=0,v=i;m<v.length;m++){var y=v[m];p.merge(y)}return p}var pt=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t,n){var a;return Object(s.a)(this,i),(a=e.call(this)).map=t,a.textureAtlasName=n,a.blocks=t.blocks(["wall"]),a.blockWidth=t.blockWidth,a.blockHeight=t.blockHeight,a.blockDepth=t.blockDepth,a}return Object(o.a)(i,[{key:"init",value:function(){this.textureAtlas=_.getAtlas(this.textureAtlasName,!1),this.geometry=function(t,e){var i,n=new f.g,s=Object(a.a)(t);try{for(s.s();!(i=s.n()).done;){var o=i.value,r=dt(o,e);r.translate(o.position.x,o.position.y,o.position.z),n.merge(r)}}catch(h){s.e(h)}finally{s.f()}return n.mergeVertices(),n}(this.blocks,this.textureAtlas),this.material=new f.k({map:this.textureAtlas.texture,transparent:!0,side:f.e}),this.mesh=new f.i(this.geometry,this.material),this.mesh.applyMatrix((new f.h).makeTranslation(this.blockWidth/2,this.blockHeight/2,this.blockDepth/2)),Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}}]),i}(I),ft=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).light=t,n}return Object(o.a)(i,[{key:"init",value:function(){this.mesh=new f.l;var t=_.getAtlas("world",!0),e=new f.o(32,32);this.textureFrame=new S(t,e,"light1");var n=new f.k({map:this.textureFrame.texture,transparent:!0}),a=new f.i(e,n);a.position.set(this.light.sourcePosition.x,this.light.sourcePosition.y,this.light.sourcePosition.z),a.rotateZ(this.light.angle+Math.PI/180*90),this.mesh.add(a);var s=new f.s(267386880,1),o=new f.l;o.position.set(this.light.x,this.light.y,-this.light.z),o.rotateZ(this.light.angle+Math.PI/180*90),this.mesh.add(o),s.target=o,s.angle=Math.PI/180*45,s.position.set(this.light.sourcePosition.x,this.light.sourcePosition.y,this.light.sourcePosition.z),s.rotateZ(this.light.angle+Math.PI/180*90),this.mesh.add(s),this.mesh.translateX(50),this.mesh.translateY(50),this.mesh.translateZ(100),Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}}]),i}(I),mt=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).map=t,n.wallsView=new pt(t,"tiles"),n.waterView=new ct(t,"tiles"),n}return Object(o.a)(i,[{key:"init",value:function(){this.mesh=new f.l;var t,e=Object(a.a)(this.map.lights);try{for(e.s();!(t=e.n()).done;){var n=t.value,s=new ft(n);s.init(),this.mesh.add(s.mesh)}}catch(o){e.e(o)}finally{e.f()}this.wallsView.init(),this.waterView.init(),this.mesh.add(this.wallsView.mesh),this.mesh.add(this.waterView.mesh),Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}},{key:"update",value:function(){this.waterView.update()}}]),i}(I),vt=["walk_0001","walk_0002","walk_0003","walk_0004","walk_0005","walk_0006","walk_0007","walk_0008"],yt=["run_0001","run_0002","run_0003","run_0004","run_0005","run_0006","run_0007","run_0008"],gt=["idle_0001"],wt={american:27906,german:13421568},bt=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).soldier=t,n._team=t?t.team:"american",n}return Object(o.a)(i,[{key:"team",set:function(t){t!==this._team&&(this._team=t,this.material.color.setHex(wt[t]))}},{key:"init",value:function(){var t=this.soldier;this.geometry=new f.o(2*t.height,2*t.width),this.geometry.rotateZ(Math.PI);var e=_.getAtlas("soldier",!0);this.animations={walk:new ht(e,this.geometry,9,!0,vt,"soldier_weapon_"),run:new ht(e,this.geometry,5,!0,yt,"soldier_weapon_"),idle:new ht(e,this.geometry,8,!0,gt,"soldier_weapon_")},this.currentAnimation=this.animations.idle,this.material=new f.k({map:e.texture,transparent:!0,color:wt[this._team]}),this.material.color.offsetHSL(.1,.8,.4),this.mesh=new f.i(this.geometry,this.material),this.mesh.position.set(t.position.x,t.position.y,t.position.z),this.mesh.rotation.z=t.angle,Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}},{key:"_updateAnimation",value:function(){var t=this.currentAnimation;(t=this.soldier.isMoving?this.soldier.isRunning?this.animations.run:this.animations.walk:this.animations.idle)!==this.currentAnimation&&(this.currentAnimation=t,this.currentAnimation.reset()),this.currentAnimation.update()}},{key:"update",value:function(t){var e=this.soldier.depth;this.soldier.dead?(this.mesh.visible=!1,e=0):this.mesh.visible||(this.mesh.visible=!0);var i=this.soldier.previousPosition,n=this.soldier.position;this.mesh.position.x=i.x+(n.x-i.x)*t,this.mesh.position.y=i.y+(n.y-i.y)*t,this.mesh.position.z=i.z+(n.z-i.z)*t,this.mesh.position.z+=e,this.mesh.rotation.z=this.soldier.angle+Math.PI/180*90,this._updateAnimation()}}]),i}(I),kt=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t,n){var a;return Object(s.a)(this,i),(a=e.call(this)).soldiers=void 0,a.viewPool=void 0,a.viewPairs=void 0,a.soldiers=t,a.viewPool=new st((function(){return new bt(null)}),a.soldiers.size,10,n||200),a.viewPairs=new WeakMap,a}return Object(o.a)(i,[{key:"init",value:function(){this.mesh=new f.l,this._initialized=!0}},{key:"update",value:function(t){this.viewPool.size>this.soldiers.size&&this.viewPool.allocate(this.soldiers.size-this.viewPool.size);var e,i=Object(a.a)(this.soldiers);try{for(i.s();!(e=i.n()).done;){var n=e.value,s=this.viewPairs.get(n);s||n.dead?s&&(s.update(t),n.dead&&this.viewPairs.has(n)&&(this.viewPool.free(s),this.viewPairs.delete(n))):((s=this.viewPool.get()).soldier=n,s.init(),s.team=n.team,this.mesh.add(s.mesh),this.viewPairs.set(n,s))}}catch(o){i.e(o)}finally{i.f()}}}]),i}(I),xt=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).camera=void 0,n.state=void 0,n.map=void 0,n._cameraFollowView=void 0,n._cameraFollowLight=void 0,n.state=t,n.map=n.state.map,n}return Object(o.a)(i,[{key:"cameraFollowView",get:function(){return this._cameraFollowView}},{key:"cameraFollowLight",get:function(){return this._cameraFollowLight}},{key:"changeSize",value:function(t){Object(u.a)(Object(c.a)(i.prototype),"changeSize",this).call(this,t),this.init()}},{key:"init",value:function(){Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this),this.camera=new f.n(75,this.map.width/this.map.height,100,1e3),this.getCamera().position.x=this.map.width/2*this.map.blockWidth,this.getCamera().position.y=this.map.height/2*this.map.blockHeight,this.getCamera().position.z=6*this.map.blockDepth;var t=new f.a(197379);this.scene.add(t),this._cameraFollowLight=new f.s(268435455,2,800),this._cameraFollowLight.angle=Math.PI/180*135,this._cameraFollowLight.exponent=10,this._cameraFollowLight.target=this._cameraFollowView.mesh,this.scene.add(this._cameraFollowLight),this._initialized=!0}},{key:"update",value:function(t){this.state.paused||(Object(u.a)(Object(c.a)(i.prototype),"update",this).call(this,t),this.cameraFollowView&&(this.getCamera().position.setX(this.cameraFollowView.position.x),this.getCamera().position.setY(this.cameraFollowView.position.y),this.cameraFollowLight.position.setX(this.cameraFollowView.position.x),this.cameraFollowLight.position.setY(this.cameraFollowView.position.y),this.cameraFollowLight.position.setZ(this.cameraFollowView.position.z+400)))}},{key:"getCamera",value:function(){return this.camera}}]),i}(m),Ot=function(t){var e=new tt(t),i=new P,n=new at(t),a=new nt(t),s=new et(t),o=new it(t);return i.addDynamicView(n,{x:100,y:100,z:0}),i.addDynamicView(a,{x:280,y:540,z:0}),i.addDynamicView(s,{x:10,y:540,z:0}),i.addDynamicView(o,{x:600,y:540,z:0}),e.addViewContainer("main",i),e.currentViewContainer="main",e},jt=function(t){var e=new xt(t),i=new bt(t.player),n=new kt(t.soldiers),a=new rt(t.bulletSystem),s=new mt(t.map),o=new P;return o.addDynamicView(i),o.addDynamicView(n),o.addDynamicView(a),o.addDynamicView(s),e.addViewContainer("main",o),e.currentViewContainer="main",e._cameraFollowView=i,e},_t=i(21);function St(t){var e,i=new Map,s=Object(a.a)(this.teams.entries());try{for(s.s();!(e=s.n()).done;){var o,r=Object(n.a)(e.value,2),h=r[0],l=r[1],u=Object(a.a)(l);try{for(u.s();!(o=u.n()).done;){var c=o.value,d=i.get(h);d?i.set(h,d+c[t]):i.set(h,c[t])}}catch(p){u.e(p)}finally{u.f()}}}catch(p){s.e(p)}finally{s.f()}}var It=function(){function t(e){Object(s.a)(this,t),this.matchTime=0,this.matchDuration=3e5,this.soldiers=new Set,this.teamNames=[],this.teams=new Map;var i,n=Object(a.a)(e);try{for(n.s();!(i=n.n()).done;){var o=i.value;this.teamNames.push(o),this.teams.set(o,new Set)}}catch(r){n.e(r)}finally{n.f()}}return Object(o.a)(t,[{key:"teamWithLeastPlayers",value:function(){var t,e=null,i=Number.MAX_VALUE,n=Object(a.a)(this.teamNames);try{for(n.s();!(t=n.n()).done;){var s=t.value,o=this.teams.get(s).size;o<i&&(e=s,i=o)}}catch(r){n.e(r)}finally{n.f()}return e}},{key:"addSoldier",value:function(t,e){e||(e=this.teamWithLeastPlayers()),t.team=e;var i=this.teams.get(e);return!!i&&(i.add(t),this.soldiers.add(t),!0)}},{key:"sortedScores",value:function(){var t,e=new Map,i=Object(a.a)(new Set(Object(_t.a)(this.soldiers)));try{for(i.s();!(t=i.n()).done;){var n=t.value,s=e.get(n.team);s?(s.kills+=n.totalKills,s.deaths+=n.totalDeaths,s.soldiers.push(n)):e.set(n.team,{kills:n.totalKills,deaths:n.totalDeaths,soldiers:[n]})}}catch(h){i.e(h)}finally{i.f()}var o,r=Object(a.a)(e.values());try{for(r.s();!(o=r.n()).done;){o.value.soldiers.sort((function(t,e){return e.kills-t.kills}))}}catch(h){r.e(h)}finally{r.f()}return new Map(Object(_t.a)(e.entries()).sort((function(t,e){return e[1].kills-t[1].kills})))}},{key:"removeSoldier",value:function(t){var e,i=Object(a.a)(this.teams.values());try{for(i.s();!(e=i.n()).done;){var n=e.value;if(n.has(t))return n.delete(t),!0}}catch(s){i.e(s)}finally{i.f()}return!1}},{key:"killsByTeam",value:function(){return St("kills")}},{key:"deathsByTeam",value:function(){return St("deaths")}},{key:"start",value:function(){}},{key:"end",value:function(){}},{key:"update",value:function(t){this.matchTime+=t,this.matchTime>=this.matchDuration&&this.end()}}]),t}(),zt=function(){function t(e,i){Object(s.a)(this,t),this.keyboard=void 0,this.gamepad=void 0,this.player=void 0;var n=e.get("keyboard"),a=e.get("gamepad");if(!(n instanceof h.a))throw new Error("No keyboard input");this.keyboard=n.keyboard,this.gamepad=null===a||void 0===a?void 0:a.gamepad,this.player=i}return Object(o.a)(t,[{key:"update",value:function(t){var e,i,n,a,s,o,h,l,u;this.keyboard.isDown(r.b.UP)||(null===(e=this.gamepad)||void 0===e?void 0:e.isStickDown("left","up"))?this.player.moveUp():this.keyboard.isDown(r.b.DOWN)||(null===(i=this.gamepad)||void 0===i?void 0:i.isStickDown("left","down"))?this.player.moveDown():this.player.stopMoving(),this.keyboard.isDown(r.b.RIGHT)||(null===(n=this.gamepad)||void 0===n?void 0:n.isStickDown("right","right"))?this.player.turnRight():this.keyboard.isDown(r.b.LEFT)||(null===(a=this.gamepad)||void 0===a?void 0:a.isStickDown("right","left"))?this.player.turnLeft():this.player.stopTurning(),this.player.isRunning||!this.keyboard.isDown(r.b.CTRL)&&!(null===(s=this.gamepad)||void 0===s?void 0:s.isDown("rightTrigger"))||this.player.fireBullet(),this.keyboard.isDown(r.b.SHIFT)||(null===(o=this.gamepad)||void 0===o?void 0:o.isDown("actionSouth"))?this.player.isRunning=!0:this.player.isRunning=!1,(this.keyboard.keyboardDownOnce(r.c.R)||(null===(h=this.gamepad)||void 0===h?void 0:h.gamepadButtonDownOnce("actionWest")))&&this.player.reload(),(this.keyboard.keyboardDownOnce(r.c.X)||(null===(l=this.gamepad)||void 0===l?void 0:l.gamepadButtonDownOnce("actionNorth")))&&this.player.scrollWeapons("down"),(this.keyboard.keyboardDownOnce(r.c.Z)||(null===(u=this.gamepad)||void 0===u?void 0:u.gamepadButtonDownOnce("actionEast")))&&this.player.scrollWeapons("up")}}]),t}(),Pt=function(){function t(e,i){Object(s.a)(this,t),this.keyboard=void 0,this.gamepad=void 0,this.state=void 0;var n=e.get("keyboard"),a=e.get("gamepad");if(!(n instanceof h.a))throw new Error("No keyboard input");this.keyboard=n.keyboard,this.gamepad=null===a||void 0===a?void 0:a.gamepad,this.state=i}return Object(o.a)(t,[{key:"update",value:function(t){var e;this.keyboard.isDown(r.c.E)||(null===(e=this.gamepad)||void 0===e?void 0:e.gamepadButtonDownOnce("leftBumper"))?this.state.showScores=!0:this.state.showScores=!1,this.keyboard.keyboardDownOnce(r.b.ESC)&&(this.state.paused?this.state.resume():this.state.pause())}}]),t}(),Vt=function(){function t(){Object(s.a)(this,t)}return Object(o.a)(t,null,[{key:"perp",value:function(t){var e=t.x;return t.x=t.y,t.y=-e,t}}]),t}(),Mt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new f.u,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(s.a)(this,t),this.position=void 0,this.angle=0,this.offset=new f.u,this.computedVertices=[],this.vertices=[],this.edges=[],this.normals=[],this.position=e,this.setVertices(i)}return Object(o.a)(t,[{key:"setVertices",value:function(t){if(!this.vertices||this.vertices.length!==t.length){this.computedVertices=[],this.edges=[],this.normals=[];for(var e=0;e<t.length;e++)this.computedVertices.push(new f.u),this.edges.push(new f.u),this.normals.push(new f.u)}return this.vertices=t,this._compute(),this}},{key:"setAngle",value:function(t){return this.angle=t,this._compute(),this}},{key:"setOffset",value:function(t){return this.offset=t,this._compute(),this}},{key:"rotate",value:function(t){for(var e=this.vertices,i=e.length,n=0;n<i;n++)e[n].rotateAround(new f.u,t);return this._compute(),this}},{key:"translate",value:function(t,e){for(var i=this.vertices,n=i.length,a=0;a<n;a++)i[a].x+=t,i[a].y+=e;return this._compute(),this}},{key:"_compute",value:function(){for(var t=this.computedVertices,e=this.edges,i=this.normals,n=this.vertices,a=this.offset,s=this.angle,o=n.length,r=0;r<o;r++){var h=t[r].copy(n[r]);h.x+=a.x,h.y+=a.y,0!==s&&h.rotateAround(new f.u,s)}for(var l=0;l<o;l++){var u=t[l],c=l<o-1?t[l+1]:t[0],d=e[l].copy(c).sub(u);Vt.perp(i[l].copy(d)).normalize()}}},{key:"getAABB",value:function(){for(var e=this.computedVertices,i=e.length,n=e[0].x,a=e[0].y,s=e[0].x,o=e[0].y,r=1;r<i;r++){var h=e[r];h.x<n?n=h.x:h.x>s&&(s=h.x),h.y<a?a=h.y:h.y>o&&(o=h.y)}return t.fromBox(this.position.clone().add(new f.u(n,a)),s-n,o-a)}}],[{key:"fromBox",value:function(e,i,n){return new t(new f.u(e.x,e.y),[new f.u,new f.u(i,0),new f.u(i,n),new f.u(0,n)])}}]),t}(),Ct=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Object(s.a)(this,t),this.position=void 0,this.previousPosition=void 0,this.width=void 0,this.height=void 0,this.depth=void 0,this.speed=void 0,this.rotationSpeed=void 0,this._body=void 0,this.options=void 0,this.angle=2*Math.PI,this.dead=!1,this.velocity={x:0,y:0,z:0},this.isMoving=!1,this.reverse=!1,this.angularVelocity=0,this.collidable=!0,this.shouldUpdate=!0,this.actions={firedBullet:!1},this.position={x:e,y:i,z:n},this.previousPosition={x:e,y:i,z:n},this.width=a,this.height=o,this.depth=r,this.speed=.2,this.rotationSpeed=.3,this.reset(),this._body=new Mt(new f.u(this.x,this.y),[new f.u(-this.halfWidth,-this.halfHeight),new f.u(-this.halfWidth,this.halfHeight),new f.u(this.halfWidth,this.halfHeight),new f.u(this.halfWidth,0)]),this.options={physics:!1,bullets:!1,audio:!1,isBullet:!1,isPlayer:!1,isCharacter:!1,isSoldier:!1}}return Object(o.a)(t,[{key:"rotatedBody",get:function(){var t=this._body;return t.setAngle(this.angle),t}},{key:"onWallCollision",value:function(){return null}},{key:"body",get:function(){return this._body.position.x=this.position.x,this._body.position.y=this.position.y,this._body}},{key:"x",get:function(){return this.position.x}},{key:"y",get:function(){return this.position.y}},{key:"z",get:function(){return this.position.z}},{key:"halfWidth",get:function(){return this.width/2}},{key:"halfHeight",get:function(){return this.height/2}},{key:"kill",value:function(){this.dead=!0}},{key:"point",get:function(){return new f.u(this.x,this.y)}},{key:"reset",value:function(){this.velocity={x:0,y:0,z:0},this.dead=!1,this.reverse=!1,this.angle=2*Math.PI,this.angularVelocity=0,this.reverse=!1,this.collidable=!0,this.shouldUpdate=!0,this.isMoving=!1,this.actions={firedBullet:!1}}},{key:"respawn",value:function(t){this.reset(),this.position={x:t.x,y:t.y,z:t.z},this.previousPosition={x:t.x,y:t.y,z:t.z}}},{key:"moveUp",value:function(){this.reverse=!1,this.isMoving=!0,this.velocity.x=-this.speed*Math.cos(this.angle),this.velocity.y=-this.speed*Math.sin(this.angle)}},{key:"moveDown",value:function(){this.reverse=!0,this.isMoving=!0,this.velocity.x=this.speed*Math.cos(this.angle),this.velocity.y=this.speed*Math.sin(this.angle)}},{key:"turnLeft",value:function(){this.angularVelocity=this.rotationSpeed*(Math.PI/180)}},{key:"turnRight",value:function(){this.angularVelocity=-this.rotationSpeed*(Math.PI/180)}},{key:"stopMoving",value:function(){this.isMoving=!1,this.velocity.x=0,this.velocity.y=0}},{key:"stopTurning",value:function(){this.angularVelocity=0}},{key:"update",value:function(t){this.dead||(this.angle+=this.angularVelocity*t,this.angle<0&&(this.angle=2*Math.PI-this.angle),this.previousPosition.x=this.position.x,this.previousPosition.y=this.position.y,this.previousPosition.z=this.position.z,this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.position.z+=this.velocity.z*t)}}]),t}(),At=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t,n,a,o,r,h){var l;return Object(s.a)(this,i),(l=e.call(this,t,n,a,o,r,h)).maxHealth=100,l.walkingSpeed=.1,l.runningSpeed=.2,l._isRunning=!1,l.health=100,l.reset(),l.options.physics=!0,l.options.bullets=!0,l.options.isCharacter=!0,l}return Object(o.a)(i,[{key:"isRunning",get:function(){return this._isRunning},set:function(t){t?(this._isRunning=!0,this.speed=this.runningSpeed):(this._isRunning=!1,this.speed=this.walkingSpeed)}},{key:"fall",value:function(){this.velocity.z=-.2}},{key:"hitByBullet",value:function(t){this.health-=t.damage,0===this.health&&this.kill()}},{key:"stopFalling",value:function(){this.velocity.z=0}},{key:"reset",value:function(){Object(u.a)(Object(c.a)(i.prototype),"reset",this).call(this),this._isRunning=!1,this.speed=this.walkingSpeed,this.health=100,this.health=this.maxHealth}},{key:"update",value:function(t){Object(u.a)(Object(c.a)(i.prototype),"update",this).call(this,t),this.position.z<=0&&this.kill()}}]),i}(Ct),Tt=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,t),this.name=e,this.maxMagazine=i.maxMagazine||10,this.magazine=i.magazine||this.maxMagazine,this.maxAmmo=i.maxAmmo||10,this.ammo=(i.ammo||this.maxAmmo)-this.magazine,this.fireRate=i.fireRate||150,this.damage=i.damage||10,this.reloadTime=i.reloadTime||500,this._reloadingTime=0,this._firedTime=0,this._canFire=!0,this.isReloading=!1,this.fired=!1}return Object(o.a)(t,[{key:"fire",value:function(){return!!(!this.isReloading&&this._canFire&&this.magazine>0)&&(this.fired=!0,this._canFire=!1,this.magazine-=1,!0)}},{key:"reload",value:function(){if(!this.isReloading){this.isReloading=!0;var t=this.maxMagazine-this.magazine;this.ammo-t<0?(t=this.ammo,this.ammo=0):this.ammo-=t,this.magazine+=t}}},{key:"magazines",get:function(){return Math.floor(this.ammo/this.maxMagazine)}},{key:"update",value:function(t){this._fired&&(this._fired=!1),this.isReloading?(this._reloadingTime+=t,this._reloadingTime>this.reloadTime&&(this._reloadingTime=0,this.isReloading=!1)):this._canFire||(this._firedTime+=t,this._firedTime>this.fireRate&&(this._firedTime=0,this._canFire=!0))}}]),t}(),Bt=function(){var t=new Tt("mp44",{maxAmmo:120,maxMagazine:30});return t},Dt=function(){var t=new Tt("thompson",{maxAmmo:90,maxMagazine:25,fireRate:90});return t},Nt=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t,n,a,o,r,h,l){var u;return Object(s.a)(this,i),(u=e.call(this,t,n,a,o,r,h)).name=void 0,u.weapons=[],u.currentWeaponIndex=0,u.currentWeapon=void 0,u.team=void 0,u.maxHealth=100,u.walkingSpeed=.1,u.runningSpeed=.2,u.kills=new Map,u.deaths=new Map,u.name="cpu",u.team=l,u.addWeapon(Bt()),u.addWeapon(Dt()),u.currentWeapon=u.weapons[0],u.reset(),u.options.isSoldier=!0,u}return Object(o.a)(i,[{key:"addWeapon",value:function(t){this.weapons.push(t)}},{key:"scrollWeapons",value:function(t){if("up"===t)this.currentWeaponIndex===this.weapons.length-1?this.currentWeaponIndex=0:this.currentWeaponIndex+=1;else{if("down"!==t)throw new Error('direction is not "up" or "down"');0===this.currentWeaponIndex?this.currentWeaponIndex=this.weapons.length-1:this.currentWeaponIndex-=1}this.currentWeapon=this.weapons[this.currentWeaponIndex]}},{key:"reload",value:function(){!this.dead&&this.currentWeapon&&this.currentWeapon.reload()}},{key:"hitByBullet",value:function(t){if(Object(u.a)(Object(c.a)(i.prototype),"hitByBullet",this).call(this,t),0===this.health){var e=this.deaths.get(t.firedBy);e?e+=1:e=1,this.deaths.set(t.firedBy,e);var n=t.firedBy.kills.get(this);n?n+=1:n=1,t.firedBy.kills.set(this,n)}}},{key:"kill",value:function(){Object(u.a)(Object(c.a)(i.prototype),"kill",this).call(this);var t=this.deaths.get(this);t?this.deaths.set(this,t+1):this.deaths.set(this,1)}},{key:"totalKills",get:function(){var t,e=0,i=Object(a.a)(this.kills.values());try{for(i.s();!(t=i.n()).done;){e+=t.value}}catch(n){i.e(n)}finally{i.f()}return e}},{key:"totalDeaths",get:function(){var t,e=0,i=Object(a.a)(this.deaths.values());try{for(i.s();!(t=i.n()).done;){e+=t.value}}catch(n){i.e(n)}finally{i.f()}return e}},{key:"fireBullet",value:function(){!this.dead&&this.currentWeapon&&(this.currentWeapon.fire()&&(this.actions.firedBullet=!0))}},{key:"reset",value:function(){Object(u.a)(Object(c.a)(i.prototype),"reset",this).call(this),this.actions.firedBullet=!1}},{key:"update",value:function(t){Object(u.a)(Object(c.a)(i.prototype),"update",this).call(this,t),this.actions.firedBullet&&(this.actions.firedBullet=!1),this.currentWeapon&&this.currentWeapon.update(t)}}]),i}(At),Rt=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t,n,a,o,r,h,l){var u;return Object(s.a)(this,i),(u=e.call(this,t,n,a,o,r,h,l)).name="player",u.options.isPlayer=!0,u.options.audio=!0,u}return Object(o.a)(i,[{key:"update",value:function(t){Object(u.a)(Object(c.a)(i.prototype),"update",this).call(this,t)}}]),i}(Nt),Et=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t,n,a){var o;return Object(s.a)(this,i),(o=e.call(this,n,a)).entities=void 0,o.player=void 0,o.entities=t.soldiers,o.player=t.player,o}return Object(o.a)(i,[{key:"update",value:function(t){var e,i=Object(a.a)(this.entities);try{for(i.s();!(e=i.n()).done;){var n=e.value;n===this.player&&n.actions.firedBullet&&this.effects.play(n.currentWeapon.name)}}catch(s){i.e(s)}finally{i.f()}}}]),i}(g),Ft=function(){function t(e,i,n,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};Object(s.a)(this,t),this._position=e,this.width=i,this.height=n,this.depth=a,this.options=o,this.type=o.type||"wall",this._walls=o.walls||{},this.collidable=o.collidable||!0,this._computeBodies()}return Object(o.a)(t,[{key:"walls",get:function(){return this._walls},set:function(t){this._walls=t,this._computeBodies()}},{key:"position",get:function(){return this._position},set:function(t){this._position=t,this._computeBodies()}},{key:"_computeBodies",value:function(){this._walls.top&&this._walls.west&&this._walls.east&&this._walls.south&&this._walls.north&&(this.bodies=[new Mt(new f.u(this.x,this.y),[new f.u(0,0),new f.u(this.width,0),new f.u(this.width,this.height),new f.u(0,this.height)])]);var t=[];this._walls.west&&t.push(new Mt(new f.u(this.x,this.y),[new f.u(0,0),new f.u(this.width,0),new f.u(this.width,2),new f.u(0,2)])),this._walls.east&&t.push(new Mt(new f.u(this.x,this.y+this.height),[new f.u(0,0),new f.u(this.width,0),new f.u(this.width,-2),new f.u(0,-2)])),this._walls.south&&t.push(new Mt(new f.u(this.x+this.width,this.y),[new f.u(0,0),new f.u(0,this.height),new f.u(-2,this.height),new f.u(-2,0)])),this._walls.north&&t.push(new Mt(new f.u(this.x,this.y),[new f.u(0,0),new f.u(0,this.height),new f.u(2,this.height),new f.u(2,0)])),this.bodies=t}},{key:"x",get:function(){return this._position.x}},{key:"y",get:function(){return this._position.y}},{key:"z",get:function(){return this._position.z}}]),t}(),Gt=function(){function t(e,i,n,a){Object(s.a)(this,t),this.position={x:e,y:i,z:n},this.color=a,this.sourcePosition={x:e,y:i,z:n},this.angle=2*Math.PI}return Object(o.a)(t,[{key:"x",get:function(){return this.position.x}},{key:"y",get:function(){return this.position.y}},{key:"z",get:function(){return this.position.z}}]),t}(),Wt=function(){function t(e,i,n,a,o,r,h){Object(s.a)(this,t),this.width=i,this.height=n,this.depth=a,this.blockWidth=o,this.blockHeight=r,this.blockDepth=h,this.lights=[],this.layers=e,this.name=null}return Object(o.a)(t,[{key:"blocks",value:function(t){return this.blocksBetweenIndexes({x:0,y:0,z:0},{x:this.width-1,y:this.height-1,z:this.depth-1},t)}},{key:"totalWidth",get:function(){return this.width*this.blockWidth}},{key:"totalHeight",get:function(){return this.height*this.blockHeight}},{key:"totalDepth",get:function(){return this.depth*this.blockDepth}},{key:"indexToPosition",value:function(t){return{x:t.x*this.blockWidth,y:t.y*this.blockHeight,z:t.z*this.blockDepth}}},{key:"positionToIndex",value:function(t){var e=t.x,i=t.y,n=t.z,a={};return a.x=Math.floor(e/this.blockWidth),a.y=Math.floor(i/this.blockHeight),a.z=Math.floor(n/this.blockDepth),a}},{key:"randomRespawnPosition",value:function(){var t=this.respawns[Math.round(Math.random()*(this.respawns.length-1))];return this.indexToPosition(t.position)}},{key:"blockAtIndex",value:function(t){return t.z<0||t.z>=this.depth||t.y<0||t.y>=this.height||t.x<0||t.x>=this.width?null:this.layers[t.z][t.y][t.x]}},{key:"blockAtPosition",value:function(t){var e=this.positionToIndex(t);return this.blockAtIndex(e)}},{key:"blocksAtPositions",value:function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[],s=Object(a.a)(t);try{for(s.s();!(e=s.n()).done;){var o=e.value,r=this.blockAtPosition(o);r&&-1!==i.indexOf(r.type)&&n.push(r)}}catch(h){s.e(h)}finally{s.f()}return n}},{key:"blocksBetweenIndexes",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=[],a=t,s=e,o=0;o<this.layers.length;o++)if(o>=a.z&&o<=s.z)for(var r=0;r<this.layers[o].length;r++)if(r>=a.y&&r<=s.y)for(var h=0;h<this.layers[o][r].length;h++)if(h>=a.x&&h<=s.x){var l={x:h,y:r,z:o},u=this.blockAtIndex(l);u&&-1!==i.indexOf(u.type)&&n.push(u)}return n}},{key:"blocksBetweenPositions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},i=arguments.length>2?arguments[2]:void 0;return this.blocksBetweenIndexes(this.positionToIndex(t),this.positionToIndex(e),i)}},{key:"toString",value:function(){var t,e="",i=Object(a.a)(this.layers);try{for(i.s();!(t=i.n()).done;){var n,s=t.value,o=[],r=Object(a.a)(s);try{for(r.s();!(n=r.n()).done;){var h=n.value.map((function(t){return t?t.id:0}));o.push(h.join(", "))}}catch(l){r.e(l)}finally{r.f()}e=(e=e.concat(o.join("\n"))).concat("\n---------------\n")}}catch(l){i.e(l)}finally{i.f()}return e}}]),t}(),Lt=function(t,e,i,n){var a={x:t.position.x*e,y:t.position.y*i,z:t.position.z*n},s={walls:t.walls,type:t.type,collidable:t.collidable},o=new Ft(a,e,i,n,s);return o.collidable=t.collidable||!1,o},Ht=function(t,e,i,n){var a=t.position,s={x:a.x*e,y:a.y*i,z:a.z*n},o={x:a.x*e,y:a.y*i,z:a.z*n},r=2*Math.PI;"west"===t.align?s.x-=e/2:"east"===t.align?(s.x+=e/2,r=Math.PI/180*180):"north"===t.align?(s.y+=i/2,r=Math.PI/180*90):"south"===t.align&&(s.y-=i/2,r=Math.PI/180*270);var h=new Gt(o.x,o.y,o.z,t.color);return h.angle=r,h.sourcePosition=s,h},Ut={parse:function(t){return function(t){var e,i=t.blocks,n=t.blockWidth,s=t.blockHeight,o=t.blockDepth,r=t.width,h=t.height,l=t.depth,u=function(t,e,i){for(var n=[],a=0;a<i;a++){for(var s=[],o=0;o<e;o++){for(var r=[],h=0;h<i;h++)r.push(null);s.push(r)}n.push(s)}return n}(0,h,l),c=Object(a.a)(i);try{for(c.s();!(e=c.n()).done;){var d=e.value,p=Lt(d,n,s,o),f=d.position;u[f.z][f.y][f.x]=p}}catch(x){c.e(x)}finally{c.f()}var m=new Wt(u,r,h,l,n,s,o);if(t.lights){var v,y=Object(a.a)(t.lights);try{for(y.s();!(v=y.n()).done;){var g=v.value;m.lights.push(Ht(g,n,s,o))}}catch(x){y.e(x)}finally{y.f()}}m.name=t.name,m.respawns=[];var w,b=Object(a.a)(t.respawns);try{for(b.s();!(w=b.n()).done;){var k=w.value;m.respawns.push(k)}}catch(x){b.e(x)}finally{b.f()}return m}(t)}},Kt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new f.u,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(s.a)(this,t),this.position=void 0,this.width=void 0,this.height=void 0,this.position=e,this.width=i,this.height=n}return Object(o.a)(t,[{key:"toPolygon",value:function(){var t=this.position,e=this.width,i=this.height;return new Mt(new f.u(t.x,t.y),[new f.u,new f.u(e,0),new f.u(e,i),new f.u(0,i)])}}]),t}(),qt=function(){function t(){Object(s.a)(this,t)}return Object(o.a)(t,null,[{key:"calculate",value:function(e,i){var n=e.lengthSq(),a=i.dot(e);return a<0?t.LEFT_VORONOI_REGION:a>n?t.RIGHT_VORONOI_REGION:t.MIDDLE_VORONOI_REGION}}]),t}();qt.LEFT_VORONOI_REGION=-1,qt.MIDDLE_VORONOI_REGION=0,qt.RIGHT_VORONOI_REGION=1;var Xt=function(){function t(){Object(s.a)(this,t),this.a=void 0,this.b=void 0,this.overlapN=new f.u,this.overlapV=new f.u,this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this.clear()}return Object(o.a)(t,[{key:"clear",value:function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this}}]),t}(),Yt=new Kt(new f.u,1e-5,1e-5).toPolygon(),Zt=function(){function t(){Object(s.a)(this,t),this.arrayPool=void 0,this.vectorPool=void 0,this.cachedSatResult=new Xt,this.arrayPool=new st((function(){return[]}),5,5,20),this.vectorPool=new st((function(){return new f.u}),10,10,40)}return Object(o.a)(t,[{key:"isSeparatingAxis",value:function(e,i,n,a,s,o){var r=this.arrayPool.get(),h=this.arrayPool.get(),l=this.vectorPool.get().copy(i).sub(e),u=l.dot(s);if(t.flattenVerticesOn(n,s,r),t.flattenVerticesOn(a,s,h),h[0]+=u,h[1]+=u,r[0]>h[1]||h[0]>r[1])return this.vectorPool.free(l),this.arrayPool.free(r),this.arrayPool.free(h),!0;if(o){var c=0;if(r[0]<h[0])if(o.aInB=!1,r[1]<h[1])c=r[1]-h[0],o.bInA=!1;else{var d=r[1]-h[0],p=h[1]-r[0];c=d<p?d:-p}else if(o.bInA=!1,r[1]>h[1])c=r[0]-h[1],o.aInB=!1;else{var f=r[1]-h[0],m=h[1]-r[0];c=f<m?f:-m}var v=Math.abs(c);v<o.overlap&&(o.overlap=v,o.overlapN.copy(s),c<0&&o.overlapN.negate())}return this.vectorPool.free(l),this.arrayPool.free(r),this.arrayPool.free(h),!1}},{key:"testPolygonInCircle",value:function(t,e,i){for(var n=this.vectorPool.get().copy(e.position).sub(t.position),a=e.radius,s=a*a,o=t.computedVertices,r=o.length,h=this.vectorPool.get(),l=this.vectorPool.get(),u=0;u<r;u++){var c=u===r-1?0:u+1,d=0===u?r-1:u-1,p=0,f=void 0;h.copy(t.edges[u]),l.copy(n).sub(o[u]),i&&l.lengthSq()>s&&(i.aInB=!1);var m=qt.calculate(h,l);if(m===qt.LEFT_VORONOI_REGION){h.copy(t.edges[d]);var v=this.vectorPool.get().copy(n).sub(o[d]);if((m=qt.calculate(h,v))===qt.RIGHT_VORONOI_REGION){var y=l.length();if(y>a)return this.vectorPool.free(n),this.vectorPool.free(h),this.vectorPool.free(l),this.vectorPool.free(v),!1;i&&(i.bInA=!1,f=l.normalize(),p=a-y)}this.vectorPool.free(v)}else if(m===qt.RIGHT_VORONOI_REGION){if(h.copy(t.edges[c]),l.copy(n).sub(o[c]),(m=qt.calculate(h,l))===qt.LEFT_VORONOI_REGION){var g=l.length();if(g>a)return this.vectorPool.free(n),this.vectorPool.free(h),this.vectorPool.free(l),!1;i&&(i.bInA=!1,f=l.normalize(),p=a-g)}}else{var w=Vt.perp(h).normalize(),b=l.dot(w),k=Math.abs(b);if(b>0&&k>a)return this.vectorPool.free(n),this.vectorPool.free(w),this.vectorPool.free(l),!1;i&&(f=w,p=a-b,(b>=0||p<2*a)&&(i.bInA=!1))}f&&i&&Math.abs(p)<Math.abs(i.overlap)&&(i.overlap=p,i.overlapN.copy(f))}return i&&(i.a=t,i.b=e,i.overlapV.copy(i.overlapN).multiplyScalar(i.overlap)),this.vectorPool.free(n),this.vectorPool.free(h),this.vectorPool.free(l),!0}},{key:"testCircleInPolygon",value:function(t,e,i){var n=this.testPolygonInCircle(e,t,i);if(n&&i){var a=i.a,s=i.aInB;i.overlapN.negate(),i.overlapV.negate(),i.a=i.b,i.b=a,i.aInB=i.bInA,i.bInA=s}return n}},{key:"testPointInPolygon",value:function(t,e){Yt.position.copy(t),this.cachedSatResult.clear();var i=this.testPolygonInPolygon(Yt,e,this.cachedSatResult);return i&&(i=this.cachedSatResult.aInB),i}},{key:"testPolygonInPolygon",value:function(t,e,i){for(var n=t.computedVertices,a=n.length,s=e.computedVertices,o=s.length,r=0;r<a;r++)if(this.isSeparatingAxis(t.position,e.position,n,s,t.normals[r],i))return!1;for(var h=0;h<o;h++)if(this.isSeparatingAxis(t.position,e.position,n,s,e.normals[h],i))return!1;return i&&(i.a=t,i.b=e,i.overlapV.copy(i.overlapN).multiplyScalar(i.overlap)),!0}},{key:"testCircleInCircle",value:function(t,e,i){var n=this.vectorPool.get().copy(e.position).sub(t.position),a=t.radius+e.radius,s=a*a,o=n.lengthSq();if(o>s)return this.vectorPool.free(n),!1;if(i){var r=Math.sqrt(o);i.a=t,i.b=e,i.overlap=a-r,i.overlapN.copy(n.normalize()),i.overlapV.copy(n).multiplyScalar(i.overlap),i.aInB=t.radius<=e.radius&&r<=e.radius-t.radius,i.bInA=e.radius<=t.radius&&r<=t.radius-e.radius}return this.vectorPool.free(n),!0}},{key:"testPointInCircle",value:function(t,e){var i=this.vectorPool.get().copy(t).sub(e.position),n=e.radius*e.radius,a=i.lengthSq();return this.vectorPool.free(i),a<=n}}],[{key:"flattenVerticesOn",value:function(t,e,i){for(var n=Number.MAX_VALUE,a=-Number.MAX_VALUE,s=t.length,o=0;o<s;o++){var r=t[o].dot(e);r<n&&(n=r),r>a&&(a=r)}i[0]=n,i[1]=a}}]),t}(),Jt=new Zt,Qt=new Xt,$t={wallCollision:function(t,e,i){var n=function(t,e){var i=t.position.x,n=t.position.y,a=t.angle,s=t.reverse?-1:1,o={},r={};return Math.abs(t.velocity.x)>0?i-=e*Math.cos(a)*s:i-=e*s,t.velocity.x<0?(o.x=i,r.x=t.position.x):(o.x=t.position.x,r.x=i),Math.abs(t.velocity.y)>0?n-=e*Math.sin(a)*s:n-=e*s,t.velocity.y<0?(o.y=n,r.y=t.position.y):(o.y=t.position.y,r.y=n),o.z=t.position.z,r.z=t.position.z,{min:o,max:r}}(e,(t.blockWidth+t.blockHeight)/2);if(n.min.x!==n.max.x||n.min.y!==n.max.y){var s,o=t.blocksBetweenPositions(n.min,n.max,["wall"]),r=Object(a.a)(o);try{for(r.s();!(s=r.n()).done;){var h=s.value;if(h.collidable){var l,u=h.bodies,c=Object(a.a)(u);try{for(c.s();!(l=c.n()).done;){var d=l.value;Qt.clear(),Jt.testPolygonInPolygon(e.body,d,Qt)&&i(Qt)}}catch(p){c.e(p)}finally{c.f()}}}}catch(p){r.e(p)}finally{r.f()}}},floorCollision:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},a={x:e.position.x+e.velocity.x*i,y:e.position.y+e.velocity.y*i,z:e.position.z+e.velocity.z*i},s=t.positionToIndex(e.position);s.z-=1;var o=t.blockAtIndex(s);o&&o.collidable&&o.walls.top?a.z<=o.position.z+o.depth&&n(o):e.fall()}},te=function(){function t(e){Object(s.a)(this,t),this.state=e,this.entities=e.soldiers,this.map=this.state.map}return Object(o.a)(t,[{key:"update",value:function(t){var e,i=this,n=Object(a.a)(this.entities);try{var s=function(){var n=e.value;$t.wallCollision(i.map,n,(function(t){n.position.x-=t.overlapV.x,n.position.y-=t.overlapV.y})),$t.floorCollision(i.map,n,t,(function(t){"water"===t.type?(n.fall(),n.kill()):(n.position.z=t.position.z+t.depth,n.stopFalling())}))};for(n.s();!(e=n.n()).done;)s()}catch(o){n.e(o)}finally{n.f()}}}]),t}(),ee=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t,n,a,o,r){var h;return Object(s.a)(this,i),(h=e.call(this,t,n,a,o,r)).firedBy=void 0,h.firedByWeapon=void 0,h.maxDistance=500,h.traveledDistance=0,h.dead=!0,h.speed=.3,h.options.isBullet=!0,h}return Object(o.a)(i,[{key:"damage",get:function(){return this.firedByWeapon?this.firedByWeapon.damage:0}},{key:"update",value:function(t){Object(u.a)(Object(c.a)(i.prototype),"update",this).call(this,t),this.traveledDistance+=this.speed*t,this.traveledDistance>this.maxDistance?(this.dead=!0,this.traveledDistance=0):this.moveUp()}}]),i}(Ct),ie=function(){function t(e,i){Object(s.a)(this,t),this.state=void 0,this.soldiers=void 0,this.map=void 0,this.bulletPool=void 0,this.deadBullets=new Set,this.activeBullets=new Set,this.sat=new Zt,this.state=e,this.soldiers=this.state.soldiers,this.map=this.state.map,this.bulletPool=new st((function(){return new ee(0,0,0,4,10)}),10,10,i||200)}return Object(o.a)(t,[{key:"poolSize",get:function(){return this.bulletPool.size}},{key:"_fireBullet",value:function(t){var e=this.bulletPool.get();if(!e){var i=this.activeBullets.values().next().value;this.bulletPool.free(i),e=this.bulletPool.get()}return e.firedBy=t,e.firedByWeapon=t.currentWeapon,e.respawn(t.position),e.angle=t.angle,this.activeBullets.add(e),e}},{key:"killBullet",value:function(t){t.kill(),this.bulletPool.free(t())}},{key:"update",value:function(t){var e,i=this,n=Object(a.a)(this.soldiers);try{for(n.s();!(e=n.n()).done;){var s=e.value;s.actions.firedBullet&&this._fireBullet(s)}}catch(l){n.e(l)}finally{n.f()}var o,r=Object(a.a)(this.activeBullets);try{var h=function(){var e=o.value;if(e.update(t),$t.wallCollision(i.map,e,(function(){return e.kill()})),e.dead)i.deadBullets.add(e),i.activeBullets.delete(e),i.bulletPool.free(e);else{var n,s=Object(a.a)(i.soldiers);try{for(s.s();!(n=s.n()).done;){var r=n.value;r.dead||e.firedBy!==r&&e.position.z>=r.position.z&&e.position.z<r.position.z+50&&i.sat.testPointInPolygon(e.point,r.body)&&(r.hitByBullet(e),e.kill(),i.bulletPool.free(e))}}catch(l){s.e(l)}finally{s.f()}}};for(r.s();!(o=r.n()).done;)h()}catch(l){r.e(l)}finally{r.f()}}}]),t}(),ne=function(){function t(e){Object(s.a)(this,t),this.soldier=void 0,this.soldier=e}return Object(o.a)(t,[{key:"update",value:function(){Math.random()<.05&&this.soldier.fireBullet(),Math.random()>.8&&this.soldier.moveUp(),Math.random()>.7?Math.random()>.5?this.soldier.turnRight():this.soldier.turnLeft():this.soldier.stopTurning(),this.soldier.currentWeapon&&0===this.soldier.currentWeapon.magazine&&this.soldier.reload()}}]),t}();var ae={createSingleplayer:function(t,e){var i=Ut.parse(y.a.getMap(e.map)),n=new It(e.teams),a=new $(t,n,i);!function(t,e){for(var i=0;i<e;i++){var n=t.map.randomRespawnPosition(),a=n.x,s=n.y,o=n.z,r=new Nt(a,s,o,48,48,1,"american");t.addInput(new ne(r)),t.match.addSoldier(r)}}(a,e.cpuCount),function(t,e,i){var n=e.map.randomRespawnPosition(),a=n.x,s=n.y,o=n.z,r=new Rt(a,s,o,48,48,1,"american"),h=new zt(t.inputSources,r);e.player=r,e.addInput(h),r.kill(),e.match.addSoldier(r,"american")}(t,a,e.playerName),a.bulletSystem=new ie(a,e.poolLimit||200),a.collisionSystem=new te(a),a.audio=new Et(a,"guns","background");var s=new Pt(t.inputSources,a);return a.addInput(s),function(t){t.addView(jt(t)),t.addView(Ot(t))}(a),a}};function se(t,e){var i=new b;return i.addMenuItem(new k("createGame","Singleplayer",(function(i){var n=t.states.get("play");n?(e.gamePlaying=!0,n.player.name=e.options.get("name"),i.text="Continue game"):(n=function(t,e){var i=Object.assign({poolLimit:200,teams:["american","german"],cpuCount:7,map:"level2",playerName:"unknown soldier"},e),n=ae.createSingleplayer(t,i);return t.addState("play",n),n}(t,{playerName:e.options.get("name")}),i.text="Create game"),n.resume(),t.changeState("play")}))),i.addMenuItem(new k("options","Options",(function(){e.currentMenu="options"}))),i.addMenuItem(new k("help","Help",(function(){e.currentMenu="help"}))),i}var oe={create:function(t,e){var i=se(t,e);return{viewContainer:function(t){var e=new P,i=new z("normandy","ui");return e.addDynamicView(new Y(t),{x:500,y:200,z:0}),e.addStaticView(new V("logo","ui"),{x:300,y:300,z:0}),i.lightness=.5,e.backgroundView=i,e}(i),menu:i}}},re=function(t){Object(d.a)(i,t);var e=Object(p.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this,"menu",t)).menus=new Map,n._currentMenu=null,n.currentMenuName=null,n.options=new Map([["name","Unknown Soldier"]]),n.gamePlaying=!1,n.currentOptionsEdit=null,n}return Object(o.a)(i,[{key:"addMenu",value:function(t,e){this.menus.set(t,e)}},{key:"changeOption",value:function(t,e){this.options.set(t,e)}},{key:"currentMenu",get:function(){return this._currentMenu},set:function(t){if(this._currentMenu=this.menus.get(t),!this._currentMenu)throw new Error('Menu "'+t+'" does not exist');this.currentMenuName=t}},{key:"init",value:function(){Object(u.a)(Object(c.a)(i.prototype),"init",this).call(this)}},{key:"update",value:function(t){Object(u.a)(Object(c.a)(i.prototype),"updateInputs",this).call(this,t),Object(u.a)(Object(c.a)(i.prototype),"updateAudio",this).call(this,t)}}]),i}(Q.a),he={create:function(t){var e=new re(t),i=new l(t.inputSources,e);e.addInput(i);var s,o=new Map([["main",oe.create(t,e)],["options",Z.create(e)],["help",J.create(e)]]),r=Object(a.a)(o.entries());try{for(r.s();!(s=r.n()).done;){var h=Object(n.a)(s.value,2),u=h[0],c=h[1];e.addMenu(u,c.menu)}}catch(b){r.e(b)}finally{r.f()}var d,p=new v(e),f=Object(a.a)(o.entries());try{for(f.s();!(d=f.n()).done;){var m=Object(n.a)(d.value,2),y=m[0],g=m[1];p.addViewContainer(y,g.viewContainer)}}catch(b){f.e(b)}finally{f.f()}return p.currentViewContainer="main",e.addView(p),e.currentMenu="main",e.audio=new w(e,"menu_effects","background"),e}};e.a=he},function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i(1),a=i(2);function s(){this._buttonNames=["actionSouth","actionEast","actionWest","actionNorth","leftBumper","rightBumper","leftTrigger","rightTrigger","select","start","leftStick","rightStick","dPadUp","dPadDown","dPadLeft","dPadRight","extra"],this.reset()}s.prototype.reset=function(){this._ticking=!1,this._prevTimestamps=[],this._connectionListening=!1,this._updateCallback=function(){},this._prevRawGamepadTypes=[],this.gamepadconnected=o.length>0,this.gamepadConnected=Boolean(this.gamepadconnected),this.gamepadSupported=Boolean(h()),this.gamepads=[],this._heldButtonDelay=200,this._heldTimestampByGamepad={}};s.prototype.onUpdate=function(t){this._updateCallback=t,this._checkForEvents(),this._setupPoll()},s.prototype.offUpdate=function(){this._shouldRemoveEvents(),this._removePoll()},s.prototype.update=function(){this._updateCallback(this.gamepads)},s.prototype._checkForEvents=function(){this._connectionListening||(window.addEventListener("gamepadconnected",this._onGamepadConnected.bind(this),!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected.bind(this),!1),this._connectionListening=!0)},s.prototype._shouldRemoveEvents=function(){this._connectionListening&&(window.removeEventListener("gamepadconnected",this._onGamepadConnected.bind(this)),window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected.bind(this)),this._connectionListening=!1)},s.prototype._onGamepadConnected=function(t){var e=t.gamepad;"standard"===e.mapping&&(this.gamepads[e.index]={leftStick:{x:0,y:0},rightStick:{x:0,y:0},dPad:{x:0,y:0},buttons:{},_pressed:{},timestamp:0},this.gamepadconnected=!0,this.update())},s.prototype._onGamepadDisconnected=function(t){var e=t.gamepad,i=this.gamepads;i.forEach((function(t,n){n===e.index&&i.splice(n,1)})),i.length||(this.gamepadconnected=!1),this.update()};var o=function(){var t=navigator.getGamepads&&navigator.getGamepads()||navigator.webkitGetGamepads&&navigator.webkitGetGamepads(),e=[];if(t)for(var i=0,n=t.length;i<n;i++){var a=t[i];a&&"standard"===a.mapping&&e.push(a)}return e},r=function(t,e){if(!t||!t.buttons||e>=t.buttons.length)return!1;var i=t.buttons[e],n=null;return!!i&&(n=i,"object"===typeof i&&(n=i.value),1===n)};s.prototype._checkForGamepadChange=function(){for(var t=o(),e=!1,i={},n=0,a=0;a<t.length;a++){var s,r,h=t[a];h.timestamp&&(n=h.index,s=this._heldTimestampByGamepad[n]||{},r=0===Object.keys(s).length,h.timestamp===this._prevTimestamps[n]&&r||(this._prevTimestamps[n]=h.timestamp,i[n]=h,e=!0))}return!!e&&i},s.prototype._poll=function(){var t=this,e=this._checkForGamepadChange();if(e){this.gamepadconnected=!0,this.gamepadConnected=!0,this.gamepadSupported=!0;var i=this.gamepads,n=this._buttonNames;Object.keys(e).map((function(a){var s=e[a];if(s){typeof s!==t._prevRawGamepadTypes[a]&&(t._prevRawGamepadTypes[a]=typeof h);for(var o={},h=i[a]||{leftStick:{x:0,y:0},rightStick:{x:0,y:0},dPad:{x:0,y:0},buttons:{},_pressed:{},timestamp:0},l=t._heldTimestampByGamepad[a]||{},u=0,c=n.length;u<c;u++){var d=n[u],p=l[d],f=Boolean(h._pressed[d]),m=h._pressed[d]=r(s,u),v=Date.now();f&&!m?(o[d]={released:!0,held:!1},l&&delete l[d]):m&&(p?(p.gamepadTimestamp===s.timestamp&&v>p.browserTimestamp+t._heldButtonDelay||s.timestamp>p.gamepadTimestamp+t._heldButtonDelay)&&(o[d]={held:!0}):l[d]={gamepadTimestamp:s.timestamp,browserTimestamp:v})}t._heldTimestampByGamepad[a]=l,h.timestamp=s.timestamp,h.buttons=o,h.leftStick.x=s.axes[0],h.leftStick.y=s.axes[1],h.rightStick.x=s.axes[2],h.rightStick.y=s.axes[3],h.dPad.x=(h.buttons.dPadLeft?-1:0)+(h.buttons.dPadRight?1:0),h.dPad.y=(h.buttons.dPadUp?-1:0)+(h.buttons.dPadDown?1:0),t.gamepads[a]=h}})),this.update()}},s.prototype._setupPoll=function(){this._ticking||(this._ticking=!0,this._tick())},s.prototype._tick=function(){var t=s.prototype._tick.bind(this);this._poll(),this._ticking&&(window.requestAnimationFrame?window.requestAnimationFrame(t):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(t):window.webkitRequestAnimationFrame&&window.webkitRequestAnimationFrame(t))},s.prototype._removePoll=function(){this._ticking=!1};var h=function(){return navigator.getGamepads||Boolean(navigator.webkitGetGamepads)||Boolean(navigator.webkitGamepads)},l=s,u=function(){function t(){var e=this;Object(n.a)(this,t),this.gp=void 0,this.gamepad=void 0,this._previousGamepadStick=void 0,this._previousGamepadButton=void 0,this.gamepadIndex=void 0,this._previousGamepadStick={},this._previousGamepadButton={},this.gamepadIndex=0,this.gp=new l,this.gp.onUpdate((function(t){e.gamepad=t[e.gamepadIndex],e.gp.gamepadsconnected}))}return Object(a.a)(t,[{key:"isDown",value:function(t){var e,i;return!(!(null===(e=this.gamepad)||void 0===e?void 0:e.buttons[t])||!(null===(i=this.gamepad)||void 0===i?void 0:i.buttons[t].held))}},{key:"isStickDown",value:function(t,e){var i=this.gamepad;if(i){if("right"===t&&i.rightStick)if("right"===e){if(i.rightStick.x>.5)return!0}else if("left"===e){if(i.rightStick.x<-.5)return!0}else if("up"===e){if(i.rightStick.y<-.5)return!0}else{if("down"!==e)return!1;if(i.rightStick.y>.5)return!0}if("left"===t&&i.leftStick)if("right"===e){if(i.leftStick.x>.5)return!0}else if("left"===e){if(i.leftStick.x<-.5)return!0}else if("up"===e){if(i.leftStick.y<-.5)return!0}else{if("down"!==e)return!1;if(i.leftStick.y>.5)return!0}}}},{key:"gamepadStickDownOnce",value:function(t,e){this._previousGamepadStick[t+e]||this.isStickDown(t,e)?this._previousGamepadStick[t+e]&&!this.isStickDown(t,e)&&(this._previousGamepadStick[t+e]=!1):this._previousGamepadStick[t+e]=!0}},{key:"gamepadButtonDownOnce",value:function(t){this._previousGamepadButton[t]||this.isDown(t)?this._previousGamepadButton[t]&&!this.isDown(t)&&(this._previousGamepadButton[t]=!1):this._previousGamepadButton[t]=!0}}]),t}(),c=function t(){Object(n.a)(this,t),this.gamepad=void 0,this.gamepad=new u}},function(t,e,i){"use strict";i.d(e,"a",(function(){return p}));var n=i(3),a=i(1),s=i(2),o=i(16),r=i(6),h=i(5),l=i(0),u=function(){function t(e){Object(a.a)(this,t),this.options=e,this._views=void 0,this.webglRenderer=void 0,this.webglRenderer=new l.v,this.webglRenderer.setSize(e.width,e.height),this.webglRenderer.setClearColor(0),this.webglRenderer.setPixelRatio(window.devicePixelRatio),this.webglRenderer.autoClear=!1,document.getElementById(e.div).appendChild(this.webglRenderer.domElement)}return Object(s.a)(t,[{key:"views",get:function(){return this._views},set:function(t){if(this._views=t,t){var e,i=0,a=Object(n.a)(t);try{for(a.s();!(e=a.n()).done;){var s=e.value;0===i&&this.webglRenderer.setClearColor(s.clearColor),s.changeSize({width:this.options.width,height:this.options.height}),i+=1}}catch(o){a.e(o)}finally{a.f()}}}},{key:"handleStateChange",value:function(t){var e=t.views;e.size>0&&(this.views=e)}},{key:"preRender",value:function(){}},{key:"postRender",value:function(){}},{key:"render",value:function(t){this.webglRenderer.clear();var e=0,i=this._views;if(i){var a,s=Object(n.a)(i);try{for(s.s();!(a=s.n()).done;){var o=a.value;e>0&&this.webglRenderer.clearDepth(),this.webglRenderer.render(o.scene,o.getCamera()),e+=1}}catch(r){s.e(r)}finally{s.f()}}}}]),t}(),c=i(30),d=function(){function t(e){Object(a.a)(this,t),this.renderer=e}return Object(s.a)(t,[{key:"init",value:function(){this.statjs=new c.a,this.statjs.setModes([0,1,2]),this.statjs.domElement.style.position="absolute",this.statjs.domElement.style.right="81px",this.statjs.domElement.style.bottom="0px",document.body.appendChild(this.statjs.domElement),this.rendererStats=function(){var t=document.createElement("div");t.style.cssText="width:80px;opacity:0.9;cursor:pointer";var e=document.createElement("div");e.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200;",t.appendChild(e);var i=document.createElement("div");i.style.cssText="color:#f00;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",i.innerHTML="WebGLRenderer",e.appendChild(i);for(var n=[],a=0;a<9;a++)n[a]=document.createElement("div"),n[a].style.cssText="color:#f00;background-color:#311;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",e.appendChild(n[a]),n[a].innerHTML="-";var s=Date.now();return{domElement:t,update:function(t){if(!(Date.now()-s<1e3/30)){s=Date.now();var e=0;t&&(n[e++].textContent="== Memory =====",n[e++].textContent="Programs: "+t.memory.programs,n[e++].textContent="Geometries: "+t.memory.geometries,n[e++].textContent="Textures: "+t.memory.textures,n[e++].textContent="== Render =====",n[e++].textContent="Calls: "+t.render.calls,n[e++].textContent="Vertices: "+t.render.vertices,n[e++].textContent="Faces: "+t.render.faces,n[e++].textContent="Points: "+t.render.points)}}}}(),this.rendererStats.domElement.style.position="absolute",this.rendererStats.domElement.style.right="0px",this.rendererStats.domElement.style.bottom="0px",document.body.appendChild(this.rendererStats.domElement)}},{key:"before",value:function(){this.statjs.begin()}},{key:"after",value:function(){this.statjs.end(),this.rendererStats.update(this.renderer.info)}}]),t}(),p=function(t){Object(r.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(a.a)(this,i),(n=e.call(this,t)).info={},n.renderDebug=void 0,n.renderDebug=new d(Object(o.a)(n)),n.renderDebug.init(),n}return Object(s.a)(i,[{key:"render",value:function(t){this.webglRenderer.clear();var e={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},i=0;if(this.views){var a,s=Object(n.a)(this.views);try{for(s.s();!(a=s.n()).done;){var o=a.value;i>0&&this.webglRenderer.clearDepth(),this.webglRenderer.render(o.scene,o.getCamera());var r=this.webglRenderer.info.programs;e.memory.programs+=r.length,e.memory.geometries+=this.webglRenderer.info.memory.geometries,e.memory.textures+=this.webglRenderer.info.memory.textures,e.render.calls+=this.webglRenderer.info.render.calls,e.render.vertices+=this.webglRenderer.info.render.vertices,e.render.faces+=this.webglRenderer.info.render.faces,e.render.points+=this.webglRenderer.info.render.points,i+=1}}catch(h){s.e(h)}finally{s.f()}}this.info=e}},{key:"preRender",value:function(){this.renderDebug.before()}},{key:"postRender",value:function(){this.renderDebug.after()}}]),i}(u)},function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i(9),a=i(1),s=i(2),o=i(24),r=i.n(o),h=i(6),l=i(5),u=function(t){Object(h.a)(i,t);var e=Object(l.a)(i);function i(t){return Object(a.a)(this,i),e.call(this,"null",t)}return Object(s.a)(i,[{key:"update",value:function(){}}]),i}(i(14).a),c=function(){function t(e){Object(a.a)(this,t),this.states=new Map,this.currentState=void 0,this.renderer=void 0,this.inputSources=new Map,this.currentState=new u(this),this.renderer=e.renderer;for(var i=0,s=Object.entries(e.input);i<s.length;i++){var o=Object(n.a)(s[i],2),r=o[0],h=o[1];this.inputSources.set(r,h)}}return Object(s.a)(t,[{key:"addState",value:function(t,e){this.states.set(t,e)}},{key:"changeState",value:function(t){var e=this.states.get(t);if(!e)throw new Error("State ".concat(t," not found."));this.currentState=e,this.currentState.init(),this.renderer.handleStateChange(this.currentState)}},{key:"removeState",value:function(t){this.states.delete(t)}},{key:"run",value:function(){var t=this,e=new r.a;e.setUpdate((function(e){t.currentState?t.currentState.update(e):console.warn("no current State")})),e.setDraw((function(e){t.currentState.render(e),t.renderer.render(e)})),e.setBegin((function(){t.renderer.preRender()})),e.setEnd((function(){t.renderer.postRender()})),e.start()}}]),t}()},function(t,e,i){t.exports=i(36)},function(t,e,i){"use strict";i.r(e),(new(i(22).a)).start()}],[[35,1,2]]]);
//# sourceMappingURL=main.9210b0be.chunk.js.map