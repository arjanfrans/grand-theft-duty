(this["webpackJsonpgrand-theft-duty"]=this["webpackJsonpgrand-theft-duty"]||[]).push([[0],[,,,,,,,,function(t,e,i){"use strict";var n=i(3),a=i(20),s=i.n(a),r=i(2),o={atlases:new Map,textures:new Map,maps:new Map,fonts:new Map,audio:new Map},h=function(t,e){return c(t+e+".json").then((function(i){i.src=i.urls;var a,r=[],h=Object(n.a)(i.src);try{for(h.s();!(a=h.n()).done;){var l=a.value;r.push(t+l)}}catch(u){h.e(u)}finally{h.f()}return i.src=r,function(t,e){return new Promise((function(i,n){e.onload=function(){return i()},e.onloaderror=function(t,e){return n(e)};var a=new s.a.Howl(e),r={mapping:e,sound:a};o.audio.set(t,r)}))}(e,i)}))},l=function(t,e){var i={mapping:null,pages:[],textures:[]};return c(t+e+".json").then((function(e){i.mapping=e;var n=e.pages.map((function(e){return i.pages.push(e),u(e,t+e)}));return Promise.all(n)})).then((function(){var t,a=Object(n.a)(i.pages);try{for(a.s();!(t=a.n()).done;){var s=t.value;i.textures.push(o.textures.get(s))}}catch(r){a.e(r)}finally{a.f()}o.fonts.set(e,i)}))},u=function(t,e){return new Promise((function(i,n){f.load(e,(function(e){return o.textures.set(t,e),i()}),(function(t){console.log(t.loaded/t.total*100+"% loaded")}),(function(t){return n(t)}))}))},c=function(t){return function(t){return new Promise((function(e,i){m.load(t,(function(t){return e(t)}),(function(t){console.log(t.loaded/t.total*100+"% loaded")}),(function(t){return i(t)}))}))}(t).then((function(t){try{return JSON.parse(t)}catch(e){throw e}}))},d=function(t,e){return c(t+e+".json").then((function(t){return t})).then((function(i){return o.atlases.set(e,i),u(e,t+i.meta.image)}))},p=function(t,e){return c(t+e+".json").then((function(t){o.maps.set(e,t)}))},f=null,m=null,v={init:function(t){f=new r.t,m=new r.f;var e,i=[],a=t.paths,s=Object(n.a)(t.textureAtlases);try{for(s.s();!(e=s.n()).done;){var o=e.value;i.push(d(a.atlases+"/",o))}}catch(O){s.e(O)}finally{s.f()}var u,c=Object(n.a)(t.maps);try{for(c.s();!(u=c.n()).done;){var v=u.value;i.push(p(a.maps+"/",v))}}catch(O){c.e(O)}finally{c.f()}var y,g=Object(n.a)(t.fonts);try{for(g.s();!(y=g.n()).done;){var w=y.value;i.push(l(a.fonts+"/",w))}}catch(O){g.e(O)}finally{g.f()}var b,x=Object(n.a)(t.audio);try{for(x.s();!(b=x.n()).done;){var k=b.value;i.push(h(a.audio+"/",k))}}catch(O){x.e(O)}finally{x.f()}return Promise.all(i)},getTexture:function(t){var e=o.textures.get(t);if(!e)throw new Error("Texture does not exist: "+t);return e},cloneTexture:function(t){var e=this.getTexture(t).clone();return e.needsUpdate=!0,e},getMap:function(t){var e=o.maps.get(t);if(!e)throw new Error("Map does not exist: "+t);return e},getAtlasMapping:function(t){var e=o.atlases.get(t);if(!e)throw new Error("Atlas mapping does not exist: "+t);return e},getFont:function(t){var e=o.fonts.get(t);if(!e)throw new Error("Font does not exist: "+t);return e},getAudioSprite:function(t){var e=o.audio.get(t);if(!e)throw new Error("Audio sprite does not exist: "+t);return e}};e.a=v},,,,function(t,e,i){"use strict";var n=i(3),a=i(0),s=i(1),r=i(2),o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root";Object(a.a)(this,t),this._views=null,this._THREErenderer=new r.v,this._THREErenderer.setSize(800,600),this._THREErenderer.setClearColor(0),this._THREErenderer.setPixelRatio(window.devicePixelRatio),this._THREErenderer.autoClear=!1,document.getElementById(e).appendChild(this._THREErenderer.domElement)}return Object(s.a)(t,[{key:"views",get:function(){return this._views},set:function(t){this._views=t;var e,i=0,a=Object(n.a)(this._views);try{for(a.s();!(e=a.n()).done;){var s=e.value;0===i&&this._THREErenderer.setClearColor(s.clearColor),s.size={width:800,height:600},i+=1}}catch(r){a.e(r)}finally{a.f()}}},{key:"render",value:function(){this._THREErenderer.clear();var t,e={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},i=0,a=Object(n.a)(this._views);try{for(a.s();!(t=a.n()).done;){var s=t.value;i>0&&this._THREErenderer.clearDepth(),this._THREErenderer.render(s.scene,s.camera),e.memory.programs+=this._THREErenderer.info.programs.length,e.memory.geometries+=this._THREErenderer.info.memory.geometries,e.memory.textures+=this._THREErenderer.info.memory.textures,e.render.calls+=this._THREErenderer.info.render.calls,e.render.vertices+=this._THREErenderer.info.render.vertices,e.render.faces+=this._THREErenderer.info.render.faces,e.render.points+=this._THREErenderer.info.render.points,i+=1}}catch(r){a.e(r)}finally{a.f()}this.info=e}}]),t}();e.a=o},,,,,function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return u}));var n=i(25),a=i(8),s=i(21),r=i.n(s),o=i(24),h=r.a.resolve(t,"../../assets/"),l={paths:{maps:h+"/maps",atlases:h+"/spritesheets",fonts:h+"/fonts",audio:h+"/audio/sprites"},textureAtlases:["soldier","tiles","world","ui"],maps:["level1","level2"],fonts:["keep_calm"],audio:["guns","background","menu_effects"]},u={start:function(){a.a.init(l).then((function(){var t=new n.a({debugMode:!0}),e=o.a.create(t);t.addState("menu",e),t.changeState("menu"),t.run()})).catch((function(t){throw t}))}}}).call(this,"/")},function(t,e,i){"use strict";(function(t){e.a=function(){var e=t.performance&&t.performance.now?t.performance.now.bind(performance):Date.now,i=e(),n=i,a=0,s=[0],r=function(t,e,i){var n=document.createElement(t);return n.id=e,n.style.cssText=i,n},o=function(t,e,i){var n=r("div",t,"padding:0 0 3px 3px;text-align:left;background:"+i),a=r("div",t+"Text","font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px;color:"+e);a.innerHTML=t.toUpperCase(),n.appendChild(a);var s=r("div",t+"Graph","width:74px;height:30px;background:"+e);n.appendChild(s);for(var o=0;o<74;o++)s.appendChild(r("span","","width:1px;height:30px;float:left;opacity:0.9;background:"+i));return n},h=function(t){for(var e=u.children,i=0;i<e.length;i++)t.indexOf(i)<0?e[i].style.display="none":e[i].style.display="block";s=t},l=function(t,e){t.appendChild(t.firstChild).style.height=Math.min(30,30-30*e)+"px"},u=r("div","stats","width:80px;opacity:0.9;cursor:pointer"),c=0,d=Number.POSITIVE_INFINITY,p=0,f=o("fps","#0ff","#002"),m=f.children[0],v=f.children[1];u.appendChild(f);var y=0,g=Number.POSITIVE_INFINITY,w=0,b=o("ms","#0f0","#020"),x=b.children[0],k=b.children[1];u.appendChild(b);var O=0,j=Number.POSITIVE_INFINITY,_=0,z=o("mb","#f08","#201"),S=z.children[0],I=z.children[1];return t.performance&&t.performance.memory&&u.appendChild(z),h([s]),{REVISION:14,domElement:u,setMode:function(t){for(var e=u.children,i=0;i<e.length;i++)e[i].style.display=i===t?"block":"none";s=[t]},setModes:h,begin:function(){i=e()},end:function(){var t=e();if(y=t-i,g=Math.min(g,y),w=Math.max(w,y),x.textContent=(0|y)+" MS ("+(0|g)+"-"+(0|w)+")",l(k,y/200),a++,t>n+1e3&&(c=Math.round(1e3*a/(t-n)),d=Math.min(d,c),p=Math.max(p,c),m.textContent=c+" FPS ("+d+"-"+p+")",l(v,c/100),n=t,a=0,"undefined"!==typeof O&&performance&&performance.memory)){var s=performance.memory.usedJSHeapSize,r=performance.memory.jsHeapSizeLimit;O=Math.round(954e-9*s),j=Math.min(j,O),_=Math.max(_,O),S.textContent=O+" MB ("+j+"-"+_+")",l(I,s/r)}return t},update:function(){i=this.end()}}}}).call(this,i(13))},function(t,e,i){"use strict";(function(t){e.a={create:function(){var e=1e3/60,i=0,n=0,a=60,s=0,r=0,o=0,h=0,l=!1,u=!1,c=!1,d=t.requestAnimationFrame||function(){var t=Date.now();return function(i){var n=Date.now(),a=Math.max(0,e-(n-t));return t=n+a,setTimeout((function(){i(n+a)}),a)}}(),p=t.cancelAnimationFrame||clearTimeout,f=function(){},m=f,v=f,y=f,g=f,w=null;function b(t){if(t<n+h)w=d(b);else{for(i+=t-n,n=t,m(t,i),t>s+1e3&&(a=.25*r+.75*a,s=t,r=0),r+=1,o=0;i>=e;)if(v(e),i-=e,++o>=240){c=!0;break}y(i/e),g(a,c),c=!1,w=d(b)}}return{getSimulationTimestep:function(){return e},setSimulationTimestep:function(t){return e=t,this},getFPS:function(){return a},getMaxAllowedFPS:function(){return 1e3/h},setMaxAllowedFPS:function(t){return"undefined"===typeof t&&(t=Number.Infinity),0===t?this.stop():h=1e3/t,this},resetFrameDelta:function(){var t=i;return i=0,t},setBegin:function(t){return m=t||m,this},setUpdate:function(t){return v=t||v,this},setDraw:function(t){return y=t||y,this},setEnd:function(t){return g=t||g,this},start:function(){return u||(u=!0,w=d((function(t){y(1),l=!0,n=t,s=t,r=0,w=d(b)}))),this},stop:function(){return l=!1,u=!1,p(w),this},isRunning:function(){return l}}}}}).call(this,i(13))},,,,,function(t,e,i){"use strict";for(var n=i(9),a=i(3),s=i(0),r=i(1),o=i(5),h=i(4),l={";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},u={":":186,"+":187,"<":188,_:189,">":190,"?":191,"~":192,"{":219,"|":220,"}":221,'"':222},c={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57},d={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:86,V:86,W:87,X:88,Y:89,Z:90},p={BACKSPACE:8,CTRL:17,SPACE:32,ENTER:13,SHIFT:16,ESC:27,TAB:9,LEFT:37,UP:38,RIGHT:39,DOWN:40},f=0,m=Object.keys(l);f<m.length;f++){var v=m[f];p[v]=l[v]}for(var y=0,g=Object.keys(c);y<g.length;y++){var w=g[y];p[w]=c[w]}for(var b=0,x=Object.keys(d);b<x.length;b++){var k=x[b];p[k]=d[k]}for(var O={},j=0,_=Object.keys(u);j<_.length;j++){var z=_[j];O[z]=u[z]}for(var S={},I={},M={_pressed:{},shiftDown:!1,lastPressed:null,lastPressedIsChar:function(){var t,e=Object.keys(l).concat(Object.keys(c)).concat(Object.keys(d)),i=[],n=Object(a.a)(e);try{for(n.s();!(t=n.n()).done;){var s=t.value;i.push(p[s])}}catch(r){n.e(r)}finally{n.f()}return!(!this.lastPressed||-1===i.indexOf(this.lastPressed))},lastPressedChar:function(){return this.shiftDown?-1!==Object.keys(O).indexOf(I[this.lastPressed])?I[this.lastPressed]:S[this.lastPressed].toUpperCase():S[this.lastPressed].toLowerCase()},isDown:function(t){return this._pressed[t]},onKeydown:function(t){this.shiftDown=t.shiftKey,this.lastPressed=t.keyCode,this._pressed[t.keyCode]=!0},onKeyup:function(t){this._pressed[t.keyCode]=!1},keyByCode:function(t){return S[t]},get pressedCodes(){return this._pressed},get pressedKeys(){var t,e=[],i=Object(a.a)(this._pressed);try{for(i.s();!(t=i.n()).done;){var n=t.value;e.push(this.keyByCode(n))}}catch(s){i.e(s)}finally{i.f()}return e},keys:p,get letterKeyCodes(){for(var t=[],e=0,i=Object.keys(d);e<i.length;e++){var n=i[e];t.push(d[n])}return t}},P=0,V=Object.keys(p);P<V.length;P++){var T=V[P],C=p[T];S[C]=T,M[T]=C}for(var A=0,D=Object.keys(O);A<D.length;A++){var E=D[A],B=O[E];I[B]=E,M[E]=B}window.addEventListener("keyup",(function(t){t.preventDefault(),t.stopPropagation(),M.onKeyup(t)}),!1),window.addEventListener("keydown",(function(t){console.log(t),t.preventDefault(),t.stopPropagation(),M.onKeydown(t)}),!1);var F=M;function N(){this._buttonNames=["actionSouth","actionEast","actionWest","actionNorth","leftBumper","rightBumper","leftTrigger","rightTrigger","select","start","leftStick","rightStick","dPadUp","dPadDown","dPadLeft","dPadRight","extra"],this.reset()}N.prototype.reset=function(){this._ticking=!1,this._prevTimestamps=[],this._connectionListening=!1,this._updateCallback=function(){},this._prevRawGamepadTypes=[],this.gamepadconnected=H.length>0,this.gamepadConnected=Boolean(this.gamepadconnected),this.gamepadSupported=Boolean(W()),this.gamepads=[],this._heldButtonDelay=200,this._heldTimestampByGamepad={}};N.prototype.onUpdate=function(t){this._updateCallback=t,this._checkForEvents(),this._setupPoll()},N.prototype.offUpdate=function(){this._shouldRemoveEvents(),this._removePoll()},N.prototype.update=function(){this._updateCallback(this.gamepads)},N.prototype._checkForEvents=function(){this._connectionListening||(window.addEventListener("gamepadconnected",this._onGamepadConnected.bind(this),!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected.bind(this),!1),this._connectionListening=!0)},N.prototype._shouldRemoveEvents=function(){this._connectionListening&&(window.removeEventListener("gamepadconnected",this._onGamepadConnected.bind(this)),window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected.bind(this)),this._connectionListening=!1)},N.prototype._onGamepadConnected=function(t){var e=t.gamepad;"standard"===e.mapping&&(this.gamepads[e.index]={leftStick:{x:0,y:0},rightStick:{x:0,y:0},dPad:{x:0,y:0},buttons:{},_pressed:{},timestamp:0},this.gamepadconnected=!0,this.update())},N.prototype._onGamepadDisconnected=function(t){var e=t.gamepad,i=this.gamepads;i.forEach((function(t,n){n===e.index&&i.splice(n,1)})),i.length||(this.gamepadconnected=!1),this.update()};var H=function(){var t=navigator.getGamepads&&navigator.getGamepads()||navigator.webkitGetGamepads&&navigator.webkitGetGamepads(),e=[];if(t)for(var i=0,n=t.length;i<n;i++){var a=t[i];a&&"standard"===a.mapping&&e.push(a)}return e},R=function(t,e){if(!t||!t.buttons||e>=t.buttons.length)return!1;var i=t.buttons[e],n=null;return!!i&&(n=i,"object"===typeof i&&(n=i.value),1===n)};N.prototype._checkForGamepadChange=function(){for(var t=H(),e=!1,i={},n=0,a=0;a<t.length;a++){var s,r,o=t[a];o.timestamp&&(n=o.index,s=this._heldTimestampByGamepad[n]||{},r=0===Object.keys(s).length,o.timestamp===this._prevTimestamps[n]&&r||(this._prevTimestamps[n]=o.timestamp,i[n]=o,e=!0))}return!!e&&i},N.prototype._poll=function(){var t=this,e=this._checkForGamepadChange();if(e){this.gamepadconnected=!0,this.gamepadConnected=!0,this.gamepadSupported=!0;var i=this.gamepads,n=this._buttonNames;Object.keys(e).map((function(a){var s=e[a];if(s){typeof s!==t._prevRawGamepadTypes[a]&&(t._prevRawGamepadTypes[a]=typeof o);for(var r={},o=i[a]||{leftStick:{x:0,y:0},rightStick:{x:0,y:0},dPad:{x:0,y:0},buttons:{},_pressed:{},timestamp:0},h=t._heldTimestampByGamepad[a]||{},l=0,u=n.length;l<u;l++){var c=n[l],d=h[c],p=Boolean(o._pressed[c]),f=o._pressed[c]=R(s,l),m=Date.now();p&&!f?(r[c]={released:!0,held:!1},h&&delete h[c]):f&&(d?(d.gamepadTimestamp===s.timestamp&&m>d.browserTimestamp+t._heldButtonDelay||s.timestamp>d.gamepadTimestamp+t._heldButtonDelay)&&(r[c]={held:!0}):h[c]={gamepadTimestamp:s.timestamp,browserTimestamp:m})}t._heldTimestampByGamepad[a]=h,o.timestamp=s.timestamp,o.buttons=r,o.leftStick.x=s.axes[0],o.leftStick.y=s.axes[1],o.rightStick.x=s.axes[2],o.rightStick.y=s.axes[3],o.dPad.x=(o.buttons.dPadLeft?-1:0)+(o.buttons.dPadRight?1:0),o.dPad.y=(o.buttons.dPadUp?-1:0)+(o.buttons.dPadDown?1:0),t.gamepads[a]=o}})),this.update()}},N.prototype._setupPoll=function(){this._ticking||(this._ticking=!0,this._tick())},N.prototype._tick=function(){var t=N.prototype._tick.bind(this);this._poll(),this._ticking&&(window.requestAnimationFrame?window.requestAnimationFrame(t):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(t):window.webkitRequestAnimationFrame&&window.webkitRequestAnimationFrame(t))},N.prototype._removePoll=function(){this._ticking=!1};var W=function(){return navigator.getGamepads||Boolean(navigator.webkitGetGamepads)||Boolean(navigator.webkitGamepads)},G=new N,L=[],U={isDown:function(t,e){if(L.length>0){var i=L[t+1];return!(!i.buttons[e]||!i.buttons[e].held)}},isStickDown:function(t,e,i){if(L.length>0){var n=L[t+1];if("right"===e&&n.rightStick)if("right"===i){if(n.rightStick.x>.5)return!0}else if("left"===i){if(n.rightStick.x<-.5)return!0}else if("up"===i){if(n.rightStick.y<-.5)return!0}else{if("down"!==i)return!1;if(n.rightStick.y>.5)return!0}if("left"===e&&n.leftStick)if("right"===i){if(n.leftStick.x>.5)return!0}else if("left"===i){if(n.leftStick.x<-.5)return!0}else if("up"===i){if(n.leftStick.y<-.5)return!0}else{if("down"!==i)return!1;if(n.leftStick.y>.5)return!0}}}};G.onUpdate((function(t){L=t,G.gamepadsConnected}));var K=U,q=function(){function t(){Object(s.a)(this,t),this._previousKeyboardKeys={},this._previousGamepadStick={},this._previousGamepadButton={},this.gamepadIndex=0}return Object(r.a)(t,[{key:"keyboardDownOnce",value:function(t){return!this._previousKeyboardKeys[t]&&F.isDown(t)?(this._previousKeyboardKeys[t]=!0,!0):(this._previousKeyboardKeys[t]&&!F.isDown(t)&&(this._previousKeyboardKeys[t]=!1),!1)}},{key:"gamepadStickDownOnce",value:function(t,e){this._previousGamepadStick[t+e]||K.isStickDown(this.gamepadIndex,t,e)?this._previousGamepadStick[t+e]&&!K.isStickDown(this.gamepadIndex,t,e)&&(this._previousGamepadStick[t+e]=!1):this._previousGamepadStick[t+e]=!0}},{key:"gamepadButtonDownOnce",value:function(t){this._previousGamepadButton[t]||K.isDown(this.gamepadIndex,t)?this._previousGamepadButton[t]&&!K.isDown(this.gamepadIndex,t)&&(this._previousGamepadButton[t]=!1):this._previousGamepadButton[t]=!0}}]),t}(),X=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).state=t,n}return Object(r.a)(i,[{key:"update",value:function(){var t=this.state,e=t.currentMenu.selectedItem;e.isEditing||(this.keyboardDownOnce(F.UP)||K.isStickDown(0,"left","up")?t.currentMenu.moveUp():(this.keyboardDownOnce(F.DOWN)||K.isStickDown(0,"left","down"))&&t.currentMenu.moveDown()),e.editable&&e.isEditing&&(this.keyboardDownOnce(F.BACKSPACE)?e.value=e.value.slice(0,-1):F.lastPressedIsChar()&&this.keyboardDownOnce(F[F.keyByCode(F.lastPressed)])&&(e.value+=F.lastPressedChar())),(this.keyboardDownOnce(F.ENTER)||this.keyboardDownOnce(F.SPACE)||this.gamepadButtonDownOnce("actionSouth"))&&t.currentMenu.selectCurrentItem()}}]),i}(q),Y=i(7),Z=i(6),J=i(2),Q=function(){function t(){Object(s.a)(this,t),this.width=800,this.height=600,this._initialized=!1,this.clearColor=0,this.viewContainers=new Map,this._currentViewContainer=null,this.currentViewContainerName=null,this.camera=null}return Object(r.a)(t,[{key:"init",value:function(){this.scene=new J.q;var t,e=Object(a.a)(this.viewContainers.entries());try{for(e.s();!(t=e.n()).done;){var i=Object(n.a)(t.value,2),s=i[0],r=i[1];r.init(),r.width=this.width,r.height=this.height,this.scene.add(r.mesh),s===this.currentViewContainerName?(r.visible=!0,this._currentViewContainer=r):r.visible=!1}}catch(o){e.e(o)}finally{e.f()}}},{key:"update",value:function(t){this._currentViewContainer?this._currentViewContainer.update(t):console.warn("no current ViewContainer")}},{key:"size",set:function(t){if(this.width=t.width,this.height=t.height,this.camera&&(this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix()),this._initialized){var e,i=Object(a.a)(this.viewContainers.values());try{for(i.s();!(e=i.n()).done;){var n=e.value;n.width=this.width,n.height=this.height}}catch(s){i.e(s)}finally{i.f()}}}},{key:"currentViewContainer",get:function(){return this._currentViewContainer},set:function(t){var e=this.viewContainers.get(t);this._initialized&&(this._currentViewContainer&&(this._currentViewContainer.visible=!1),e.visible=!0),this.currentViewContainerName=t,this._currentViewContainer=e}},{key:"addViewContainer",value:function(t,e){this._initialized&&(e.init(),e.width=this.width,e.height=this.height,this.scene.add(e.mesh)),this.viewContainers.set(t,e)}}]),t}(),$=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).state=t,n.menu=t.menus,n.clearColor=0,n}return Object(r.a)(i,[{key:"init",value:function(){Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this),this.camera=new J.m(0,this.width,this.height,0,0,1),this._initialized=!0}},{key:"update",value:function(t){Object(Y.a)(Object(Z.a)(i.prototype),"update",this).call(this,t),this.currentViewContainerName!==this.state.currentMenuName&&(this.currentViewContainer=this.state.currentMenuName)}}]),i}(Q),tt=i(8),et=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(s.a)(this,t),this.state=e,this.effectsSpriteName=i,this.backgroundSpriteName=n,this.effects=null,this.backgrounds=null,this._initialized=!1}return Object(r.a)(t,[{key:"init",value:function(){this.effectsSpriteName&&(this.effects=tt.a.getAudioSprite(this.effectsSpriteName).sound),this.backgroundSpriteName&&(this.backgrounds=tt.a.getAudioSprite(this.backgroundSpriteName).sound),this._initialized=!0}},{key:"stopEffects",value:function(){this.effects&&this.effects.stop()}},{key:"stopBackground",value:function(){this.backgrounds&&this.backgrounds.stop()}}]),t}(),it=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t,n,a){var r;return Object(s.a)(this,i),(r=e.call(this,t,n,a)).selectedItem=r.state.currentMenu.selectedItem,r}return Object(r.a)(i,[{key:"update",value:function(t){this.selectedItem!==this.state.currentMenu.selectedItem&&(this.selectedItem=this.state.currentMenu.selectedItem,this.effects.play("select"))}}]),i}(et),nt=function(){function t(){Object(s.a)(this,t),this.menuItems=new Map,this.menuItemKeys=[],this.selectedItemIndex=0,this.freeze=!1}return Object(r.a)(t,[{key:"addMenuItem",value:function(t){this.menuItemKeys.push(t.name),this.menuItems.set(t.name,t)}},{key:"selectedItem",get:function(){return this.menuItems.get(this.menuItemKeys[this.selectedItemIndex])}},{key:"moveUp",value:function(){this.freeze||(this.selectedItemIndex>0?this.selectedItemIndex-=1:this.selectedItemIndex=0)}},{key:"moveDown",value:function(){this.freeze||(this.selectedItemIndex<this.menuItemKeys.length-1?this.selectedItemIndex+=1:this.selectedItemIndex=this.menuItemKeys.length-1)}},{key:"selectCurrentItem",value:function(){this.selectedItem.action()}}]),t}(),at=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;Object(s.a)(this,t),this.name=e,this.text=i,this.onAction=n,this.editable=!1}return Object(r.a)(t,[{key:"action",value:function(){this.onAction&&this.onAction(this)}}]),t}(),st=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t,n,a,r){var o;return Object(s.a)(this,i),(o=e.call(this,t,n+": "+a,r)).label=n,o.defaultValue=a,o.isEditing=!1,o._value=a,o.editable=!0,o}return Object(r.a)(i,[{key:"action",value:function(){this.isEditing=!this.isEditing,!this.isEditing&&this.onAction&&this.onAction(this._value)}},{key:"value",get:function(){return this._value},set:function(t){this._value=t,this.text=this.label+": "+t}}]),i}(at),rt=function(){function t(e,i){if(Object(s.a)(this,t),this.mapping=tt.a.getAtlasMapping(e),!this.mapping)throw new Error("TextureAtlas does not exists",e);this.texture=i?tt.a.cloneTexture(e):tt.a.getTexture(e),this.texture.wrapS=J.p,this.texture.wrapT=J.p,this.width=this.mapping.meta.size.w,this.height=this.mapping.meta.size.h,this.frames=new Map;var n,r=Object(a.a)(this.mapping.frames);try{for(r.s();!(n=r.n()).done;){var o=n.value,h=o.frame,l=[new J.u(h.x/this.width,(this.height-h.y)/this.height),new J.u(h.x/this.width,(this.height-(h.y+h.h))/this.height),new J.u((h.x+h.w)/this.width,(this.height-(h.y+h.h))/this.height),new J.u((h.x+h.w)/this.width,(this.height-h.y)/this.height)];this.frames.set(o.filename,{bounds:l,frame:o,framePosition:{x:h.x,y:h.y},frameSize:{width:h.w,height:h.h}})}}catch(u){r.e(u)}finally{r.f()}}return Object(r.a)(t,[{key:"getFrameOffset",value:function(t){var e=this.frames.get(t+".png").framePosition;return new J.u(e.x/this.width,(this.height-e.y)/this.height)}},{key:"getFrameSize",value:function(t){return this.frames.get(t+".png").frameSize}},{key:"getBounds",value:function(t){return this.frames.get(t+".png").bounds}}]),t}(),ot=new Map,ht={getAtlas:function(t,e){if(e)return new rt(t,e);var i=ot.get(t);return i||(i=new rt(t),ot.set(t,i)),i}},lt=function(){function t(e,i,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Object(s.a)(this,t),this.textureAtlas=e,this.geometry=i,this.fixed=a,n&&(this.frame=n,a)){var r=this.textureAtlas.getFrameSize(n);this._changeSize(r.width,r.height)}}return Object(r.a)(t,[{key:"texture",get:function(){return this.textureAtlas.texture}},{key:"_changeSize",value:function(t,e){this.width=t,this.height=e;var i=this.textureAtlas.width,n=this.textureAtlas.height;if(this.geometry){var a=[new J.u(0,n/n),new J.u(0,(n-e)/n),new J.u(t/i,(n-e)/n),new J.u(t/i,n/n)];console.log(this.geometry.faces);for(var s=1;s<this.geometry.faceVertexUvs[0].length;s+=2)this.geometry.faceVertexUvs[0][s-1]=[a[0],a[1],a[3]],this.geometry.faceVertexUvs[0][s]=[a[1],a[2],a[3]];this.geometry.uvsNeedUpdate=!0}}},{key:"frame",set:function(t){var e=this.textureAtlas.getFrameOffset(t),i=this.textureAtlas.getFrameSize(t);this.fixed||i.width===this.width&&i.height===this.height||this._changeSize(i.width,i.height),this.texture.offset=e}}]),t}(),ut=function(){function t(){Object(s.a)(this,t),this.mesh=null,this.initialPosition=null,this._initialized=!1}return Object(r.a)(t,[{key:"init",value:function(){if(this.initialPosition){if(!this.mesh)throw new Error("No mesh initialized!");this.mesh.position.x=this.initialPosition.x,this.mesh.position.y=this.initialPosition.y,this.mesh.position.z=this.initialPosition.z}this._initialized=!0}},{key:"position",get:function(){return this.mesh.position},set:function(t){var e=t.x,i=t.y,n=t.z;this.mesh&&this.initialized?(e&&(this.mesh.position.x=e),i&&(this.mesh.position.y=i),n&&(this.mesh.position.z=n)):this.initialPosition={x:e,y:i,z:n}}}]),t}(),ct=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t,n){var a;return Object(s.a)(this,i),(a=e.call(this)).textureName=t,a.textureAtlasName=n,a._width=null,a._height=null,a._lightness=1,a}return Object(r.a)(i,[{key:"init",value:function(){var t=ht.getAtlas(this.textureAtlasName,!0),e=t.getFrameSize(this.textureName);this._width=e.width,this._height=e.height,this.geometry=new J.o(e.width,e.height);var n=new lt(t,this.geometry,this.textureName);this.material=new J.j({map:n.texture,transparent:!0});var a=this.material.color.getHSL();this.material.color.setHSL(a.h,a.s,this._lightness),this.mesh=new J.i(this.geometry,this.material),Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}},{key:"lightness",get:function(){return this._lightness},set:function(t){if(this._initalized){var e=this.material.color.getHSL();this.material.color.setHSL(e.h,e.s,t)}this._lightness=t}},{key:"width",set:function(t){var e=t/this._width;this.mesh.scale.x=e,this.mesh.position.x=t/2}},{key:"height",set:function(t){var e=t/this._height;this.mesh.scale.y=e,this.mesh.position.y=t/2}}]),i}(ut),dt=function(){function t(){Object(s.a)(this,t),this.staticViews=new Set,this.dynamicViews=new Set,this._backgroundView=null,this._width=800,this._height=600,this._initialized=!1}return Object(r.a)(t,[{key:"init",value:function(){this.mesh=new J.l,this._backgroundView&&(this._backgroundView.init(),this._backgroundView.width=this._width,this._backgroundView.height=this._height,this._backgroundView.mesh.renderOrder=-1,this.mesh.add(this._backgroundView.mesh));var t,e=Object(a.a)(this.staticViews);try{for(e.s();!(t=e.n()).done;){var i=t.value;i.init(),this.mesh.add(i.mesh)}}catch(o){e.e(o)}finally{e.f()}var n,s=Object(a.a)(this.dynamicViews);try{for(s.s();!(n=s.n()).done;){var r=n.value;r.init(),this.mesh.add(r.mesh)}}catch(o){s.e(o)}finally{s.f()}this._initialized=!0}},{key:"backgroundView",set:function(t){t!==this._backgroundView?(this._initialized&&(this._backgroundView.init(),this._backgroundView.width=this._width,this._backgroundView.height=this._height,this._backgroundView.mesh.renderOrder=-1,this.mesh.remove(this._backgroundView)),this._backgroundView=t):console.warn("backgroundView is the same")}},{key:"update",value:function(t){if(!this._initialized)throw new Error("View not initialized.");var e,i=Object(a.a)(this.dynamicViews);try{for(i.s();!(e=i.n()).done;){e.value.update(t)}}catch(n){i.e(n)}finally{i.f()}}},{key:"addStaticView",value:function(t,e){this._initialized&&(t.init(),this.mesh.add(t.mesh)),e&&(t.position={x:e.x,y:e.y,z:e.z}),this.staticViews.add(t)}},{key:"addDynamicView",value:function(t,e){this._initialized&&(t.init(),this.mesh.add(t.mesh)),e&&(t.position={x:e.x,y:e.y,z:e.z}),this.dynamicViews.add(t)}},{key:"visible",get:function(){return this.mesh.visible},set:function(t){this.mesh.visible=t}},{key:"width",set:function(t){var e=t/this._width;this._width=t,this._backgroundView&&(this._backgroundView.width=this._width),this.mesh.scale.x=e}},{key:"height",set:function(t){var e=t/this._height;this._height=t,this._backgroundView&&(this._backgroundView.height=this._height),this.mesh.scale.y=e}}]),t}(),pt=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];Object(s.a)(this,t),this.textureAtlas=e,this.geometry=i,this.textureFrame=new lt(this.textureAtlas,i,r+a[0],o),this.interval=n,this.frames=a,this.framePrefix=r,this.currentFrameIndex=0,this.currentDisplayTime=0,this._updateTexture()}return Object(r.a)(t,[{key:"texture",get:function(){return this.textureAtlas.texture}},{key:"_updateTexture",value:function(){var t=this.framePrefix+this.frames[this.currentFrameIndex];this.textureFrame.frame=t}},{key:"reset",value:function(){this.currentFrameIndex=0,this.currentDisplayTime=0}},{key:"update",value:function(t){this.currentDisplayTime+=1,this.currentDisplayTime>this.interval&&(this.currentDisplayTime=0,this.currentFrameIndex++,this.currentFrameIndex>=this.frames.length&&(this.currentFrameIndex=0),this._updateTexture())}},{key:"currentFrame",get:function(){return this.frames[this.currentFrameIndex]}}]),t}(),ft=(i(12),i(22));var mt={min:[0,0],max:[0,0]};function vt(t){var e=t.length/2;mt.min[0]=t[0],mt.min[1]=t[1],mt.max[0]=t[0],mt.max[1]=t[1];for(var i=0;i<e;i++){var n=t[2*i+0],a=t[2*i+1];mt.min[0]=Math.min(n,mt.min[0]),mt.min[1]=Math.min(a,mt.min[1]),mt.max[0]=Math.max(n,mt.max[0]),mt.max[1]=Math.max(a,mt.max[1])}}var yt=i(23),gt=i(14),wt=i(15),bt=["x","e","a","o","n","s","r","c","u","m","v","w","z"],xt=["m","w"],kt=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],Ot="\t".charCodeAt(0),jt=" ".charCodeAt(0);function _t(t){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(t)}function zt(t){return new Function(["return function "+t+"() {","  return this._"+t,"}"].join("\n"))()}function St(t,e){if(!t.chars||0===t.chars.length)return null;var i=Mt(t.chars,e);return i>=0?t.chars[i]:null}function It(t,e,i){if(!t.kernings||0===t.kernings.length)return 0;for(var n=t.kernings,a=0;a<n.length;a++){var s=n[a];if(s.first===e&&s.second===i)return s.amount}return 0}function Mt(t,e,i){for(var n=i=i||0;n<t.length;n++)if(t[n].id===e)return n;return-1}_t.prototype.update=function(t){if(t=gt({measure:this._measure},t),this._opt=t,this._opt.tabSize=wt(this._opt.tabSize,4),!t.font)throw new Error("must provide a valid bitmap font");var e=this.glyphs,i=t.text||"",n=t.font;this._setupSpaceGlyphs(n);var a=yt.lines(i,t),s=t.width||0;e.length=0;var r=a.reduce((function(t,e){return Math.max(t,e.width,s)}),0),o=0,h=0,l=wt(t.lineHeight,n.common.lineHeight),u=n.common.base,c=l-u,d=t.letterSpacing||0,p=l*a.length-c,f=function(t){if("center"===t)return 1;if("right"===t)return 2;return 0}(this._opt.align);h-=p,this._width=r,this._height=p,this._descender=l-u,this._baseline=u,this._xHeight=function(t){for(var e=0;e<bt.length;e++){var i=bt[e].charCodeAt(0),n=Mt(t.chars,i);if(n>=0)return t.chars[n].height}return 0}(n),this._capHeight=function(t){for(var e=0;e<kt.length;e++){var i=kt[e].charCodeAt(0),n=Mt(t.chars,i);if(n>=0)return t.chars[n].height}return 0}(n),this._lineHeight=l,this._ascender=l-c-this._xHeight;var m=this;a.forEach((function(t,a){for(var s,u=t.start,c=t.end,p=t.width,v=u;v<c;v++){var y=i.charCodeAt(v),g=m.getGlyph(n,y);if(g){s&&(o+=It(n,s.id,g.id));var w=o;1===f?w+=(r-p)/2:2===f&&(w+=r-p),e.push({position:[w,h],data:g,index:v,line:a}),o+=g.xadvance+d,s=g}}h+=l,o=0})),this._linesTotal=a.length},_t.prototype._setupSpaceGlyphs=function(t){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,t.chars&&0!==t.chars.length){var e=St(t,jt)||function(t){for(var e=0;e<xt.length;e++){var i=xt[e].charCodeAt(0),n=Mt(t.chars,i);if(n>=0)return t.chars[n]}return 0}(t)||t.chars[0],i=this._opt.tabSize*e.xadvance;this._fallbackSpaceGlyph=e,this._fallbackTabGlyph=gt(e,{x:0,y:0,xadvance:i,id:Ot,xoffset:0,yoffset:0,width:0,height:0})}},_t.prototype.getGlyph=function(t,e){var i=St(t,e);return i||(e===Ot?this._fallbackTabGlyph:e===jt?this._fallbackSpaceGlyph:null)},_t.prototype.computeMetrics=function(t,e,i,n){var a,s=this._opt.letterSpacing||0,r=this._opt.font,o=0,h=0,l=0;if(!r.chars||0===r.chars.length)return{start:e,end:e,width:0};i=Math.min(t.length,i);for(var u=e;u<i;u++){var c,d=t.charCodeAt(u);if(c=this.getGlyph(r,d)){c.xoffset;var p=(o+=a?It(r,a.id,c.id):0)+c.xadvance+s,f=o+c.width;if(f>=n||p>=n)break;o=p,h=f,a=c}l++}return a&&(h+=a.xoffset),{start:e,end:e+l,width:h}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach((function(t){Object.defineProperty(_t.prototype,t,{get:zt(t),configurable:!0})}));var Pt=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(s.a)(this,i),"string"===typeof t&&(t={text:t}),(n=e.call(this))._opt=Object.assign({},t),t&&n.update(t),n}return Object(r.a)(i,[{key:"update",value:function(t){if("string"===typeof t&&(t={text:t}),!(t=Object.assign({},this._opt,t)).font)throw new TypeError("must specify a { font } in options");this.layout=function(t){return new _t(t)}(t);var e=!1!==t.flipY,i=t.font,n=i.common.scaleW,a=i.common.scaleH,s=this.layout.glyphs.filter((function(t){var e=t.data;return e.width*e.height>0}));this.visibleGlyphs=s;var r=function(t){var e=new Float32Array(4*t.length*2),i=0;return t.forEach((function(t){var n=t.data,a=t.position[0]+n.xoffset,s=t.position[1]+n.yoffset,r=n.width,o=n.height;e[i++]=a,e[i++]=s,e[i++]=a,e[i++]=s+o,e[i++]=a+r,e[i++]=s+o,e[i++]=a+r,e[i++]=s})),e}(s),o=function(t,e,i,n){var a=new Float32Array(4*t.length*2),s=0;return t.forEach((function(t){var r=t.data,o=r.x+r.width,h=r.y+r.height,l=r.x/e,u=r.y/i,c=o/e,d=h/i;n&&(u=(i-r.y)/i,d=(i-h)/i),a[s++]=l,a[s++]=u,a[s++]=l,a[s++]=d,a[s++]=c,a[s++]=d,a[s++]=c,a[s++]=u})),a}(s,n,a,e),h=ft([],{clockwise:!0,type:"uint16",count:s.length});if(this.setIndex(h),this.addAttribute("position",new J.c(r,2)),this.addAttribute("uv",new J.c(o,2)),!t.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(t.multipage){var l=function(t){var e=new Float32Array(4*t.length*1),i=0;return t.forEach((function(t){var n=t.data.page||0;e[i++]=n,e[i++]=n,e[i++]=n,e[i++]=n})),e}(s);this.addAttribute("page",new J.c(l,1))}}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new J.r);var t=this.attributes.position.array,e=this.attributes.position.itemSize;if(!t||!e||t.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);!function(t,e){vt(t);var i=mt.min[0],n=mt.min[1],a=mt.max[0]-i,s=mt.max[1]-n,r=Math.sqrt(a*a+s*s);e.center.set(i+a/2,n+s/2,0),e.radius=r/2}(t,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new J.b);var t=this.boundingBox,e=this.attributes.position.array,i=this.attributes.position.itemSize;!e||!i||e.length<2?t.makeEmpty():function(t,e){vt(t),e.min.set(mt.min[0],mt.min[1],0),e.max.set(mt.max[0],mt.max[1],0)}(e,t)}}]),i}(J.d),Vt=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,i),n=e.call(this);var r=a.font||"keep_calm";return n._text=t,n.font=tt.a.getFont(r),n.width=a.width||100,n.align=a.aligh||"left",n._color=a.color||16711680,n}return Object(r.a)(i,[{key:"init",value:function(){this.geometry=new Pt({text:this._text,width:this.width,align:this.align,font:this.font.mapping,multipage:!0}),this.material=new J.j({map:this.font.textures[0],transparent:!0,color:this._color}),this.mesh=new J.i(this.geometry,this.material),this.mesh.rotation.y=Math.PI/180*180,this.mesh.rotation.z=Math.PI/180*180,Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}},{key:"color",get:function(){return this._color},set:function(t){this.material.color.setHex(t)}},{key:"text",get:function(){return this._text},set:function(t){(t=t.toString())!==this._text&&(this._text=t,this._updateGeometry())}},{key:"height",get:function(){return this.geometry.layout.height}},{key:"_updateGeometry",value:function(){this.geometry.update({text:this._text,width:this.width,align:this.align,font:this.font.mapping}),this.geometry.uvsNeedUpdate=!0}}]),i}(ut),Tt=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t,n){var a;return Object(s.a)(this,i),(a=e.call(this)).textureName=t,a.textureAtlasName=n,a}return Object(r.a)(i,[{key:"init",value:function(){var t=ht.getAtlas(this.textureAtlasName,!0),e=t.getFrameSize(this.textureName);this.geometry=new J.o(e.width,e.height);var n=new lt(t,this.geometry,this.textureName),a=new J.j({map:n.texture,transparent:!0});this.mesh=new J.i(this.geometry,a),Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}}]),i}(ut),Ct=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{selectedTextColor:65280,textColor:16768477};return Object(s.a)(this,i),(n=e.call(this)).menu=t,n.options=a,n.viewMenuItemPairs=new Map,n.selectedItem=null,n.selectedView=null,n.logoView=new Tt("logo","ui"),n}return Object(r.a)(i,[{key:"init",value:function(){this.mesh=new J.l;var t=0;this.selectedItem=this.menu.selectedItem;var e,n=Object(a.a)(this.menu.menuItems.values());try{for(n.s();!(e=n.n()).done;){var s=e.value,r=new Vt(s.text,{width:300});r.init(),r.mesh.position.y=200-100*t,r.mesh.position.x+=100,this.selectedItem===s?r.color=this.options.selectedTextColor:r.color=this.options.textColor,this.viewMenuItemPairs.set(s,r),this.mesh.add(r.mesh),t+=1}}catch(o){n.e(o)}finally{n.f()}Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}},{key:"update",value:function(){if(this.selectedItem!==this.menu.selectedItem){var t=this.selectedItem;this.selectedItem=this.menu.selectedItem;var e=this.viewMenuItemPairs.get(this.selectedItem),i=this.viewMenuItemPairs.get(t);e.text=this.selectedItem.text,i.color=this.options.textColor,e.color=this.options.selectedTextColor}this.menu.selectedItem.editable&&this.menu.selectedItem.isEditing?this.viewMenuItemPairs.get(this.selectedItem).text=this.selectedItem.text+"-":this.viewMenuItemPairs.get(this.selectedItem).text=this.selectedItem.text}}]),i}(ut),At={create:function(t){var e=new nt,i=new dt;e.addMenuItem(new st("name","Name","Unknown Soldier",(function(e){t.changeOption("name",e)}))),e.addMenuItem(new at("back","- back",(function(){t.currentMenu="main"}))),i.addDynamicView(new Ct(e),{x:300,y:100,z:0});var n=new ct("iwo_jima","ui");return n.lightness=.5,i.backgroundView=n,{viewContainer:i,menu:e}}},Dt=function(){function t(e,i){Object(s.a)(this,t),this.name=e,this.engine=i,this.inputs=new Set,this.views=new Set,this.audio=null,this._initialized=!1}return Object(r.a)(t,[{key:"addView",value:function(t){this.views.add(t)}},{key:"update",value:function(){throw new TypeError("State requires update() method")}},{key:"init",value:function(){if(!this._initialized){this.audio&&this.audio.init();var t,e=Object(a.a)(this.views.values());try{for(e.s();!(t=e.n()).done;){t.value.init()}}catch(i){e.e(i)}finally{e.f()}this._initialized=!0}}},{key:"updateInputs",value:function(t){var e,i=Object(a.a)(this.inputs.values());try{for(i.s();!(e=i.n()).done;){e.value.update(t)}}catch(n){i.e(n)}finally{i.f()}}},{key:"render",value:function(t){var e,i=Object(a.a)(this.views.values());try{for(i.s();!(e=i.n()).done;){e.value.update(t)}}catch(n){i.e(n)}finally{i.f()}}},{key:"updateAudio",value:function(t){this.audio&&this.audio.update(t)}}]),t}(),Et=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t,n){var a;return Object(s.a)(this,i),(a=e.call(this,"play")).collisionSystem=null,a.bulletSystem=null,a.player=null,a.map=n,a.match=t,a.showScores=!1,a.paused=!1,a.onPause=null,a}return Object(r.a)(i,[{key:"init",value:function(){Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}},{key:"soldiers",get:function(){return this.match.soldiers}},{key:"pause",value:function(){this.onPause&&this.onPause(),this.paused=!0}},{key:"resume",value:function(){this.paused=!1}},{key:"update",value:function(t){if(Object(Y.a)(Object(Z.a)(i.prototype),"updateInputs",this).call(this,t),!this.paused){Object(Y.a)(Object(Z.a)(i.prototype),"updateAudio",this).call(this,t),this.bulletSystem&&this.bulletSystem.update(t);var e,n=Object(a.a)(this.soldiers);try{for(n.s();!(e=n.n()).done;){var s=e.value;if(s.update(t),s.dead){var r=this.map.randomRespawnPosition();s.respawn(r)}}}catch(o){n.e(o)}finally{n.f()}this.match.update(t),this.collisionSystem&&this.collisionSystem.update(t)}}}]),i}(Dt),Bt=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).state=t,n}return Object(r.a)(i,[{key:"init",value:function(){Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this),this.camera=new J.m(0,this.width,this.height,0,0,1),this._initialized=!0}},{key:"update",value:function(t){Object(Y.a)(Object(Z.a)(i.prototype),"update",this).call(this,t)}}]),i}(Q),Ft=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).player=t.player,n}return Object(r.a)(i,[{key:"init",value:function(){this.mesh=new J.l;var t=ht.getAtlas("ui",!1),e=new J.j({map:t.texture,transparent:!0}),n=t.getFrameSize("ammo");this.geometry=new J.o(n.width,n.height),this.textureFrame=new lt(t,this.geometry,"ammo");var a=new J.i(this.geometry,e);a.scale.set(.5,.5,1),this.magazineText=new Vt("0",{color:16777164}),this.magazineText.init(),this.magazineText.mesh.scale.set(2,2,1),this.magazineText.position={x:n.width+10,y:-this.magazineText.height},this.mesh.add(this.magazineText.mesh),this.ammoText=new Vt("0",{color:16777113}),this.ammoText.init(),this.ammoText.mesh.scale.set(1,1,1),this.ammoText.position={x:n.width+64,y:-this.ammoText.height},a.position.x=20,this.magazineText.position.x=40,this.ammoText.position.x=120,this.mesh.add(this.ammoText.mesh),this.mesh.add(a),Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}},{key:"ammo",set:function(t){null===t&&(this.ammoText.text="-"),this.ammoText.text=t}},{key:"magazine",set:function(t){null===t&&(this.magazineText.text="-"),this.magazineText.text=t}},{key:"update",value:function(t){if(this.player.currentWeapon){var e=this.player.currentWeapon;this.ammo=e.ammo,this.magazine=e.magazine}else this.ammo=null,this.magazine=null}}]),i}(ut),Nt=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).player=t.player,n._healthScale=1,n}return Object(r.a)(i,[{key:"init",value:function(){var t=new J.j({color:13369344});this.geometry=new J.o(200,20),this.geometry.applyMatrix((new J.h).makeTranslation(100,0,0)),this.mesh=new J.i(this.geometry,t),Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}},{key:"healthScale",set:function(t){if(t!==this._healthScale)if(this._healthScale=t,t<=0)this.mesh.visible=!1;else{this.mesh.visible||(this.mesh.visible=!0);var e=this.mesh.position.x;this.mesh.scale.set(t,1,1),this.mesh.position.x=e}}},{key:"update",value:function(){this.healthScale=this.player.health/this.player.maxHealth}}]),i}(ut),Ht=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).player=t.player,n._weapon=null,n}return Object(r.a)(i,[{key:"init",value:function(){var t=ht.getAtlas("ui",!0);this.geometry=new J.o(196,64),this.textureFrame=new lt(t,this.geometry),this.material=new J.j({map:this.textureFrame.texture,transparent:!0}),this.mesh=new J.i(this.geometry,this.material),Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}},{key:"weapon",set:function(t){this._weapon!==t?(this.mesh.visible||(this.mesh.visible=!0),this._weapon=t,this.textureFrame.frame=t):null===t&&this.mesh.visible&&(this.mesh.visible=!1)}},{key:"update",value:function(t){if(this.player.currentWeapon){var e=this.player.currentWeapon;this.weapon=e.name}else this.weapon=null}}]),i}(ut);var Rt=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).state=t,n.match=t.match,n}return Object(r.a)(i,[{key:"init",value:function(){this.mesh=new J.l;var t=new J.k({color:0,transparent:!0,opacity:.5}),e=new J.o(600,800);this.mesh.add(new J.i(e,t)),this.scoreTextView=new Vt(this._scoreText,{color:16711552,width:600,align:"left"}),this.scoreTextView.init(),this.mesh.visible=!1,this.mesh.add(this.scoreTextView.mesh),Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}},{key:"update",value:function(){if(this.state.showScores){this.mesh.visible||(this.mesh.visible=!0);var t=function(t){var e,i="",s=Object(a.a)(t.entries());try{for(s.s();!(e=s.n()).done;){var r=Object(n.a)(e.value,2),o=r[0],h=r[1];i+="".concat(o," - k: ").concat(h.kills," - d: ").concat(h.deaths," \n");var l,u=[],c=Object(a.a)(h.soldiers);try{for(c.s();!(l=c.n()).done;){var d=l.value,p="".concat(d.name," - k: ").concat(d.totalKills," - d: ").concat(d.totalDeaths);u.push(p)}}catch(f){c.e(f)}finally{c.f()}i+=u.join("\n"),i+="\n----------------------\n"}}catch(f){s.e(f)}finally{s.f()}return i}(this.match.sortedScores());this.scoreTextView.text=t}else this.mesh.visible&&(this.mesh.visible=!1)}}]),i}(ut),Wt=function(){function t(e,i,n,a){Object(s.a)(this,t),this.factoryFunction=e,this.totalInstances=0,this.allocationLimit=a,this.allocationNumber=n,this.availableInstances=[],this.allocate(i)}return Object(r.a)(t,[{key:"size",get:function(){return this.totalInstances}},{key:"allocate",value:function(t){if(!(this.totalInstances+t<this.allocationLimit))throw new Error("ObjectPool allocation limit reached");this.totalInstances+=t;for(var e=0;e<t;e++)this.availableInstances.push(this.factoryFunction());return this}},{key:"get",value:function(){return this.availableInstances.length<1&&this.allocate(this.allocationNumber),this.availableInstances.pop()}},{key:"free",value:function(t){return-1===this.availableInstances.indexOf(t)&&this.availableInstances.push(t),this}},{key:"clear",value:function(){for(;this.availableInstances.length;)this.availableInstances.pop();return this.totalInstances=0,this}}]),t}(),Gt=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).bullet=t,n}return Object(r.a)(i,[{key:"init",value:function(){var t=this.bullet,e=ht.getAtlas("world",!1);this.geometry=new J.o(2,8),this.textureFrame=new lt(e,this.geometry,"bullet1"),this.material=new J.j({map:this.textureFrame.texture,transparent:!0}),this.mesh=new J.i(this.geometry,this.material),this.mesh.position.set(t.position.x,t.position.y,t.position.z),this.mesh.rotation.z=t.angle+Math.PI/180*90,Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}},{key:"update",value:function(t){var e=this.bullet.previousPosition,i=this.bullet.position;this.mesh.position.x=e.x+(i.x-e.x)*t,this.mesh.position.y=e.y+(i.y-e.y)*t,this.mesh.position.z=e.z+(i.z-e.z)*t,this.mesh.rotation.z=this.bullet.angle+Math.PI/180*90,this.bullet.dead?this.mesh.visible=!1:this.mesh.visible=!0}}]),i}(ut),Lt=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,i),(n=e.call(this)).bulletSystem=t,n.bulletViewPool=new Wt((function(){return new Gt(null)}),n.bulletSystem.poolSize,10,a.poolLimit||200),n.bulletViewPairs=new WeakMap,n}return Object(r.a)(i,[{key:"init",value:function(){this.mesh=new J.l,Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}},{key:"update",value:function(t){this.bulletSystem.poolSize>this.bulletViewPool.size&&this.bulletViewPool.allocate(this.bulletSystem.poolSize-this.bulletViewPool.size);var e,i=Object(a.a)(this.bulletSystem.deadBullets);try{for(i.s();!(e=i.n()).done;){var n=e.value,s=this.bulletViewPairs.get(n);s&&s.update(t),this.bulletSystem.deadBullets.delete(n)}}catch(u){i.e(u)}finally{i.f()}var r,o=Object(a.a)(this.bulletSystem.activeBullets);try{for(o.s();!(r=o.n()).done;){var h=r.value,l=this.bulletViewPairs.get(h);l||((l=this.bulletViewPool.get()).bullet=h,l.init(),this.mesh.add(l.mesh),this.bulletViewPairs.set(h,l)),l.update(t)}}catch(u){o.e(u)}finally{o.f()}}}]),i}(ut),Ut=["animation_water_0001","animation_water_0002","animation_water_0003","animation_water_0004","animation_water_0005","animation_water_0006","animation_water_0007","animation_water_0008","animation_water_0009"];function Kt(t,e){var i=[];if(t.walls.top){var n=e.getBounds(t.walls.top),a=new J.o(t.width,t.height);a.faceVertexUvs[0][0]=[n[0],n[1],n[3]],a.faceVertexUvs[0][1]=[n[1],n[2],n[3]],a.translate(0,0,t.height/2),i.push(a)}for(var s=new J.g,r=0,o=i;r<o.length;r++){var h=o[r];s.merge(h)}return s}var qt=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t,n){var a,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ut;return Object(s.a)(this,i),(a=e.call(this)).map=t,a._textureAtlasName=n,a._waterFrames=r,a.blocks=t.blocks(["water"]),a.blockWidth=t.blockWidth,a.blockHeight=t.blockHeight,a.blockDepth=t.blockDepth,a}return Object(r.a)(i,[{key:"init",value:function(){this.textureAtlas=ht.getAtlas(this._textureAtlasName,!0),this.geometry=function(t,e){var i,n=new J.g,s=Object(a.a)(t);try{for(s.s();!(i=s.n()).done;){var r=i.value,o=Kt(r,e);o.translate(r.position.x,r.position.y,r.position.z),n.merge(o)}}catch(h){s.e(h)}finally{s.f()}return n.mergeVertices(),n}(this.blocks,this.textureAtlas),this.animation=new pt(this.textureAtlas,this.geometry,9,!0,this._waterFrames,"",!0),this.animation.textureFrame.width=100,this.animation.textureFrame.height=100,this.material=new J.k({map:this.textureAtlas.texture,transparent:!1}),this.mesh=new J.i(this.geometry,this.material),this.mesh.applyMatrix((new J.h).makeTranslation(this.blockWidth/2,this.blockHeight/2,this.blockDepth/2)),Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}},{key:"update",value:function(){this.animation.update()}}]),i}(ut);function Xt(t,e){var i=[];if(t.walls.south){var n=e.getBounds(t.walls.south),a=new J.o(t.width,t.height);a.faceVertexUvs[0][0]=[n[0],n[1],n[3]],a.faceVertexUvs[0][1]=[n[1],n[2],n[3]],a.rotateY(Math.PI/2),a.translate(t.width/2,0,0),i.push(a)}if(t.walls.north){var s=e.getBounds(t.walls.north),r=new J.o(t.width,t.height);r.faceVertexUvs[0][0]=[s[0],s[1],s[3]],r.faceVertexUvs[0][1]=[s[1],s[2],s[3]],r.rotateY(-Math.PI/2),r.translate(-t.width/2,0,0),i.push(r)}if(t.walls.west){var o=e.getBounds(t.walls.west),h=new J.o(t.width,t.height);h.faceVertexUvs[0][0]=[o[0],o[1],o[3]],h.faceVertexUvs[0][1]=[o[1],o[2],o[3]],h.rotateX(Math.PI/2),h.translate(0,-t.height/2,0),i.push(h)}if(t.walls.east){var l=e.getBounds(t.walls.east),u=new J.o(t.width,t.height);u.faceVertexUvs[0][0]=[l[0],l[1],l[3]],u.faceVertexUvs[0][1]=[l[1],l[2],l[3]],u.rotateX(-Math.PI/2),u.rotateY(Math.PI/2),u.translate(0,t.height/2,0),i.push(u)}if(t.walls.top){var c=e.getBounds(t.walls.top),d=new J.o(t.width,t.height);d.faceVertexUvs[0][0]=[c[0],c[1],c[3]],d.faceVertexUvs[0][1]=[c[1],c[2],c[3]],d.translate(0,0,t.height/2),i.push(d)}for(var p=new J.g,f=0,m=i;f<m.length;f++){var v=m[f];p.merge(v)}return p}var Yt=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t,n){var a;return Object(s.a)(this,i),(a=e.call(this)).map=t,a.textureAtlasName=n,a.blocks=t.blocks(["wall"]),a.blockWidth=t.blockWidth,a.blockHeight=t.blockHeight,a.blockDepth=t.blockDepth,a}return Object(r.a)(i,[{key:"init",value:function(){this.textureAtlas=ht.getAtlas(this.textureAtlasName,!1),this.geometry=function(t,e){var i,n=new J.g,s=Object(a.a)(t);try{for(s.s();!(i=s.n()).done;){var r=i.value,o=Xt(r,e);o.translate(r.position.x,r.position.y,r.position.z),n.merge(o)}}catch(h){s.e(h)}finally{s.f()}return n.mergeVertices(),n}(this.blocks,this.textureAtlas),this.material=new J.k({map:this.textureAtlas.texture,transparent:!0,side:J.e}),this.mesh=new J.i(this.geometry,this.material),this.mesh.applyMatrix((new J.h).makeTranslation(this.blockWidth/2,this.blockHeight/2,this.blockDepth/2)),Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}}]),i}(ut),Zt=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).light=t,n}return Object(r.a)(i,[{key:"init",value:function(){this.mesh=new J.l;var t=ht.getAtlas("world",!0),e=new J.o(32,32);this.textureFrame=new lt(t,e,"light1");var n=new J.k({map:this.textureFrame.texture,transparent:!0}),a=new J.i(e,n);a.position.set(this.light.sourcePosition.x,this.light.sourcePosition.y,this.light.sourcePosition.z),a.rotateZ(this.light.angle+Math.PI/180*90),this.mesh.add(a);var s=new J.s(267386880,1),r=new J.l;r.position.set(this.light.x,this.light.y,-this.light.z),r.rotateZ(this.light.angle+Math.PI/180*90),this.mesh.add(r),s.target=r,s.angle=Math.PI/180*45,s.position.set(this.light.sourcePosition.x,this.light.sourcePosition.y,this.light.sourcePosition.z),s.rotateZ(this.light.angle+Math.PI/180*90),this.mesh.add(s),this.mesh.translateX(50),this.mesh.translateY(50),this.mesh.translateZ(100),Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}}]),i}(ut),Jt=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).map=t,n.wallsView=new Yt(t,"tiles"),n.waterView=new qt(t,"tiles"),n}return Object(r.a)(i,[{key:"init",value:function(){this.mesh=new J.l;var t,e=Object(a.a)(this.map.lights);try{for(e.s();!(t=e.n()).done;){var n=t.value,s=new Zt(n);s.init(),this.mesh.add(s.mesh)}}catch(r){e.e(r)}finally{e.f()}this.wallsView.init(),this.waterView.init(),this.mesh.add(this.wallsView.mesh),this.mesh.add(this.waterView.mesh),Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}},{key:"update",value:function(){this.waterView.update()}}]),i}(ut),Qt=["walk_0001","walk_0002","walk_0003","walk_0004","walk_0005","walk_0006","walk_0007","walk_0008"],$t=["run_0001","run_0002","run_0003","run_0004","run_0005","run_0006","run_0007","run_0008"],te=["idle_0001"],ee={american:27906,german:13421568},ie=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).soldier=t,n._team=t?t.team:"american",n}return Object(r.a)(i,[{key:"team",set:function(t){t!==this._team&&(this._team=t,this.material.color.setHex(ee[t]))}},{key:"init",value:function(){var t=this.soldier;this.geometry=new J.o(2*t.height,2*t.width),this.geometry.rotateZ(Math.PI);var e=ht.getAtlas("soldier",!0);this.animations={walk:new pt(e,this.geometry,9,!0,Qt,"soldier_weapon_"),run:new pt(e,this.geometry,5,!0,$t,"soldier_weapon_"),idle:new pt(e,this.geometry,8,!0,te,"soldier_weapon_")},this.currentAnimation=this.animations.idle,this.material=new J.k({map:e.texture,transparent:!0,color:ee[this._team]}),this.material.color.offsetHSL(.1,.8,.4),this.mesh=new J.i(this.geometry,this.material),this.mesh.position.set(t.position.x,t.position.y,t.position.z),this.mesh.rotation.z=t.angle,Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}},{key:"_updateAnimation",value:function(){var t=this.currentAnimation;(t=this.soldier.isMoving?this.soldier.isRunning?this.animations.run:this.animations.walk:this.animations.idle)!==this.currentAnimation&&(this.currentAnimation=t,this.currentAnimation.reset()),this.currentAnimation.update()}},{key:"update",value:function(t){var e=this.soldier.depth;this.soldier.dead?(this.mesh.visible=!1,e=0):this.mesh.visible||(this.mesh.visible=!0);var i=this.soldier.previousPosition,n=this.soldier.position;this.mesh.position.x=i.x+(n.x-i.x)*t,this.mesh.position.y=i.y+(n.y-i.y)*t,this.mesh.position.z=i.z+(n.z-i.z)*t,this.mesh.position.z+=e,this.mesh.rotation.z=this.soldier.angle+Math.PI/180*90,this._updateAnimation()}}]),i}(ut),ne=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,i),(n=e.call(this)).soldiers=t,n.viewPool=new Wt((function(){return new ie(null)}),n.soldiers.size,10,a.poolLimit||200),n.viewPairs=new WeakMap,n}return Object(r.a)(i,[{key:"init",value:function(){this.mesh=new J.l,this._initialized=!0}},{key:"update",value:function(t){this.viewPool.poolSize>this.soldiers.length+1&&this.viewPool.allocate(this.soldiers.length+1-this.viewPool.size);var e,i=Object(a.a)(this.soldiers);try{for(i.s();!(e=i.n()).done;){var n=e.value,s=this.viewPairs.get(n);s||n.dead?s&&(s.update(t),n.dead&&this.viewPairs.has(n)&&(this.viewPool.free(s),this.viewPairs.delete(n))):((s=this.viewPool.get()).soldier=n,s.init(),s.team=n.team,this.mesh.add(s.mesh),this.viewPairs.set(n,s))}}catch(r){i.e(r)}finally{i.f()}}}]),i}(ut),ae=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).state=t,n.map=n.state.map,n.cameraFollowView=null,n.clearColor=0,n}return Object(r.a)(i,[{key:"init",value:function(){Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this),this.camera=new J.n(75,this.map.width/this.map.height,100,1e3),this.camera.position.x=this.map.width/2*this.map.blockWidth,this.camera.position.y=this.map.height/2*this.map.blockHeight,this.camera.position.z=6*this.map.blockDepth;var t=new J.a(197379);this.scene.add(t),this.cameraFollowLight=new J.s(268435455,2,800),this.cameraFollowLight.angle=Math.PI/180*135,this.cameraFollowLight.exponent=10,this.cameraFollowLight.target=this.cameraFollowView.mesh,this.scene.add(this.cameraFollowLight),this._initialized=!0}},{key:"update",value:function(t){this.state.paused||(Object(Y.a)(Object(Z.a)(i.prototype),"update",this).call(this,t),this.cameraFollowView&&(this.camera.position.setX(this.cameraFollowView.position.x),this.camera.position.setY(this.cameraFollowView.position.y),this.cameraFollowLight.position.setX(this.cameraFollowView.position.x),this.cameraFollowLight.position.setY(this.cameraFollowView.position.y),this.cameraFollowLight.position.setZ(this.cameraFollowView.position.z+400)))}}]),i}(Q),se=function(t){var e=new Bt(t),i=new dt,n=new Rt(t),a=new Ht(t),s=new Ft(t),r=new Nt(t);return i.addDynamicView(n,{x:100,y:100,z:0}),i.addDynamicView(a,{x:280,y:540,z:0}),i.addDynamicView(s,{x:10,y:540,z:0}),i.addDynamicView(r,{x:600,y:540,z:0}),e.addViewContainer("main",i),e.currentViewContainer="main",e},re=function(t){var e=new ae(t),i=new ie(t.player),n=new ne(t.soldiers),a=new Lt(t.bulletSystem),s=new Jt(t.map),r=new dt;return r.addDynamicView(i),r.addDynamicView(n),r.addDynamicView(a),r.addDynamicView(s),e.addViewContainer("main",r),e.currentViewContainer="main",e.cameraFollowView=i,e},oe=i(16);function he(t){var e,i=new Map,s=Object(a.a)(this.teams.entries());try{for(s.s();!(e=s.n()).done;){var r,o=Object(n.a)(e.value,2),h=o[0],l=o[1],u=Object(a.a)(l);try{for(u.s();!(r=u.n()).done;){var c=r.value,d=i.get(h);d?i.set(h,d+c[t]):i.set(h,c[t])}}catch(p){u.e(p)}finally{u.f()}}}catch(p){s.e(p)}finally{s.f()}}var le=function(){function t(e){Object(s.a)(this,t),this.matchTime=0,this.matchDuration=3e5,this.soldiers=new Set,this.teamNames=[],this.teams=new Map;var i,n=Object(a.a)(e);try{for(n.s();!(i=n.n()).done;){var r=i.value;this.teamNames.push(r),this.teams.set(r,new Set)}}catch(o){n.e(o)}finally{n.f()}}return Object(r.a)(t,[{key:"teamWithLeastPlayers",value:function(){var t,e=null,i=Number.MAX_VALUE,n=Object(a.a)(this.teamNames);try{for(n.s();!(t=n.n()).done;){var s=t.value,r=this.teams.get(s).size;r<i&&(e=s,i=r)}}catch(o){n.e(o)}finally{n.f()}return e}},{key:"addSoldier",value:function(t,e){e||(e=this.teamWithLeastPlayers()),t.team=e;var i=this.teams.get(e);return!!i&&(i.add(t),this.soldiers.add(t),!0)}},{key:"sortedScores",value:function(){var t,e=new Map,i=Object(a.a)(new Set(Object(oe.a)(this.soldiers)));try{for(i.s();!(t=i.n()).done;){var n=t.value,s=e.get(n.team);s?(s.kills+=n.totalKills,s.deaths+=n.totalDeaths,s.soldiers.push(n)):e.set(n.team,{kills:n.totalKills,deaths:n.totalDeaths,soldiers:[n]})}}catch(h){i.e(h)}finally{i.f()}var r,o=Object(a.a)(e.values());try{for(o.s();!(r=o.n()).done;){r.value.soldiers.sort((function(t,e){return e.kills-t.kills}))}}catch(h){o.e(h)}finally{o.f()}return new Map(Object(oe.a)(e.entries()).sort((function(t,e){return e[1].kills-t[1].kills})))}},{key:"removeSoldier",value:function(t){var e,i=Object(a.a)(this.teams.values());try{for(i.s();!(e=i.n()).done;){var n=e.value;if(n.has(t))return n.delete(t),!0}}catch(s){i.e(s)}finally{i.f()}return!1}},{key:"killsByTeam",value:function(){return he("kills")}},{key:"deathsByTeam",value:function(){return he("deaths")}},{key:"start",value:function(){}},{key:"end",value:function(){}},{key:"update",value:function(t){this.matchTime+=t,this.matchTime>=this.matchDuration&&this.end()}}]),t}(),ue=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).player=t,n}return Object(r.a)(i,[{key:"update",value:function(t){F.isDown(F.UP)||K.isStickDown(this.gamepadIndex,"left","up")?this.player.moveUp():F.isDown(F.DOWN)||K.isStickDown(this.gamepadIndex,"left","down")?this.player.moveDown():this.player.stopMoving(),F.isDown(F.RIGHT)||K.isStickDown(this.gamepadIndex,"right","right")?this.player.turnRight():F.isDown(F.LEFT)||K.isStickDown(this.gamepadIndex,"right","left")?this.player.turnLeft():this.player.stopTurning(),this.player.isRunning||!F.isDown(F.CTRL)&&!K.isDown(this.gamepadIndex,"rightTrigger")||this.player.fireBullet(),F.isDown(F.SHIFT)||K.isDown(this.gamepadIndex,"actionSouth")?this.player.isRunning=!0:this.player.isRunning=!1,(this.keyboardDownOnce(F.R)||this.gamepadButtonDownOnce("actionWest"))&&this.player.reload(),(this.keyboardDownOnce(F.X)||this.gamepadButtonDownOnce("actionNorth"))&&this.player.scrollWeapons("down"),(this.keyboardDownOnce(F.Z)||this.gamepadButtonDownOnce("actionEast"))&&this.player.scrollWeapons("up")}}]),i}(q),ce=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(s.a)(this,i),(n=e.call(this)).state=t,n}return Object(r.a)(i,[{key:"update",value:function(t){F.isDown(F.E)||this.gamepadButtonDownOnce("leftBumper")?this.state.showScores=!0:this.state.showScores=!1,this.keyboardDownOnce(F.ESC)&&(this.state.paused?this.state.resume():this.state.pause())}}]),i}(q),de=function(){function t(e){Object(s.a)(this,t),this.soldier=e}return Object(r.a)(t,[{key:"update",value:function(){Math.random()<.05&&this.soldier.fireBullet(),Math.random()>.8&&this.soldier.moveUp(),Math.random()>.7?Math.random()>.5?this.soldier.turnRight():this.soldier.turnLeft():this.soldier.stopTurning(),this.soldier.currentWeapon&&0===this.soldier.currentWeapon.magazine&&this.soldier.reload()}}]),t}(),pe=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(s.a)(this,t),this.x=e,this.y=i}return Object(r.a)(t,[{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"perp",value:function(){var t=this.x;return this.x=this.y,this.y=-t,this}},{key:"rotate",value:function(t){var e=this.x,i=this.y;return this.x=e*Math.cos(t)-i*Math.sin(t),this.x=e*Math.sin(t)+i*Math.cos(t),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"normalize",value:function(){var t=this.len();return t>0&&(this.x=this.x/t,this.y=this.y/t),this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"scale",value:function(t,e){return this.x*=t,this.y*=e||t,this}},{key:"project",value:function(t){var e=this.dot(t)/t.len2();return this.x=e*t.x,this.y=e*t.y,this}},{key:"projectN",value:function(t){var e=this.dot(t);return this.x=e*t.x,this.y=e*t.y,this}},{key:"reflect",value:function(t){var e=this.x,i=this.y;return this.project(t).scale(2),this.x-=e,this.y-=i,this}},{key:"reflectN",value:function(t){var e=this.x,i=this.y;return this.projectN(t).scale(2),this.x-=e,this.y-=i,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"len2",value:function(){return this.dot(this)}},{key:"len",value:function(){return Math.sqrt(this.len2())}}]),t}();for(var fe=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pe,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(s.a)(this,t),this.position=e,this.angle=0,this.offset=new pe,this.setVertices(i)}return Object(r.a)(t,[{key:"setVertices",value:function(t){if(!this.vertices||this.vertices.length!==t.length)for(var e=this.computedVertices=[],i=this.edges=[],n=this.normals=[],a=0;a<t.length;a++)e.push(new pe),i.push(new pe),n.push(new pe);return this.vertices=t,this._compute(),this}},{key:"setAngle",value:function(t){return this.angle=t,this._compute(),this}},{key:"setOffset",value:function(t){return this.offset=t,this._compute(),this}},{key:"rotate",value:function(t){for(var e=this.vertices,i=e.length,n=0;n<i;n++)e[n].rotate(t);return this._compute(),this}},{key:"translate",value:function(t,e){for(var i=this.vertices,n=i.length,a=0;a<n;a++)i[a].x+=t,i[a].y+=e;return this._compute(),this}},{key:"_compute",value:function(){for(var t=this.computedVertices,e=this.edges,i=this.normals,n=this.vertices,a=this.offset,s=this.angle,r=n.length,o=0;o<r;o++){var h=t[o].copy(n[o]);h.x+=a.x,h.y+=a.y,0!==s&&h.rotate(s)}for(var l=0;l<r;l++){var u=t[l],c=l<r-1?t[l+1]:t[0],d=e[l].copy(c).sub(u);i[l].copy(d).perp().normalize()}return this}},{key:"getAABB",value:function(){for(var t,e,i,n=this.computedVertices,a=n.length,s=n[0].x,r=n[0].y,o=n[0].x,h=n[0].y,l=1;l<a;l++){var u=n[l];u.x<s?s=u.x:u.x>o&&(o=u.x),u.y<r?r=u.y:u.y>h&&(h=u.y)}return t=this.position.clone().add(new pe(s,r)),e=o-s,i=h-r,new fe(new pe(t.x,t.y),[new pe,new pe(e,0),new pe(e,i),new pe(0,i)])}}]),t}(),me=fe,ve=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Object(s.a)(this,t),this.position={x:e,y:i,z:n},this.previousPosition={x:e,y:i,z:n},this.width=a,this.height=r,this.depth=o,this.speed=.2,this.rotationSpeed=.3,this.reset(),this._body=new me(new pe(this.x,this.y),[new pe(-this.halfWidth,-this.halfHeight),new pe(-this.halfWidth,this.halfHeight),new pe(this.halfWidth,this.halfHeight),new pe(this.halfWidth,0)]),this.options={physics:!1,bullets:!1,audio:!1,isBullet:!1,isPlayer:!1,isCharacter:!1}}return Object(r.a)(t,[{key:"rotatedBody",get:function(){var t=this._body;return t.setAngle(this.angle),t}},{key:"onWallCollision",value:function(){return null}},{key:"body",get:function(){return this._body.position.x=this.position.x,this._body.position.y=this.position.y,this._body}},{key:"x",get:function(){return this.position.x}},{key:"y",get:function(){return this.position.y}},{key:"z",get:function(){return this.position.z}},{key:"halfWidth",get:function(){return this.width/2}},{key:"halfHeight",get:function(){return this.height/2}},{key:"kill",value:function(){this.dead=!0}},{key:"point",get:function(){return new pe(this.x,this.y)}},{key:"reset",value:function(){this.velocity={x:0,y:0,z:0},this.dead=!1,this.reverse=!1,this.angle=2*Math.PI,this.angularVelocity=0,this.reverse=!1,this.collidable=!0,this.shouldUpdate=!0,this.isMoving=!1,this.actions={}}},{key:"respawn",value:function(t){this.reset(),this.position={x:t.x,y:t.y,z:t.z},this.previousPosition={x:t.x,y:t.y,z:t.z}}},{key:"moveUp",value:function(){this.reverse=!1,this.isMoving=!0,this.velocity.x=-this.speed*Math.cos(this.angle),this.velocity.y=-this.speed*Math.sin(this.angle)}},{key:"moveDown",value:function(){this.reverse=!0,this.isMoving=!0,this.velocity.x=this.speed*Math.cos(this.angle),this.velocity.y=this.speed*Math.sin(this.angle)}},{key:"turnLeft",value:function(){this.angularVelocity=this.rotationSpeed*(Math.PI/180)}},{key:"turnRight",value:function(){this.angularVelocity=-this.rotationSpeed*(Math.PI/180)}},{key:"stopMoving",value:function(){this.isMoving=!1,this.velocity.x=0,this.velocity.y=0}},{key:"stopTurning",value:function(){this.angularVelocity=0}},{key:"update",value:function(t){this.dead||(this.angle+=this.angularVelocity*t,this.angle<0&&(this.angle=2*Math.PI-this.angle),this.previousPosition.x=this.position.x,this.previousPosition.y=this.position.y,this.previousPosition.z=this.position.z,this.position.x+=this.velocity.x*t,this.position.y+=this.velocity.y*t,this.position.z+=this.velocity.z*t)}}]),t}(),ye=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t,n,a,r,o,h,l){var u;return Object(s.a)(this,i),(u=e.call(this,t,n,a,r,o,h)).maxHealth=100,u.walkingSpeed=.1,u.runningSpeed=.2,u.reset(),u.options.physics=!0,u.options.bullets=!0,u.options.isCharacter=!0,u}return Object(r.a)(i,[{key:"isRunning",get:function(){return this._isRunning},set:function(t){t?(this._isRunning=!0,this.speed=this.runningSpeed):(this._isRunning=!1,this.speed=this.walkingSpeed)}},{key:"fall",value:function(){this.velocity.z=-.2}},{key:"hitByBullet",value:function(t){this.health-=t.damage,0===this.health&&this.kill()}},{key:"stopFalling",value:function(){this.velocity.z=0}},{key:"reset",value:function(){Object(Y.a)(Object(Z.a)(i.prototype),"reset",this).call(this),this._isRunning=!1,this.speed=this.walkingSpeed,this.health=100,this.health=this.maxHealth}},{key:"update",value:function(t){Object(Y.a)(Object(Z.a)(i.prototype),"update",this).call(this,t),this.position.z<=0&&this.kill()}}]),i}(ve),ge=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,t),this.name=e,this.maxMagazine=i.maxMagazine||10,this.magazine=i.magazine||this.maxMagazine,this.maxAmmo=i.maxAmmo||10,this.ammo=(i.ammo||this.maxAmmo)-this.magazine,this.fireRate=i.fireRate||150,this.damage=i.damage||10,this.reloadTime=i.reloadTime||500,this._reloadingTime=0,this._firedTime=0,this._canFire=!0,this.isReloading=!1,this.fired=!1}return Object(r.a)(t,[{key:"fire",value:function(){return!!(!this.isReloading&&this._canFire&&this.magazine>0)&&(this.fired=!0,this._canFire=!1,this.magazine-=1,!0)}},{key:"reload",value:function(){if(!this.isReloading){this.isReloading=!0;var t=this.maxMagazine-this.magazine;this.ammo-t<0?(t=this.ammo,this.ammo=0):this.ammo-=t,this.magazine+=t}}},{key:"magazines",get:function(){return Math.floor(this.ammo/this.maxMagazine)}},{key:"update",value:function(t){this._fired&&(this._fired=!1),this.isReloading?(this._reloadingTime+=t,this._reloadingTime>this.reloadTime&&(this._reloadingTime=0,this.isReloading=!1)):this._canFire||(this._firedTime+=t,this._firedTime>this.fireRate&&(this._firedTime=0,this._canFire=!0))}}]),t}(),we=function(){var t=new ge("mp44",{maxAmmo:120,maxMagazine:30});return t},be=function(){var t=new ge("thompson",{maxAmmo:90,maxMagazine:25,fireRate:90});return t},xe=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t,n,a,r,o,h,l){var u;return Object(s.a)(this,i),(u=e.call(this,t,n,a,r,o,h)).name="cpu",u.weapons=[],u.currentWeaponIndex=0,u.currentWeapon=null,u.team=l,u.addWeapon(we()),u.addWeapon(be()),u.currentWeapon=u.weapons[0],u.maxHealth=100,u.walkingSpeed=.1,u.runningSpeed=.2,u.kills=new Map,u.deaths=new Map,u.reset(),u.options.isSoldier=!0,u}return Object(r.a)(i,[{key:"addWeapon",value:function(t){this.weapons.push(t)}},{key:"scrollWeapons",value:function(t){if("up"===t)this.currentWeaponIndex===this.weapons.length-1?this.currentWeaponIndex=0:this.currentWeaponIndex+=1;else{if("down"!==t)throw new Error('direction is not "up" or "down"');0===this.currentWeaponIndex?this.currentWeaponIndex=this.weapons.length-1:this.currentWeaponIndex-=1}this.currentWeapon=this.weapons[this.currentWeaponIndex]}},{key:"reload",value:function(){!this.dead&&this.currentWeapon&&this.currentWeapon.reload()}},{key:"hitByBullet",value:function(t){if(Object(Y.a)(Object(Z.a)(i.prototype),"hitByBullet",this).call(this,t),0===this.health){var e=this.deaths.get(t.firedBy);e?e+=1:e=1,this.deaths.set(t.firedBy,e);var n=t.firedBy.kills.get(this);n?n+=1:n=1,t.firedBy.kills.set(this,n)}}},{key:"kill",value:function(){Object(Y.a)(Object(Z.a)(i.prototype),"kill",this).call(this);var t=this.deaths.get(this);t?this.deaths.set(this,t+1):this.deaths.set(this,1)}},{key:"totalKills",get:function(){var t,e=0,i=Object(a.a)(this.kills.values());try{for(i.s();!(t=i.n()).done;){e+=t.value}}catch(n){i.e(n)}finally{i.f()}return e}},{key:"totalDeaths",get:function(){var t,e=0,i=Object(a.a)(this.deaths.values());try{for(i.s();!(t=i.n()).done;){e+=t.value}}catch(n){i.e(n)}finally{i.f()}return e}},{key:"fireBullet",value:function(){!this.dead&&this.currentWeapon&&(this.currentWeapon.fire()&&(this.actions.firedBullet=!0))}},{key:"reset",value:function(){Object(Y.a)(Object(Z.a)(i.prototype),"reset",this).call(this),this.actions.firedBullet=!1}},{key:"update",value:function(t){Object(Y.a)(Object(Z.a)(i.prototype),"update",this).call(this,t),this.actions.firedBullet&&(this.actions.firedBullet=!1),this.currentWeapon&&this.currentWeapon.update(t)}}]),i}(ye),ke=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t,n,a,r,o,h,l){var u;return Object(s.a)(this,i),(u=e.call(this,t,n,a,r,o,h,l)).name="player",u.options.isPlayer=!0,u.options.audio=!0,u}return Object(r.a)(i,[{key:"update",value:function(t){Object(Y.a)(Object(Z.a)(i.prototype),"update",this).call(this,t)}}]),i}(xe),Oe=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t,n,a){var r;return Object(s.a)(this,i),(r=e.call(this,t,n,a)).entities=t.soldiers,r.player=t.player,r}return Object(r.a)(i,[{key:"update",value:function(t){var e,i=Object(a.a)(this.entities);try{for(i.s();!(e=i.n()).done;){var n=e.value;n===this.player&&n.actions.firedBullet&&this.effects.play(n.currentWeapon.name)}}catch(s){i.e(s)}finally{i.f()}}}]),i}(et),je=function(){function t(e,i,n,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};Object(s.a)(this,t),this._position=e,this.width=i,this.height=n,this.depth=a,this.options=r,this.type=r.type||"wall",this._walls=r.walls||{},this.collidable=r.collidable||!0,this._computeBodies()}return Object(r.a)(t,[{key:"walls",get:function(){return this._walls},set:function(t){this._walls=t,this._computeBodies()}},{key:"position",get:function(){return this._position},set:function(t){this._position=t,this._computeBodies()}},{key:"_computeBodies",value:function(){this._walls.top&&this._walls.west&&this._walls.east&&this._walls.south&&this._walls.north&&(this.bodies=[new me(new pe(this.x,this.y),[new pe(0,0),new pe(this.width,0),new pe(this.width,this.height),new pe(0,this.height)])]);var t=[];this._walls.west&&t.push(new me(new pe(this.x,this.y),[new pe(0,0),new pe(this.width,0),new pe(this.width,2),new pe(0,2)])),this._walls.east&&t.push(new me(new pe(this.x,this.y+this.height),[new pe(0,0),new pe(this.width,0),new pe(this.width,-2),new pe(0,-2)])),this._walls.south&&t.push(new me(new pe(this.x+this.width,this.y),[new pe(0,0),new pe(0,this.height),new pe(-2,this.height),new pe(-2,0)])),this._walls.north&&t.push(new me(new pe(this.x,this.y),[new pe(0,0),new pe(0,this.height),new pe(2,this.height),new pe(2,0)])),this.bodies=t}},{key:"x",get:function(){return this._position.x}},{key:"y",get:function(){return this._position.y}},{key:"z",get:function(){return this._position.z}}]),t}(),_e=function(){function t(e,i,n,a){Object(s.a)(this,t),this.position={x:e,y:i,z:n},this.color=a,this.sourcePosition={x:e,y:i,z:n},this.angle=2*Math.PI}return Object(r.a)(t,[{key:"x",get:function(){return this.position.x}},{key:"y",get:function(){return this.position.y}},{key:"z",get:function(){return this.position.z}}]),t}(),ze=function(){function t(e,i,n,a,r,o,h){Object(s.a)(this,t),this.width=i,this.height=n,this.depth=a,this.blockWidth=r,this.blockHeight=o,this.blockDepth=h,this.lights=[],this.layers=e,this.name=null}return Object(r.a)(t,[{key:"blocks",value:function(t){return this.blocksBetweenIndexes({x:0,y:0,z:0},{x:this.width-1,y:this.height-1,z:this.depth-1},t)}},{key:"totalWidth",get:function(){return this.width*this.blockWidth}},{key:"totalHeight",get:function(){return this.height*this.blockHeight}},{key:"totalDepth",get:function(){return this.depth*this.blockDepth}},{key:"indexToPosition",value:function(t){return{x:t.x*this.blockWidth,y:t.y*this.blockHeight,z:t.z*this.blockDepth}}},{key:"positionToIndex",value:function(t){var e=t.x,i=t.y,n=t.z,a={};return a.x=Math.floor(e/this.blockWidth),a.y=Math.floor(i/this.blockHeight),a.z=Math.floor(n/this.blockDepth),a}},{key:"randomRespawnPosition",value:function(){var t=this.respawns[Math.round(Math.random()*(this.respawns.length-1))];return this.indexToPosition(t.position)}},{key:"blockAtIndex",value:function(t){return t.z<0||t.z>=this.depth||t.y<0||t.y>=this.height||t.x<0||t.x>=this.width?null:this.layers[t.z][t.y][t.x]}},{key:"blockAtPosition",value:function(t){var e=this.positionToIndex(t);return this.blockAtIndex(e)}},{key:"blocksAtPositions",value:function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[],s=Object(a.a)(t);try{for(s.s();!(e=s.n()).done;){var r=e.value,o=this.blockAtPosition(r);o&&-1!==i.indexOf(o.type)&&n.push(o)}}catch(h){s.e(h)}finally{s.f()}return n}},{key:"blocksBetweenIndexes",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=[],a=t,s=e,r=0;r<this.layers.length;r++)if(r>=a.z&&r<=s.z)for(var o=0;o<this.layers[r].length;o++)if(o>=a.y&&o<=s.y)for(var h=0;h<this.layers[r][o].length;h++)if(h>=a.x&&h<=s.x){var l={x:h,y:o,z:r},u=this.blockAtIndex(l);u&&-1!==i.indexOf(u.type)&&n.push(u)}return n}},{key:"blocksBetweenPositions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,z:0},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},i=arguments.length>2?arguments[2]:void 0;return this.blocksBetweenIndexes(this.positionToIndex(t),this.positionToIndex(e),i)}},{key:"toString",value:function(){var t,e="",i=Object(a.a)(this.layers);try{for(i.s();!(t=i.n()).done;){var n,s=t.value,r=[],o=Object(a.a)(s);try{for(o.s();!(n=o.n()).done;){var h=n.value.map((function(t){return t?t.id:0}));r.push(h.join(", "))}}catch(l){o.e(l)}finally{o.f()}e=(e=e.concat(r.join("\n"))).concat("\n---------------\n")}}catch(l){i.e(l)}finally{i.f()}return e}}]),t}(),Se=function(t,e,i,n){var a={x:t.position.x*e,y:t.position.y*i,z:t.position.z*n},s={walls:t.walls,type:t.type,collidable:t.collidable},r=new je(a,e,i,n,s);return r.collidable=t.collidable||!1,r},Ie=function(t,e,i,n){var a=t.position,s={x:a.x*e,y:a.y*i,z:a.z*n},r={x:a.x*e,y:a.y*i,z:a.z*n},o=2*Math.PI;"west"===t.align?s.x-=e/2:"east"===t.align?(s.x+=e/2,o=Math.PI/180*180):"north"===t.align?(s.y+=i/2,o=Math.PI/180*90):"south"===t.align&&(s.y-=i/2,o=Math.PI/180*270);var h=new _e(r.x,r.y,r.z,t.color);return h.angle=o,h.sourcePosition=s,h},Me={parse:function(t){return function(t){var e,i=t.blocks,n=t.blockWidth,s=t.blockHeight,r=t.blockDepth,o=t.width,h=t.height,l=t.depth,u=function(t,e,i){for(var n=[],a=0;a<i;a++){for(var s=[],r=0;r<e;r++){for(var o=[],h=0;h<i;h++)o.push(null);s.push(o)}n.push(s)}return n}(0,h,l),c=Object(a.a)(i);try{for(c.s();!(e=c.n()).done;){var d=e.value,p=Se(d,n,s,r),f=d.position;u[f.z][f.y][f.x]=p}}catch(k){c.e(k)}finally{c.f()}var m=new ze(u,o,h,l,n,s,r);if(t.lights){var v,y=Object(a.a)(t.lights);try{for(y.s();!(v=y.n()).done;){var g=v.value;m.lights.push(Ie(g,n,s,r))}}catch(k){y.e(k)}finally{y.f()}}m.name=t.name,m.respawns=[];var w,b=Object(a.a)(t.respawns);try{for(b.s();!(w=b.n()).done;){var x=w.value;m.respawns.push(x)}}catch(k){b.e(k)}finally{b.f()}return m}(t)}},Pe=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new pe,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(s.a)(this,t),this.position=e,this.width=i,this.height=n}return Object(r.a)(t,[{key:"toPolygon",value:function(){var t=this.position,e=this.width,i=this.height;return new me(new pe(t.x,t.y),[new pe,new pe(e,0),new pe(e,i),new pe(0,i)])}}]),t}(),Ve=function(){function t(){Object(s.a)(this,t),this.a=null,this.b=null,this.overlapN=new pe,this.overlapV=new pe,this.clear()}return Object(r.a)(t,[{key:"clear",value:function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this}}]),t}(),Te=[],Ce=0;Ce<10;Ce++)Te.push(new pe);for(var Ae=[],De=0;De<5;De++)Ae.push([]);var Ee=new Ve,Be=new Pe(new pe,1,1).toPolygon(),Fe=function(t,e,i){for(var n=Number.MAX_VALUE,a=-Number.MAX_VALUE,s=t.length,r=0;r<s;r++){var o=t[r].dot(e);o<n&&(n=o),o>a&&(a=o)}i[0]=n,i[1]=a},Ne=function(t,e,i,n,a,s){var r=Ae.pop(),o=Ae.pop(),h=Te.pop().copy(e).sub(t),l=h.dot(a);if(Fe(i,a,r),Fe(n,a,o),o[0]+=l,o[1]+=l,r[0]>o[1]||o[0]>r[1])return Te.push(h),Ae.push(r),Ae.push(o),!0;if(s){var u=0;if(r[0]<o[0])if(s.aInB=!1,r[1]<o[1])u=r[1]-o[0],s.bInA=!1;else{var c=r[1]-o[0],d=o[1]-r[0];u=c<d?c:-d}else if(s.bInA=!1,r[1]>o[1])u=r[0]-o[1],s.aInB=!1;else{var p=r[1]-o[0],f=o[1]-r[0];u=p<f?p:-f}var m=Math.abs(u);m<s.overlap&&(s.overlap=m,s.overlapN.copy(a),u<0&&s.overlapN.negate())}return Te.push(h),Ae.push(r),Ae.push(o),!1},He=function(t,e){var i=t.len2(),n=e.dot(t);return n<0?Re:n>i?Ge:We},Re=-1,We=0,Ge=1,Le=function(t,e,i){for(var n=Te.pop().copy(e.position).sub(t.position),a=e.radius,s=a*a,r=t.computedVertices,o=r.length,h=Te.pop(),l=Te.pop(),u=0;u<o;u++){var c=u===o-1?0:u+1,d=0===u?o-1:u-1,p=0,f=null;h.copy(t.edges[u]),l.copy(n).sub(r[u]),i&&l.len2()>s&&(i.aInB=!1);var m=He(h,l);if(m===Re){h.copy(t.edges[d]);var v=Te.pop().copy(n).sub(r[d]);if((m=He(h,v))===Ge){var y=l.len();if(y>a)return Te.push(n),Te.push(h),Te.push(l),Te.push(v),!1;i&&(i.bInA=!1,f=l.normalize(),p=a-y)}Te.push(v)}else if(m===Ge){if(h.copy(t.edges[c]),l.copy(n).sub(r[c]),(m=He(h,l))===Re){var g=l.len();if(g>a)return Te.push(n),Te.push(h),Te.push(l),!1;i&&(i.bInA=!1,f=l.normalize(),p=a-g)}}else{var w=h.perp().normalize(),b=l.dot(w),x=Math.abs(b);if(b>0&&x>a)return Te.push(n),Te.push(w),Te.push(l),!1;i&&(f=w,p=a-b,(b>=0||p<2*a)&&(i.bInA=!1))}f&&i&&Math.abs(p)<Math.abs(i.overlap)&&(i.overlap=p,i.overlapN.copy(f))}return i&&(i.a=t,i.b=e,i.overlapV.copy(i.overlapN).scale(i.overlap)),Te.push(n),Te.push(h),Te.push(l),!0},Ue=function(t,e,i){for(var n=t.computedVertices,a=n.length,s=e.computedVertices,r=s.length,o=0;o<a;o++)if(Ne(t.position,e.position,n,s,t.normals[o],i))return!1;for(var h=0;h<r;h++)if(Ne(t.position,e.position,n,s,e.normals[h],i))return!1;return i&&(i.a=t,i.b=e,i.overlapV.copy(i.overlapN).scale(i.overlap)),!0},Ke={testPolygonPolygon:Ue,testCirclePolygon:function(t,e,i){var n=Le(e,t,i);if(n&&i){var a=i.a,s=i.aInB;i.overlapN.negate(),i.overlapV.negate(),i.a=i.b,i.b=a,i.aInB=i.bInA,i.bInA=s}return n},testPolygonCircle:Le,testCircleCircle:function(t,e,i){var n=Te.pop().copy(e.position).sub(t.position),a=t.radius+e.radius,s=a*a,r=n.len2();if(r>s)return Te.push(n),!1;if(i){var o=Math.sqrt(r);i.a=t,i.b=e,i.overlap=a-o,i.overlapN.copy(n.normalize()),i.overlapV.copy(n).scale(i.overlap),i.aInB=t.radius<=e.radius&&o<=e.radius-t.radius,i.bInA=e.radius<=t.radius&&o<=t.radius-e.radius}return Te.push(n),!0},pointInPolygon:function(t,e){Be.position.copy(t),Ee.clear();var i=Ue(Be,e,Ee);return i&&(i=Ee.aInB),i},pointInCircle:function(t,e){var i=Te.pop().copy(t).sub(e.position),n=e.radius*e.radius,a=i.len2();return Te.push(i),a<=n}},qe={wallCollision:function(t,e,i){var n=function(t,e){var i=t.position.x,n=t.position.y,a=t.angle,s=t.reverse?-1:1,r={},o={};return Math.abs(t.velocity.x)>0?i-=e*Math.cos(a)*s:i-=e*s,t.velocity.x<0?(r.x=i,o.x=t.position.x):(r.x=t.position.x,o.x=i),Math.abs(t.velocity.y)>0?n-=e*Math.sin(a)*s:n-=e*s,t.velocity.y<0?(r.y=n,o.y=t.position.y):(r.y=t.position.y,o.y=n),r.z=t.position.z,o.z=t.position.z,{min:r,max:o}}(e,(t.blockWidth+t.blockHeight)/2);if(n.min.x!==n.max.x||n.min.y!==n.max.y){var s,r=t.blocksBetweenPositions(n.min,n.max,["wall"]),o=Object(a.a)(r);try{for(o.s();!(s=o.n()).done;){var h=s.value;if(h.collidable){var l,u=h.bodies,c=Object(a.a)(u);try{for(c.s();!(l=c.n()).done;){var d=l.value,p=new Ve;Ke.testPolygonPolygon(e.body,d,p)&&i(p)}}catch(f){c.e(f)}finally{c.f()}}}}catch(f){o.e(f)}finally{o.f()}}},floorCollision:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},a={x:e.position.x+e.velocity.x*i,y:e.position.y+e.velocity.y*i,z:e.position.z+e.velocity.z*i},s=t.positionToIndex(e.position);s.z-=1;var r=t.blockAtIndex(s);r&&r.collidable&&r.walls.top?a.z<=r.position.z+r.depth&&n(r):e.fall()}},Xe=function(){function t(e){Object(s.a)(this,t),this.state=e,this.entities=e.soldiers,this.map=this.state.map}return Object(r.a)(t,[{key:"update",value:function(t){var e,i=this,n=Object(a.a)(this.entities);try{var s=function(){var n=e.value;qe.wallCollision(i.map,n,(function(t){n.position.x-=t.overlapV.x,n.position.y-=t.overlapV.y})),qe.floorCollision(i.map,n,t,(function(t){"water"===t.type?(n.fall(),n.kill()):(n.position.z=t.position.z+t.depth,n.stopFalling())}))};for(n.s();!(e=n.n()).done;)s()}catch(r){n.e(r)}finally{n.f()}}}]),t}(),Ye=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(t,n,a,r,o){var h;return Object(s.a)(this,i),(h=e.call(this,t,n,a,r,o)).dead=!0,h.firedBy=null,h.firedByWeapon=null,h.speed=.3,h.maxDistance=500,h.traveledDistance=0,h.options.isBullet=!0,h}return Object(r.a)(i,[{key:"damage",get:function(){return this.firedByWeapon?this.firedByWeapon.damage:0}},{key:"update",value:function(t){Object(Y.a)(Object(Z.a)(i.prototype),"update",this).call(this,t),this.traveledDistance+=this.speed*t,this.traveledDistance>this.maxDistance?(this.dead=!0,this.traveledDistance=0):this.moveUp()}}]),i}(ve),Ze=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,t),this.state=e,this.soldiers=this.state.soldiers,this.map=this.state.map,this.bulletPool=new Wt((function(){return new Ye(0,0,0,4,10)}),10,10,i.poolLimit||200),this.deadBullets=new Set,this.activeBullets=new Set}return Object(r.a)(t,[{key:"poolSize",get:function(){return this.bulletPool.size}},{key:"_fireBullet",value:function(t){var e=this.bulletPool.get();if(!e){var i=this.activeBullets.values().next().value;this.bulletPool.free(i),e=this.bulletPool.get()}return e.firedBy=t,e.firedByWeapon=t.currentWeapon,e.respawn(t.position),e.angle=t.angle,this.activeBullets.add(e),e}},{key:"killBullet",value:function(t){t.kill(),this.bulletPool.free(t())}},{key:"update",value:function(t){var e,i=this,n=Object(a.a)(this.soldiers);try{for(n.s();!(e=n.n()).done;){var s=e.value;s.actions.firedBullet&&this._fireBullet(s)}}catch(l){n.e(l)}finally{n.f()}var r,o=Object(a.a)(this.activeBullets);try{var h=function(){var e=r.value;if(e.update(t),qe.wallCollision(i.map,e,(function(){return e.kill()})),e.dead)i.deadBullets.add(e),i.activeBullets.delete(e),i.bulletPool.free(e);else{var n,s=Object(a.a)(i.soldiers);try{for(s.s();!(n=s.n()).done;){var o=n.value;o.dead||e.firedBy!==o&&e.position.z>=o.position.z&&e.position.z<o.position.z+50&&Ke.pointInPolygon(e.point,o.body)&&(o.hitByBullet(e),e.kill(),i.bulletPool.free(e))}}catch(l){s.e(l)}finally{s.f()}}};for(o.s();!(r=o.n()).done;)h()}catch(l){o.e(l)}finally{o.f()}}}]),t}();var Je={createSingleplayer:function(t,e){var i=Me.parse(tt.a.getMap(e.map)),n=new le(e.teams),a=new Et(n,i);!function(t,e){for(var i=0;i<e;i++){var n=t.map.randomRespawnPosition(),a=n.x,s=n.y,r=n.z,o=new xe(a,s,r,48,48,1,"american");t.inputs.add(new de(o)),t.match.addSoldier(o)}}(a,e.cpuCount),function(t,e){var i=t.map.randomRespawnPosition(),n=i.x,a=i.y,s=i.z,r=new ke(n,a,s,48,48,1,"american"),o=new ue(r);t.player=r,t.inputs.add(o),r.kill(),t.match.addSoldier(r,"american")}(a,e.playerName);var s=new Xe(a),r=new Ze(a,{poolLimit:e.poolLimit||200});a.bulletSystem=r,a.collisionSystem=s,a.audio=new Oe(a,"guns","background");var o=new ce(a);return a.inputs.add(o),function(t){t.addView(re(t)),t.addView(se(t))}(a),a},createMultiplayer:function(t,e){}},Qe={create:function(t,e){var i=new nt,n=new dt;i.addMenuItem(new st("server","Server","localhost:3000",(function(t){e.changeOption("server",t)}))),i.addMenuItem(new at("connect","Connect",(function(){i.freeze=!0;var n={url:e.options.get("server"),playerName:e.options.get("name"),poolSize:200};Je.createMultiplayer(t,n).then((function(e){i.freeze=!1,t.addState("multiplayer",e),t.changeState("multiplayer")})).catch((function(t){console.error("Error creating multiplayer game"),console.error(t)}))}))),i.addMenuItem(new at("back","- back",(function(){e.currentMenu="main"}))),n.addDynamicView(new Ct(i),{x:300,y:100,z:0});var a=new ct("front","ui");return a.lightness=.8,n.backgroundView=a,{viewContainer:n,menu:i}}},$e={create:function(t){var e=new nt,i=new dt;e.addMenuItem(new at("back","- back",(function(){t.currentMenu="main"}))),i.addDynamicView(new Ct(e),{x:300,y:100,z:0});var n=new ct("iwo_jima","ui");return n.lightness=.5,i.backgroundView=n,{viewContainer:i,menu:e}}};function ti(t,e){var i=new nt;return i.addMenuItem(new at("createGame","Singleplayer",(function(i){var n=t.states.get("play");n?(e.gamePlaying=!0,n.player.name=e.options.get("name"),i.text="Continue game"):(n=function(t,e){var i=Object.assign({poolLimit:200,teams:["american","german"],cpuCount:7,map:"level2",playerName:"unknown soldier"},e),n=Je.createSingleplayer(t,i);return t.addState("play",n),n}(t,{playerName:e.options.get("name")}),i.text="Create game"),n.resume(),t.changeState("play")}))),i.addMenuItem(new at("createMultiplayerGame","Multiplayer",(function(t){e.currentMenu="multiplayer"}))),i.addMenuItem(new at("options","Options",(function(){e.currentMenu="options"}))),i.addMenuItem(new at("help","Help",(function(){e.currentMenu="help"}))),i}var ei={create:function(t,e){var i=ti(t,e);return{viewContainer:function(t){var e=new dt,i=new ct("normandy","ui");return e.addDynamicView(new Ct(t),{x:500,y:200,z:0}),e.addStaticView(new Tt("logo","ui"),{x:300,y:300,z:0}),i.lightness=.5,e.backgroundView=i,e}(i),menu:i}}},ii=function(t){Object(o.a)(i,t);var e=Object(h.a)(i);function i(){var t;return Object(s.a)(this,i),(t=e.call(this,"menu")).menus=new Map,t._currentMenu=null,t.currentMenuName=null,t.options=new Map([["name","Unknown Soldier"],["server","localhost:3000"]]),t.gamePlaying=!1,t.currentOptionsEdit=null,t}return Object(r.a)(i,[{key:"addMenu",value:function(t,e){this.menus.set(t,e)}},{key:"changeOption",value:function(t,e){this.options.set(t,e)}},{key:"currentMenu",get:function(){return this._currentMenu},set:function(t){if(this._currentMenu=this.menus.get(t),!this._currentMenu)throw new Error('Menu "'+t+'" does not exist');this.currentMenuName=t}},{key:"init",value:function(){Object(Y.a)(Object(Z.a)(i.prototype),"init",this).call(this)}},{key:"update",value:function(t){Object(Y.a)(Object(Z.a)(i.prototype),"updateInputs",this).call(this,t),Object(Y.a)(Object(Z.a)(i.prototype),"updateAudio",this).call(this,t)}}]),i}(Dt),ni={create:function(t){var e=new ii,i=new X(e);e.inputs.add(i);var s,r=new Map([["main",ei.create(t,e)],["multiplayer",Qe.create(t,e)],["options",At.create(e)],["help",$e.create(e)]]),o=Object(a.a)(r.entries());try{for(o.s();!(s=o.n()).done;){var h=Object(n.a)(s.value,2),l=h[0],u=h[1];e.addMenu(l,u.menu)}}catch(y){o.e(y)}finally{o.f()}var c,d=new $(e),p=Object(a.a)(r.entries());try{for(p.s();!(c=p.n()).done;){var f=Object(n.a)(c.value,2),m=f[0],v=f[1];d.addViewContainer(m,v.viewContainer)}}catch(y){p.e(y)}finally{p.f()}return d.currentViewContainer="main",e.addView(d),e.currentMenu="main",e.audio=new it(e,"menu_effects","background"),e}};e.a=ni},function(t,e,i){"use strict";var n=i(0),a=i(1),s=i(18),r=function(){function t(e){Object(n.a)(this,t),this.renderer=e}return Object(a.a)(t,[{key:"init",value:function(){this.statjs=new s.a,this.statjs.setModes([0,1,2]),this.statjs.domElement.style.position="absolute",this.statjs.domElement.style.right="81px",this.statjs.domElement.style.bottom="0px",document.body.appendChild(this.statjs.domElement),this.rendererStats=function(){var t=document.createElement("div");t.style.cssText="width:80px;opacity:0.9;cursor:pointer";var e=document.createElement("div");e.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#200;",t.appendChild(e);var i=document.createElement("div");i.style.cssText="color:#f00;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",i.innerHTML="WebGLRenderer",e.appendChild(i);for(var n=[],a=0;a<9;a++)n[a]=document.createElement("div"),n[a].style.cssText="color:#f00;background-color:#311;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",e.appendChild(n[a]),n[a].innerHTML="-";var s=Date.now();return{domElement:t,update:function(t){if(!(Date.now()-s<1e3/30)){s=Date.now();var e=0;t&&(n[e++].textContent="== Memory =====",n[e++].textContent="Programs: "+t.memory.programs,n[e++].textContent="Geometries: "+t.memory.geometries,n[e++].textContent="Textures: "+t.memory.textures,n[e++].textContent="== Render =====",n[e++].textContent="Calls: "+t.render.calls,n[e++].textContent="Vertices: "+t.render.vertices,n[e++].textContent="Faces: "+t.render.faces,n[e++].textContent="Points: "+t.render.points)}}}}(),this.rendererStats.domElement.style.position="absolute",this.rendererStats.domElement.style.right="0px",this.rendererStats.domElement.style.bottom="0px",document.body.appendChild(this.rendererStats.domElement)}},{key:"before",value:function(){this.statjs.begin()}},{key:"after",value:function(){this.statjs.end(),this.rendererStats.update(this.renderer.info)}}]),t}(),o=i(12),h=i(19),l=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{debugMode:!1};Object(n.a)(this,t),this.debugMode=e.debugMode,this.states=new Map,this.currentState=null,this._renderer=new o.a,this.debugMode&&(this._renderDebug=new r(this._renderer),this._renderDebug.init())}return Object(a.a)(t,[{key:"addState",value:function(t,e){this.states.set(t,e)}},{key:"changeState",value:function(t){this.currentState=this.states.get(t),this.currentState.init(),this.currentState.views.size>0?this._renderer.views=this.currentState.views:console.warn("currentState has no View")}},{key:"removeState",value:function(t){this.states.delete(t)}},{key:"run",value:function(){var t=this;h.a.create().setUpdate((function(e){t.currentState?t.currentState.update(e):console.warn("no current State")})).setDraw((function(e){t.currentState.render(e),t._renderer.render(e)})).setBegin((function(){t.debugMode&&t._renderDebug.before()})).setEnd((function(){t.debugMode&&t._renderDebug.after()})).start()}}]),t}();e.a=l},function(t,e,i){t.exports=i(27)},function(t,e,i){"use strict";i.r(e),i(17).a.start()}],[[26,1,2]]]);
//# sourceMappingURL=main.c096d3d3.chunk.js.map